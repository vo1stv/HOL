(* x64Script.sml - generated by L3 - Tue Apr 18 14:48:02 2017 *)
open HolKernel boolLib bossLib Import

val () = Import.start "x64"

val _ = Construct
  [("Zreg",
    [("RAX",[]),("RCX",[]),("RDX",[]),("RBX",[]),("RSP",[]),("RBP",[]),
     ("RSI",[]),("RDI",[]),("zR8",[]),("zR9",[]),("zR10",[]),("zR11",[]),
     ("zR12",[]),("zR13",[]),("zR14",[]),("zR15",[])])]
;
val _ = Construct
  [("Zeflags",
    [("Z_CF",[]),("Z_PF",[]),("Z_AF",[]),("Z_ZF",[]),("Z_SF",[]),
     ("Z_OF",[])])]
;
val _ = Construct
  [("Zsize",[("Z16",[]),("Z32",[]),("Z64",[]),("Z8",[bTy])])]
;
val _ = Construct
  [("Zbase",[("ZnoBase",[]),("ZregBase",[CTy"Zreg"]),("ZripBase",[])])]
;
val _ = Construct
  [("Zrm",
    [("Zm",[PTy(OTy(PTy(FTy 2,CTy"Zreg")),PTy(CTy"Zbase",F64))]),
     ("Zr",[CTy"Zreg"])])]
;
val _ = Construct
  [("Zdest_src",
    [("Zr_rm",[PTy(CTy"Zreg",CTy"Zrm")]),("Zrm_i",[PTy(CTy"Zrm",F64)]),
     ("Zrm_r",[PTy(CTy"Zrm",CTy"Zreg")])])]
;
val _ = Construct [("Zimm_rm",[("Zimm",[F64]),("Zrm",[CTy"Zrm"])])]
;
val _ = Construct
  [("Zmonop_name",[("Zdec",[]),("Zinc",[]),("Znot",[]),("Zneg",[])])]
;
val _ = Construct
  [("Zbinop_name",
    [("Zadd",[]),("Zor",[]),("Zadc",[]),("Zsbb",[]),("Zand",[]),
     ("Zsub",[]),("Zxor",[]),("Zcmp",[]),("Zrol",[]),("Zror",[]),
     ("Zrcl",[]),("Zrcr",[]),("Zshl",[]),("Zshr",[]),("Ztest",[]),
     ("Zsar",[])])]
;
val _ = Construct
  [("Zcond",
    [("Z_O",[]),("Z_NO",[]),("Z_B",[]),("Z_NB",[]),("Z_E",[]),("Z_NE",[]),
     ("Z_NA",[]),("Z_A",[]),("Z_S",[]),("Z_NS",[]),("Z_P",[]),("Z_NP",[]),
     ("Z_L",[]),("Z_NL",[]),("Z_NG",[]),("Z_G",[]),("Z_ALWAYS",[])])]
;
val _ = Construct
  [("Zea",
    [("Zea_i",[PTy(CTy"Zsize",F64)]),("Zea_m",[PTy(CTy"Zsize",F64)]),
     ("Zea_r",[PTy(CTy"Zsize",CTy"Zreg")])])]
;
val _ = Construct
  [("instruction",
    [("Zbinop",[PTy(CTy"Zbinop_name",PTy(CTy"Zsize",CTy"Zdest_src"))]),
     ("Zcall",[CTy"Zimm_rm"]),("Zclc",[]),("Zcmc",[]),
     ("Zcmpxchg",[PTy(CTy"Zsize",PTy(CTy"Zrm",CTy"Zreg"))]),
     ("Zdiv",[PTy(CTy"Zsize",CTy"Zrm")]),("Zjcc",[PTy(CTy"Zcond",F64)]),
     ("Zjmp",[CTy"Zrm"]),("Zlea",[PTy(CTy"Zsize",CTy"Zdest_src")]),
     ("Zleave",[]),("Zloop",[PTy(CTy"Zcond",F64)]),
     ("Zmonop",[PTy(CTy"Zmonop_name",PTy(CTy"Zsize",CTy"Zrm"))]),
     ("Zmov",[PTy(CTy"Zcond",PTy(CTy"Zsize",CTy"Zdest_src"))]),
     ("Zmovsx",[PTy(CTy"Zsize",PTy(CTy"Zdest_src",CTy"Zsize"))]),
     ("Zmovzx",[PTy(CTy"Zsize",PTy(CTy"Zdest_src",CTy"Zsize"))]),
     ("Zmul",[PTy(CTy"Zsize",CTy"Zrm")]),("Znop",[]),("Zpop",[CTy"Zrm"]),
     ("Zpush",[CTy"Zimm_rm"]),("Zret",[F64]),
     ("Zset",[PTy(CTy"Zcond",PTy(bTy,CTy"Zrm"))]),("Zstc",[]),
     ("Zxadd",[PTy(CTy"Zsize",PTy(CTy"Zrm",CTy"Zreg"))]),
     ("Zxchg",[PTy(CTy"Zsize",PTy(CTy"Zrm",CTy"Zreg"))])])]
;
val _ = Construct
  [("Zinst",
    [("Zdec_fail",[sTy]),
     ("Zfull_inst",[PTy(LTy F8,PTy(CTy"instruction",OTy(LTy F8)))])])]
;
val _ = Record ("REX",[("B",bTy),("R",bTy),("W",bTy),("X",bTy)])
;
val _ = Construct
  [("exception",
    [("BadFlagAccess",[sTy]),("BadMemAccess",[F64]),("FAILURE",[sTy]),
     ("NoException",[])])]
;
val _ = Record
  ("x64_state",
   [("EFLAGS",ATy(CTy"Zeflags",OTy bTy)),("MEM",ATy(F64,F8)),
    ("REG",ATy(CTy"Zreg",F64)),("RIP",F64),("exception",CTy"exception")])
;
val qTy = CTy "x64_state";
fun qVar v = Term.mk_var (v, ParseDatatype.pretypeToType qTy);
val raise'exception_def = Def
  ("raise'exception",Var("e",CTy"exception"),
   Close
     (qVar"state",
      TP[LX(VTy"a"),
         ITE(EQ(Dest("exception",CTy"exception",qVar"state"),
                Const("NoException",CTy"exception")),
             Rupd("exception",TP[qVar"state",Var("e",CTy"exception")]),
             qVar"state")]))
;
val mem8_def = Def
  ("mem8",Var("addr",F64),
   Close
     (qVar"state",
      Apply(Dest("MEM",ATy(F64,F8),qVar"state"),Var("addr",F64))))
;
val write'mem8_def = Def
  ("write'mem8",TP[Var("b",F8),Var("addr",F64)],
   Close
     (qVar"state",
      Rupd
        ("MEM",
         TP[qVar"state",
            Fupd
              (Dest("MEM",ATy(F64,F8),qVar"state"),Var("addr",F64),
               Var("b",F8))])))
;
val mem16_def = Def
  ("mem16",Var("addr",F64),
   Close
     (qVar"state",
      CC[Apply
           (Call("mem8",ATy(qTy,F8),Bop(Add,Var("addr",F64),LW(1,64))),
            qVar"state"),
         Apply(Call("mem8",ATy(qTy,F8),Var("addr",F64)),qVar"state")]))
;
val write'mem16_def = Def
  ("write'mem16",TP[Var("w",F16),Var("addr",F64)],
   Close
     (qVar"state",
      Apply
        (Call
           ("write'mem8",ATy(qTy,qTy),
            TP[EX(Var("w",F16),LN 15,LN 8,F8),
               Bop(Add,Var("addr",F64),LW(1,64))]),
         Apply
           (Call
              ("write'mem8",ATy(qTy,qTy),
               TP[EX(Var("w",F16),LN 7,LN 0,F8),Var("addr",F64)]),
            qVar"state"))))
;
val mem32_def = Def
  ("mem32",Var("addr",F64),
   Close
     (qVar"state",
      CC[Apply
           (Call("mem16",ATy(qTy,F16),Bop(Add,Var("addr",F64),LW(2,64))),
            qVar"state"),
         Apply(Call("mem16",ATy(qTy,F16),Var("addr",F64)),qVar"state")]))
;
val write'mem32_def = Def
  ("write'mem32",TP[Var("w",F32),Var("addr",F64)],
   Close
     (qVar"state",
      Apply
        (Call
           ("write'mem16",ATy(qTy,qTy),
            TP[EX(Var("w",F32),LN 31,LN 16,F16),
               Bop(Add,Var("addr",F64),LW(2,64))]),
         Apply
           (Call
              ("write'mem16",ATy(qTy,qTy),
               TP[EX(Var("w",F32),LN 15,LN 0,F16),Var("addr",F64)]),
            qVar"state"))))
;
val mem64_def = Def
  ("mem64",Var("addr",F64),
   Close
     (qVar"state",
      CC[Apply
           (Call("mem32",ATy(qTy,F32),Bop(Add,Var("addr",F64),LW(4,64))),
            qVar"state"),
         Apply(Call("mem32",ATy(qTy,F32),Var("addr",F64)),qVar"state")]))
;
val write'mem64_def = Def
  ("write'mem64",TP[Var("w",F64),Var("addr",F64)],
   Close
     (qVar"state",
      Apply
        (Call
           ("write'mem32",ATy(qTy,qTy),
            TP[EX(Var("w",F64),LN 63,LN 32,F32),
               Bop(Add,Var("addr",F64),LW(4,64))]),
         Apply
           (Call
              ("write'mem32",ATy(qTy,qTy),
               TP[EX(Var("w",F64),LN 31,LN 0,F32),Var("addr",F64)]),
            qVar"state"))))
;
val Eflag_def = Def
  ("Eflag",Var("flag",CTy"Zeflags"),
   Close
     (qVar"state",
      CS(Apply
           (Dest("EFLAGS",ATy(CTy"Zeflags",OTy bTy),qVar"state"),
            Var("flag",CTy"Zeflags")),
         [(Mop(Some,bVar"b"),TP[bVar"b",qVar"state"]),
          (LO bTy,
           Apply
             (Call
                ("raise'exception",ATy(qTy,PTy(bTy,qTy)),
                 Call
                   ("BadFlagAccess",CTy"exception",
                    Mop(Cast sTy,Var("flag",CTy"Zeflags")))),qVar"state"))])))
;
val write'Eflag_def = Def
  ("write'Eflag",TP[bVar"b",Var("flag",CTy"Zeflags")],
   Close
     (qVar"state",
      Rupd
        ("EFLAGS",
         TP[qVar"state",
            Fupd
              (Dest("EFLAGS",ATy(CTy"Zeflags",OTy bTy),qVar"state"),
               Var("flag",CTy"Zeflags"),Mop(Some,bVar"b"))])))
;
val FlagUnspecified_def = Def
  ("FlagUnspecified",Var("flag",CTy"Zeflags"),
   Close
     (qVar"state",
      Rupd
        ("EFLAGS",
         TP[qVar"state",
            Fupd
              (Dest("EFLAGS",ATy(CTy"Zeflags",OTy bTy),qVar"state"),
               Var("flag",CTy"Zeflags"),LO bTy)])))
;
val CF_def = Def
  ("CF",qVar"state",
   Apply
     (Call("Eflag",ATy(qTy,PTy(bTy,qTy)),LC("Z_CF",CTy"Zeflags")),
      qVar"state"))
;
val write'CF_def = Def
  ("write'CF",bVar"b",
   Close
     (qVar"state",
      Apply
        (Call
           ("write'Eflag",ATy(qTy,qTy),TP[bVar"b",LC("Z_CF",CTy"Zeflags")]),
         qVar"state")))
;
val PF_def = Def
  ("PF",qVar"state",
   Apply
     (Call("Eflag",ATy(qTy,PTy(bTy,qTy)),LC("Z_PF",CTy"Zeflags")),
      qVar"state"))
;
val write'PF_def = Def
  ("write'PF",bVar"b",
   Close
     (qVar"state",
      Apply
        (Call
           ("write'Eflag",ATy(qTy,qTy),TP[bVar"b",LC("Z_PF",CTy"Zeflags")]),
         qVar"state")))
;
val AF_def = Def
  ("AF",qVar"state",
   Apply
     (Call("Eflag",ATy(qTy,PTy(bTy,qTy)),LC("Z_AF",CTy"Zeflags")),
      qVar"state"))
;
val write'AF_def = Def
  ("write'AF",bVar"b",
   Close
     (qVar"state",
      Apply
        (Call
           ("write'Eflag",ATy(qTy,qTy),TP[bVar"b",LC("Z_AF",CTy"Zeflags")]),
         qVar"state")))
;
val ZF_def = Def
  ("ZF",qVar"state",
   Apply
     (Call("Eflag",ATy(qTy,PTy(bTy,qTy)),LC("Z_ZF",CTy"Zeflags")),
      qVar"state"))
;
val write'ZF_def = Def
  ("write'ZF",bVar"b",
   Close
     (qVar"state",
      Apply
        (Call
           ("write'Eflag",ATy(qTy,qTy),TP[bVar"b",LC("Z_ZF",CTy"Zeflags")]),
         qVar"state")))
;
val SF_def = Def
  ("SF",qVar"state",
   Apply
     (Call("Eflag",ATy(qTy,PTy(bTy,qTy)),LC("Z_SF",CTy"Zeflags")),
      qVar"state"))
;
val write'SF_def = Def
  ("write'SF",bVar"b",
   Close
     (qVar"state",
      Apply
        (Call
           ("write'Eflag",ATy(qTy,qTy),TP[bVar"b",LC("Z_SF",CTy"Zeflags")]),
         qVar"state")))
;
val OF_def = Def
  ("OF",qVar"state",
   Apply
     (Call("Eflag",ATy(qTy,PTy(bTy,qTy)),LC("Z_OF",CTy"Zeflags")),
      qVar"state"))
;
val write'OF_def = Def
  ("write'OF",bVar"b",
   Close
     (qVar"state",
      Apply
        (Call
           ("write'Eflag",ATy(qTy,qTy),TP[bVar"b",LC("Z_OF",CTy"Zeflags")]),
         qVar"state")))
;
val ea_index_def = Def
  ("ea_index",Var("index",OTy(PTy(FTy 2,CTy"Zreg"))),
   Close
     (qVar"state",
      CS(Var("index",OTy(PTy(FTy 2,CTy"Zreg"))),
         [(LO(PTy(FTy 2,CTy"Zreg")),LW(0,64)),
          (Mop(Some,TP[Var("scale",FTy 2),Var("idx",CTy"Zreg")]),
           Bop(Mul,Bop(Lsl,LW(1,64),Mop(Cast nTy,Var("scale",FTy 2))),
               Apply
                 (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
                  Var("idx",CTy"Zreg"))))])))
;
val ea_base_def = Def
  ("ea_base",Var("base",CTy"Zbase"),
   Close
     (qVar"state",
      CS(Var("base",CTy"Zbase"),
         [(Const("ZnoBase",CTy"Zbase"),LW(0,64)),
          (Const("ZripBase",CTy"Zbase"),Dest("RIP",F64,qVar"state")),
          (Call("ZregBase",CTy"Zbase",Var("b",CTy"Zreg")),
           Apply
             (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
              Var("b",CTy"Zreg")))])))
;
val ea_Zrm_def = Def
  ("ea_Zrm",TP[Var("size",CTy"Zsize"),Var("rm",CTy"Zrm")],
   Close
     (qVar"state",
      CS(Var("rm",CTy"Zrm"),
         [(Call("Zr",CTy"Zrm",Var("r",CTy"Zreg")),
           Call
             ("Zea_r",CTy"Zea",
              TP[Var("size",CTy"Zsize"),Var("r",CTy"Zreg")])),
          (Call
             ("Zm",CTy"Zrm",
              TP[Var("index",OTy(PTy(FTy 2,CTy"Zreg"))),
                 Var("base",CTy"Zbase"),Var("displacement",F64)]),
           Call
             ("Zea_m",CTy"Zea",
              TP[Var("size",CTy"Zsize"),
                 Bop(Add,
                     Bop(Add,
                         Apply
                           (Call
                              ("ea_index",ATy(qTy,F64),
                               Var("index",OTy(PTy(FTy 2,CTy"Zreg")))),
                            qVar"state"),
                         Apply
                           (Call
                              ("ea_base",ATy(qTy,F64),
                               Var("base",CTy"Zbase")),qVar"state")),
                     Var("displacement",F64))]))])))
;
val ea_Zdest_def = Def
  ("ea_Zdest",TP[Var("size",CTy"Zsize"),Var("ds",CTy"Zdest_src")],
   Close
     (qVar"state",
      CS(Var("ds",CTy"Zdest_src"),
         [(Call("Zrm_i",CTy"Zdest_src",TP[Var("rm",CTy"Zrm"),AVar F64]),
           Apply
             (Call
                ("ea_Zrm",ATy(qTy,CTy"Zea"),
                 TP[Var("size",CTy"Zsize"),Var("rm",CTy"Zrm")]),
              qVar"state")),
          (Call
             ("Zrm_r",CTy"Zdest_src",
              TP[Var("rm",CTy"Zrm"),AVar(CTy"Zreg")]),
           Apply
             (Call
                ("ea_Zrm",ATy(qTy,CTy"Zea"),
                 TP[Var("size",CTy"Zsize"),Var("rm",CTy"Zrm")]),
              qVar"state")),
          (Call
             ("Zr_rm",CTy"Zdest_src",TP[Var("r",CTy"Zreg"),AVar(CTy"Zrm")]),
           Call
             ("Zea_r",CTy"Zea",
              TP[Var("size",CTy"Zsize"),Var("r",CTy"Zreg")]))])))
;
val ea_Zsrc_def = Def
  ("ea_Zsrc",TP[Var("size",CTy"Zsize"),Var("ds",CTy"Zdest_src")],
   Close
     (qVar"state",
      CS(Var("ds",CTy"Zdest_src"),
         [(Call("Zrm_i",CTy"Zdest_src",TP[AVar(CTy"Zrm"),Var("i",F64)]),
           Call("Zea_i",CTy"Zea",TP[Var("size",CTy"Zsize"),Var("i",F64)])),
          (Call
             ("Zrm_r",CTy"Zdest_src",TP[AVar(CTy"Zrm"),Var("r",CTy"Zreg")]),
           Call
             ("Zea_r",CTy"Zea",
              TP[Var("size",CTy"Zsize"),Var("r",CTy"Zreg")])),
          (Call
             ("Zr_rm",CTy"Zdest_src",
              TP[AVar(CTy"Zreg"),Var("rm",CTy"Zrm")]),
           Apply
             (Call
                ("ea_Zrm",ATy(qTy,CTy"Zea"),
                 TP[Var("size",CTy"Zsize"),Var("rm",CTy"Zrm")]),
              qVar"state"))])))
;
val ea_Zimm_rm_def = Def
  ("ea_Zimm_rm",TP[Var("size",CTy"Zsize"),Var("imm_rm",CTy"Zimm_rm")],
   Close
     (qVar"state",
      CS(Var("imm_rm",CTy"Zimm_rm"),
         [(Call("Zrm",CTy"Zimm_rm",Var("rm",CTy"Zrm")),
           Apply
             (Call
                ("ea_Zrm",ATy(qTy,CTy"Zea"),
                 TP[Var("size",CTy"Zsize"),Var("rm",CTy"Zrm")]),
              qVar"state")),
          (Call("Zimm",CTy"Zimm_rm",Var("imm",F64)),
           Call
             ("Zea_i",CTy"Zea",TP[Var("size",CTy"Zsize"),Var("imm",F64)]))])))
;
val restrictSize_def = Def
  ("restrictSize",TP[Var("size",CTy"Zsize"),Var("imm",F64)],
   CS(Var("size",CTy"Zsize"),
      [(Call("Z8",CTy"Zsize",AVar bTy),Bop(BAnd,Var("imm",F64),LW(255,64))),
       (Const("Z16",CTy"Zsize"),Bop(BAnd,Var("imm",F64),LW(65535,64))),
       (Const("Z32",CTy"Zsize"),Bop(BAnd,Var("imm",F64),LW(4294967295,64))),
       (Const("Z64",CTy"Zsize"),Var("imm",F64))]))
;
val EA_def = Def
  ("EA",Var("ea",CTy"Zea"),
   Close
     (qVar"state",
      CS(Var("ea",CTy"Zea"),
         [(Call("Zea_i",CTy"Zea",Var("i",PTy(CTy"Zsize",F64))),
           Call("restrictSize",F64,Var("i",PTy(CTy"Zsize",F64)))),
          (Call
             ("Zea_r",CTy"Zea",
              TP[Call("Z8",CTy"Zsize",bVar"have_rex"),Var("r",CTy"Zreg")]),
           Bop(BAnd,
               ITE(Bop(Or,bVar"have_rex",
                       Mop(Not,
                           Bop(In,Var("r",CTy"Zreg"),
                               SL[LC("RSP",CTy"Zreg"),LC("RBP",CTy"Zreg"),
                                  LC("RSI",CTy"Zreg"),LC("RDI",CTy"Zreg")]))),
                   Apply
                     (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
                      Var("r",CTy"Zreg")),
                   Bop(Lsr,
                       Apply
                         (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
                          Mop(Cast(CTy"Zreg"),
                              Bop(Sub,Mop(Cast nTy,Var("r",CTy"Zreg")),
                                  LN 4))),LN 8)),LW(255,64))),
          (Call
             ("Zea_r",CTy"Zea",TP[Var("s",CTy"Zsize"),Var("r",CTy"Zreg")]),
           Call
             ("restrictSize",F64,
              TP[Var("s",CTy"Zsize"),
                 Apply
                   (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
                    Var("r",CTy"Zreg"))])),
          (Call
             ("Zea_m",CTy"Zea",
              TP[Call("Z8",CTy"Zsize",AVar bTy),Var("a",F64)]),
           Mop(Cast F64,
               Apply(Call("mem8",ATy(qTy,F8),Var("a",F64)),qVar"state"))),
          (Call("Zea_m",CTy"Zea",TP[Const("Z16",CTy"Zsize"),Var("a",F64)]),
           Mop(Cast F64,
               Apply(Call("mem16",ATy(qTy,F16),Var("a",F64)),qVar"state"))),
          (Call("Zea_m",CTy"Zea",TP[Const("Z32",CTy"Zsize"),Var("a",F64)]),
           Mop(Cast F64,
               Apply(Call("mem32",ATy(qTy,F32),Var("a",F64)),qVar"state"))),
          (Call("Zea_m",CTy"Zea",TP[Const("Z64",CTy"Zsize"),Var("a",F64)]),
           Apply(Call("mem64",ATy(qTy,F64),Var("a",F64)),qVar"state"))])))
;
val write'EA_def = Def
  ("write'EA",TP[Var("w",F64),Var("ea",CTy"Zea")],
   Close
     (qVar"state",
      CS(Var("ea",CTy"Zea"),
         [(Call("Zea_i",CTy"Zea",Var("i",PTy(CTy"Zsize",F64))),
           Mop(Snd,
               Apply
                 (Call
                    ("raise'exception",ATy(qTy,PTy(uTy,qTy)),
                     Call("FAILURE",CTy"exception",LS"write to constant")),
                  qVar"state"))),
          (Call
             ("Zea_r",CTy"Zea",
              TP[Call("Z8",CTy"Zsize",bVar"have_rex"),Var("r",CTy"Zreg")]),
           ITE(Bop(Or,bVar"have_rex",
                   Mop(Not,
                       Bop(In,Var("r",CTy"Zreg"),
                           SL[LC("RSP",CTy"Zreg"),LC("RBP",CTy"Zreg"),
                              LC("RSI",CTy"Zreg"),LC("RDI",CTy"Zreg")]))),
               Rupd
                 ("REG",
                  TP[qVar"state",
                     Fupd
                       (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
                        Var("r",CTy"Zreg"),
                        BFI(LN 7,LN 0,EX(Var("w",F64),LN 7,LN 0,F8),
                            Apply
                              (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
                               Var("r",CTy"Zreg"))))]),
               Let(Var("x",CTy"Zreg"),
                   Mop(Cast(CTy"Zreg"),
                       Bop(Sub,Mop(Cast nTy,Var("r",CTy"Zreg")),LN 4)),
                   Rupd
                     ("REG",
                      TP[qVar"state",
                         Fupd
                           (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
                            Var("x",CTy"Zreg"),
                            BFI(LN 15,LN 8,EX(Var("w",F64),LN 7,LN 0,F8),
                                Apply
                                  (Dest
                                     ("REG",ATy(CTy"Zreg",F64),qVar"state"),
                                   Var("x",CTy"Zreg"))))])))),
          (Call
             ("Zea_r",CTy"Zea",
              TP[Const("Z16",CTy"Zsize"),Var("r",CTy"Zreg")]),
           Rupd
             ("REG",
              TP[qVar"state",
                 Fupd
                   (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
                    Var("r",CTy"Zreg"),
                    BFI(LN 15,LN 0,EX(Var("w",F64),LN 15,LN 0,F16),
                        Apply
                          (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
                           Var("r",CTy"Zreg"))))])),
          (Call
             ("Zea_r",CTy"Zea",
              TP[Const("Z32",CTy"Zsize"),Var("r",CTy"Zreg")]),
           Rupd
             ("REG",
              TP[qVar"state",
                 Fupd
                   (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
                    Var("r",CTy"Zreg"),
                    Mop(Cast F64,EX(Var("w",F64),LN 31,LN 0,F32)))])),
          (Call
             ("Zea_r",CTy"Zea",
              TP[Const("Z64",CTy"Zsize"),Var("r",CTy"Zreg")]),
           Rupd
             ("REG",
              TP[qVar"state",
                 Fupd
                   (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
                    Var("r",CTy"Zreg"),Var("w",F64))])),
          (Call
             ("Zea_m",CTy"Zea",
              TP[Call("Z8",CTy"Zsize",AVar bTy),Var("a",F64)]),
           Apply
             (Call
                ("write'mem8",ATy(qTy,qTy),
                 TP[EX(Var("w",F64),LN 7,LN 0,F8),Var("a",F64)]),
              qVar"state")),
          (Call("Zea_m",CTy"Zea",TP[Const("Z16",CTy"Zsize"),Var("a",F64)]),
           Apply
             (Call
                ("write'mem16",ATy(qTy,qTy),
                 TP[EX(Var("w",F64),LN 15,LN 0,F16),Var("a",F64)]),
              qVar"state")),
          (Call("Zea_m",CTy"Zea",TP[Const("Z32",CTy"Zsize"),Var("a",F64)]),
           Apply
             (Call
                ("write'mem32",ATy(qTy,qTy),
                 TP[EX(Var("w",F64),LN 31,LN 0,F32),Var("a",F64)]),
              qVar"state")),
          (Call("Zea_m",CTy"Zea",TP[Const("Z64",CTy"Zsize"),Var("a",F64)]),
           Apply
             (Call
                ("write'mem64",ATy(qTy,qTy),TP[Var("w",F64),Var("a",F64)]),
              qVar"state"))])))
;
val read_dest_src_ea_def = Def
  ("read_dest_src_ea",Var("sd",PTy(CTy"Zsize",CTy"Zdest_src")),
   Close
     (qVar"state",
      Let(Var("v",CTy"Zea"),
          Apply
            (Call
               ("ea_Zdest",ATy(qTy,CTy"Zea"),
                Var("sd",PTy(CTy"Zsize",CTy"Zdest_src"))),qVar"state"),
          TP[Var("v",CTy"Zea"),
             Apply(Call("EA",ATy(qTy,F64),Var("v",CTy"Zea")),qVar"state"),
             Apply
               (Call
                  ("EA",ATy(qTy,F64),
                   Apply
                     (Call
                        ("ea_Zsrc",ATy(qTy,CTy"Zea"),
                         Var("sd",PTy(CTy"Zsize",CTy"Zdest_src"))),
                      qVar"state")),qVar"state")])))
;
val call_dest_from_ea_def = Def
  ("call_dest_from_ea",Var("ea",CTy"Zea"),
   Close
     (qVar"state",
      CS(Var("ea",CTy"Zea"),
         [(Call("Zea_i",CTy"Zea",TP[AVar(CTy"Zsize"),Var("i",F64)]),
           Bop(Add,Dest("RIP",F64,qVar"state"),Var("i",F64))),
          (Call("Zea_r",CTy"Zea",TP[AVar(CTy"Zsize"),Var("r",CTy"Zreg")]),
           Apply
             (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
              Var("r",CTy"Zreg"))),
          (Call("Zea_m",CTy"Zea",TP[AVar(CTy"Zsize"),Var("a",F64)]),
           Apply(Call("mem64",ATy(qTy,F64),Var("a",F64)),qVar"state"))])))
;
val get_ea_address_def = Def
  ("get_ea_address",Var("ea",CTy"Zea"),
   CS(Var("ea",CTy"Zea"),
      [(Call("Zea_i",CTy"Zea",TP[AVar(CTy"Zsize"),Var("i",F64)]),LW(0,64)),
       (Call("Zea_r",CTy"Zea",TP[AVar(CTy"Zsize"),Var("r",CTy"Zreg")]),
        LW(0,64)),
       (Call("Zea_m",CTy"Zea",TP[AVar(CTy"Zsize"),Var("a",F64)]),
        Var("a",F64))]))
;
val jump_to_ea_def = Def
  ("jump_to_ea",Var("ea",CTy"Zea"),
   Close
     (qVar"state",
      Rupd
        ("RIP",
         TP[qVar"state",
            Apply
              (Call("call_dest_from_ea",ATy(qTy,F64),Var("ea",CTy"Zea")),
               qVar"state")])))
;
val ByteParity_def = Def
  ("ByteParity",Var("b",F8),
   EQ(Bop(Mod,
          Bop(Add,
              Bop(Add,
                  Bop(Add,
                      Bop(Add,
                          Bop(Add,
                              Bop(Add,
                                  Bop(Add,
                                      Mop(Cast nTy,
                                          Bop(Bit,Var("b",F8),LN 7)),
                                      Mop(Cast nTy,
                                          Bop(Bit,Var("b",F8),LN 6))),
                                  Mop(Cast nTy,Bop(Bit,Var("b",F8),LN 5))),
                              Mop(Cast nTy,Bop(Bit,Var("b",F8),LN 4))),
                          Mop(Cast nTy,Bop(Bit,Var("b",F8),LN 3))),
                      Mop(Cast nTy,Bop(Bit,Var("b",F8),LN 2))),
                  Mop(Cast nTy,Bop(Bit,Var("b",F8),LN 1))),
              Mop(Cast nTy,Bop(Bit,Var("b",F8),LN 0))),LN 2),LN 0))
;
val Zsize_width_def = Def
  ("Zsize_width",Var("size",CTy"Zsize"),
   CS(Var("size",CTy"Zsize"),
      [(Call("Z8",CTy"Zsize",AVar bTy),LN 8),
       (Const("Z16",CTy"Zsize"),LN 16),(Const("Z32",CTy"Zsize"),LN 32),
       (Const("Z64",CTy"Zsize"),LN 64)]))
;
val word_size_msb_def = Def
  ("word_size_msb",TP[Var("size",CTy"Zsize"),Var("w",F64)],
   Bop(Bit,Var("w",F64),
       Bop(Sub,Call("Zsize_width",nTy,Var("size",CTy"Zsize")),LN 1)))
;
val write_PF_def = Def
  ("write_PF",Var("w",F64),
   Close
     (qVar"state",
      Apply
        (Call
           ("write'PF",ATy(qTy,qTy),
            Call("ByteParity",bTy,EX(Var("w",F64),LN 7,LN 0,F8))),
         qVar"state")))
;
val write_SF_def = Def
  ("write_SF",Var("s_w",PTy(CTy"Zsize",F64)),
   Close
     (qVar"state",
      Apply
        (Call
           ("write'SF",ATy(qTy,qTy),
            Call("word_size_msb",bTy,Var("s_w",PTy(CTy"Zsize",F64)))),
         qVar"state")))
;
val write_ZF_def = Def
  ("write_ZF",TP[Var("size",CTy"Zsize"),Var("w",F64)],
   Close
     (qVar"state",
      Apply
        (Call
           ("write'ZF",ATy(qTy,qTy),
            CS(Var("size",CTy"Zsize"),
               [(Call("Z8",CTy"Zsize",AVar bTy),
                 EQ(Mop(Cast F8,Var("w",F64)),LW(0,8))),
                (Const("Z16",CTy"Zsize"),
                 EQ(Mop(Cast F16,Var("w",F64)),LW(0,16))),
                (Const("Z32",CTy"Zsize"),
                 EQ(Mop(Cast F32,Var("w",F64)),LW(0,32))),
                (Const("Z64",CTy"Zsize"),EQ(Var("w",F64),LW(0,64)))])),
         qVar"state")))
;
val write_logical_eflags_def = Def
  ("write_logical_eflags",TP[Var("size",CTy"Zsize"),Var("w",F64)],
   Close
     (qVar"state",
      Apply
        (Call("FlagUnspecified",ATy(qTy,qTy),LC("Z_AF",CTy"Zeflags")),
         Apply
           (Call
              ("write_ZF",ATy(qTy,qTy),
               TP[Var("size",CTy"Zsize"),Var("w",F64)]),
            Apply
              (Call
                 ("write_SF",ATy(qTy,qTy),
                  TP[Var("size",CTy"Zsize"),Var("w",F64)]),
               Apply
                 (Call("write_PF",ATy(qTy,qTy),Var("w",F64)),
                  Apply
                    (Call("write'OF",ATy(qTy,qTy),LF),
                     Apply(Call("write'CF",ATy(qTy,qTy),LF),qVar"state"))))))))
;
val write_arith_eflags_except_CF_OF_def = Def
  ("write_arith_eflags_except_CF_OF",
   TP[Var("size",CTy"Zsize"),Var("w",F64)],
   Close
     (qVar"state",
      Apply
        (Call("FlagUnspecified",ATy(qTy,qTy),LC("Z_AF",CTy"Zeflags")),
         Apply
           (Call
              ("write_ZF",ATy(qTy,qTy),
               TP[Var("size",CTy"Zsize"),Var("w",F64)]),
            Apply
              (Call
                 ("write_SF",ATy(qTy,qTy),
                  TP[Var("size",CTy"Zsize"),Var("w",F64)]),
               Apply
                 (Call("write_PF",ATy(qTy,qTy),Var("w",F64)),qVar"state"))))))
;
val write_arith_eflags_def = Def
  ("write_arith_eflags",
   TP[Var("size",CTy"Zsize"),Var("r",PTy(F64,PTy(bTy,bTy)))],
   Close
     (qVar"state",
      Let(TP[Var("w",F64),bVar"c",bVar"x"],Var("r",PTy(F64,PTy(bTy,bTy))),
          Apply
            (Call
               ("write_arith_eflags_except_CF_OF",ATy(qTy,qTy),
                TP[Var("size",CTy"Zsize"),Var("w",F64)]),
             Apply
               (Call("write'OF",ATy(qTy,qTy),bVar"x"),
                Apply(Call("write'CF",ATy(qTy,qTy),bVar"c"),qVar"state"))))))
;
val erase_eflags_def = Def
  ("erase_eflags",qVar"state",
   Rupd("EFLAGS",TP[qVar"state",Mop(K1(CTy"Zeflags"),LO bTy)]))
;
val value_width_def = Def
  ("value_width",Var("s",CTy"Zsize"),
   Bop(Exp,LN 2,Call("Zsize_width",nTy,Var("s",CTy"Zsize"))))
;
val word_signed_overflow_add_def = Def
  ("word_signed_overflow_add",
   TP[Var("size",CTy"Zsize"),Var("a",F64),Var("b",F64)],
   Bop(And,
       EQ(Call
            ("word_size_msb",bTy,TP[Var("size",CTy"Zsize"),Var("a",F64)]),
          Call
            ("word_size_msb",bTy,TP[Var("size",CTy"Zsize"),Var("b",F64)])),
       Mop(Not,
           EQ(Call
                ("word_size_msb",bTy,
                 TP[Var("size",CTy"Zsize"),
                    Bop(Add,Var("a",F64),Var("b",F64))]),
              Call
                ("word_size_msb",bTy,
                 TP[Var("size",CTy"Zsize"),Var("a",F64)])))))
;
val word_signed_overflow_sub_def = Def
  ("word_signed_overflow_sub",
   TP[Var("size",CTy"Zsize"),Var("a",F64),Var("b",F64)],
   Bop(And,
       Mop(Not,
           EQ(Call
                ("word_size_msb",bTy,
                 TP[Var("size",CTy"Zsize"),Var("a",F64)]),
              Call
                ("word_size_msb",bTy,
                 TP[Var("size",CTy"Zsize"),Var("b",F64)]))),
       Mop(Not,
           EQ(Call
                ("word_size_msb",bTy,
                 TP[Var("size",CTy"Zsize"),
                    Bop(Sub,Var("a",F64),Var("b",F64))]),
              Call
                ("word_size_msb",bTy,
                 TP[Var("size",CTy"Zsize"),Var("a",F64)])))))
;
val add_with_carry_out_def = Def
  ("add_with_carry_out",
   TP[Var("size",CTy"Zsize"),Var("x",F64),Var("y",F64)],
   TP[Bop(Add,Var("x",F64),Var("y",F64)),
      Bop(Le,Call("value_width",nTy,Var("size",CTy"Zsize")),
          Bop(Add,Mop(Cast nTy,Var("x",F64)),Mop(Cast nTy,Var("y",F64)))),
      Call
        ("word_signed_overflow_add",bTy,
         TP[Var("size",CTy"Zsize"),Var("x",F64),Var("y",F64)])])
;
val sub_with_borrow_def = Def
  ("sub_with_borrow",TP[Var("size",CTy"Zsize"),Var("x",F64),Var("y",F64)],
   TP[Bop(Sub,Var("x",F64),Var("y",F64)),
      Bop(Ult,Var("x",F64),Var("y",F64)),
      Call
        ("word_signed_overflow_sub",bTy,
         TP[Var("size",CTy"Zsize"),Var("x",F64),Var("y",F64)])])
;
val write_arith_result_def = Def
  ("write_arith_result",
   TP[Var("size",CTy"Zsize"),Var("r",PTy(F64,PTy(bTy,bTy))),
      Var("ea",CTy"Zea")],
   Close
     (qVar"state",
      Apply
        (Call
           ("write'EA",ATy(qTy,qTy),
            TP[Mop(Fst,Var("r",PTy(F64,PTy(bTy,bTy)))),Var("ea",CTy"Zea")]),
         Apply
           (Call
              ("write_arith_eflags",ATy(qTy,qTy),
               TP[Var("size",CTy"Zsize"),Var("r",PTy(F64,PTy(bTy,bTy)))]),
            qVar"state"))))
;
val write_arith_result_no_CF_OF_def = Def
  ("write_arith_result_no_CF_OF",
   TP[Var("size",CTy"Zsize"),Var("w",F64),Var("ea",CTy"Zea")],
   Close
     (qVar"state",
      Apply
        (Call("write'EA",ATy(qTy,qTy),TP[Var("w",F64),Var("ea",CTy"Zea")]),
         Apply
           (Call
              ("write_arith_eflags_except_CF_OF",ATy(qTy,qTy),
               TP[Var("size",CTy"Zsize"),Var("w",F64)]),qVar"state"))))
;
val write_logical_result_def = Def
  ("write_logical_result",
   TP[Var("size",CTy"Zsize"),Var("w",F64),Var("ea",CTy"Zea")],
   Close
     (qVar"state",
      Apply
        (Call("write'EA",ATy(qTy,qTy),TP[Var("w",F64),Var("ea",CTy"Zea")]),
         Apply
           (Call
              ("write_logical_eflags",ATy(qTy,qTy),
               TP[Var("size",CTy"Zsize"),Var("w",F64)]),qVar"state"))))
;
val write_result_erase_eflags_def = Def
  ("write_result_erase_eflags",TP[Var("w",F64),Var("ea",CTy"Zea")],
   Close
     (qVar"state",
      Apply
        (Call("write'EA",ATy(qTy,qTy),TP[Var("w",F64),Var("ea",CTy"Zea")]),
         Apply(Const("erase_eflags",ATy(qTy,qTy)),qVar"state"))))
;
val SignExtension_def = Def
  ("SignExtension",
   TP[Var("w",F64),Var("size1",CTy"Zsize"),Var("size2",CTy"Zsize")],
   Close
     (qVar"state",
      Let(TP[Var("r",F64),Var("s1",PTy(F64,qTy))],
          Let(Var("s",PTy(F64,qTy)),
              CS(TP[Var("size1",CTy"Zsize"),Var("size2",CTy"Zsize")],
                 [(TP[Call("Z8",CTy"Zsize",AVar bTy),
                      Const("Z16",CTy"Zsize")],
                   TP[BFI(LN 15,LN 0,
                          Mop(SE F16,EX(Var("w",F64),LN 7,LN 0,F8)),
                          Var("w",F64)),qVar"state"]),
                  (TP[Call("Z8",CTy"Zsize",AVar bTy),
                      Const("Z32",CTy"Zsize")],
                   TP[BFI(LN 31,LN 0,
                          Mop(SE F32,EX(Var("w",F64),LN 7,LN 0,F8)),
                          Var("w",F64)),qVar"state"]),
                  (TP[Call("Z8",CTy"Zsize",AVar bTy),
                      Const("Z64",CTy"Zsize")],
                   TP[Mop(SE F64,EX(Var("w",F64),LN 7,LN 0,F8)),
                      qVar"state"]),
                  (TP[Const("Z16",CTy"Zsize"),Const("Z32",CTy"Zsize")],
                   TP[BFI(LN 31,LN 0,
                          Mop(SE F32,EX(Var("w",F64),LN 15,LN 0,F16)),
                          Var("w",F64)),qVar"state"]),
                  (TP[Const("Z16",CTy"Zsize"),Const("Z64",CTy"Zsize")],
                   TP[Mop(SE F64,EX(Var("w",F64),LN 15,LN 0,F16)),
                      qVar"state"]),
                  (TP[Const("Z32",CTy"Zsize"),Const("Z64",CTy"Zsize")],
                   TP[Mop(SE F64,EX(Var("w",F64),LN 31,LN 0,F32)),
                      qVar"state"]),
                  (AVar(PTy(CTy"Zsize",CTy"Zsize")),
                   TP[Var("w",F64),
                      Mop(Snd,
                          Apply
                            (Call
                               ("raise'exception",ATy(qTy,PTy(uTy,qTy)),
                                Call
                                  ("FAILURE",CTy"exception",
                                   LS"SignExtension")),qVar"state"))])]),
              TP[Mop(Fst,Var("s",PTy(F64,qTy))),Var("s",PTy(F64,qTy))]),
          TP[Var("r",F64),Mop(Snd,Var("s1",PTy(F64,qTy)))])))
;
val maskShift_def = Def
  ("maskShift",TP[Var("size",CTy"Zsize"),Var("w",F64)],
   ITE(EQ(Var("size",CTy"Zsize"),Const("Z64",CTy"Zsize")),
       Mop(Cast nTy,EX(Var("w",F64),LN 5,LN 0,FTy 6)),
       Mop(Cast nTy,EX(Var("w",F64),LN 4,LN 0,FTy 5))))
;
val ROL_def = Def
  ("ROL",TP[Var("size",CTy"Zsize"),Var("x",F64),Var("y",F64)],
   CS(Var("size",CTy"Zsize"),
      [(Call("Z8",CTy"Zsize",AVar bTy),
        Mop(Cast F64,
            Bop(Rol,EX(Var("x",F64),LN 7,LN 0,F8),
                Mop(Cast nTy,EX(Var("y",F64),LN 4,LN 0,FTy 5))))),
       (Const("Z16",CTy"Zsize"),
        Mop(Cast F64,
            Bop(Rol,EX(Var("x",F64),LN 15,LN 0,F16),
                Mop(Cast nTy,EX(Var("y",F64),LN 4,LN 0,FTy 5))))),
       (Const("Z32",CTy"Zsize"),
        Mop(Cast F64,
            Bop(Rol,EX(Var("x",F64),LN 31,LN 0,F32),
                Mop(Cast nTy,EX(Var("y",F64),LN 4,LN 0,FTy 5))))),
       (Const("Z64",CTy"Zsize"),
        Bop(Rol,Var("x",F64),
            Mop(Cast nTy,EX(Var("y",F64),LN 5,LN 0,FTy 6))))]))
;
val ROR_def = Def
  ("ROR",TP[Var("size",CTy"Zsize"),Var("x",F64),Var("y",F64)],
   CS(Var("size",CTy"Zsize"),
      [(Call("Z8",CTy"Zsize",AVar bTy),
        Mop(Cast F64,
            Bop(Ror,EX(Var("x",F64),LN 7,LN 0,F8),
                Mop(Cast nTy,EX(Var("y",F64),LN 4,LN 0,FTy 5))))),
       (Const("Z16",CTy"Zsize"),
        Mop(Cast F64,
            Bop(Ror,EX(Var("x",F64),LN 15,LN 0,F16),
                Mop(Cast nTy,EX(Var("y",F64),LN 4,LN 0,FTy 5))))),
       (Const("Z32",CTy"Zsize"),
        Mop(Cast F64,
            Bop(Ror,EX(Var("x",F64),LN 31,LN 0,F32),
                Mop(Cast nTy,EX(Var("y",F64),LN 4,LN 0,FTy 5))))),
       (Const("Z64",CTy"Zsize"),
        Bop(Ror,Var("x",F64),
            Mop(Cast nTy,EX(Var("y",F64),LN 5,LN 0,FTy 6))))]))
;
val SAR_def = Def
  ("SAR",TP[Var("size",CTy"Zsize"),Var("x",F64),Var("y",F64)],
   CS(Var("size",CTy"Zsize"),
      [(Call("Z8",CTy"Zsize",AVar bTy),
        Mop(Cast F64,
            Bop(Asr,EX(Var("x",F64),LN 7,LN 0,F8),
                Mop(Cast nTy,EX(Var("y",F64),LN 4,LN 0,FTy 5))))),
       (Const("Z16",CTy"Zsize"),
        Mop(Cast F64,
            Bop(Asr,EX(Var("x",F64),LN 15,LN 0,F16),
                Mop(Cast nTy,EX(Var("y",F64),LN 4,LN 0,FTy 5))))),
       (Const("Z32",CTy"Zsize"),
        Mop(Cast F64,
            Bop(Asr,EX(Var("x",F64),LN 31,LN 0,F32),
                Mop(Cast nTy,EX(Var("y",F64),LN 4,LN 0,FTy 5))))),
       (Const("Z64",CTy"Zsize"),
        Bop(Asr,Var("x",F64),
            Mop(Cast nTy,EX(Var("y",F64),LN 5,LN 0,FTy 6))))]))
;
val write_binop_def = Def
  ("write_binop",
   TP[Var("s",CTy"Zsize"),Var("bop",CTy"Zbinop_name"),Var("x",F64),
      Var("y",F64),Var("ea",CTy"Zea")],
   Close
     (qVar"state",
      CS(Var("bop",CTy"Zbinop_name"),
         [(LC("Zadd",CTy"Zbinop_name"),
           Apply
             (Call
                ("write_arith_result",ATy(qTy,qTy),
                 TP[Var("s",CTy"Zsize"),
                    Call
                      ("add_with_carry_out",PTy(F64,PTy(bTy,bTy)),
                       TP[Var("s",CTy"Zsize"),Var("x",F64),Var("y",F64)]),
                    Var("ea",CTy"Zea")]),qVar"state")),
          (LC("Zsub",CTy"Zbinop_name"),
           Apply
             (Call
                ("write_arith_result",ATy(qTy,qTy),
                 TP[Var("s",CTy"Zsize"),
                    Call
                      ("sub_with_borrow",PTy(F64,PTy(bTy,bTy)),
                       TP[Var("s",CTy"Zsize"),Var("x",F64),Var("y",F64)]),
                    Var("ea",CTy"Zea")]),qVar"state")),
          (LC("Zcmp",CTy"Zbinop_name"),
           Apply
             (Call
                ("write_arith_eflags",ATy(qTy,qTy),
                 TP[Var("s",CTy"Zsize"),
                    Call
                      ("sub_with_borrow",PTy(F64,PTy(bTy,bTy)),
                       TP[Var("s",CTy"Zsize"),Var("x",F64),Var("y",F64)])]),
              qVar"state")),
          (LC("Ztest",CTy"Zbinop_name"),
           Apply
             (Call
                ("write_logical_eflags",ATy(qTy,qTy),
                 TP[Var("s",CTy"Zsize"),
                    Bop(BAnd,Var("x",F64),Var("y",F64))]),qVar"state")),
          (LC("Zand",CTy"Zbinop_name"),
           Apply
             (Call
                ("write_logical_result",ATy(qTy,qTy),
                 TP[Var("s",CTy"Zsize"),
                    Bop(BAnd,Var("x",F64),Var("y",F64)),Var("ea",CTy"Zea")]),
              qVar"state")),
          (LC("Zxor",CTy"Zbinop_name"),
           Apply
             (Call
                ("write_logical_result",ATy(qTy,qTy),
                 TP[Var("s",CTy"Zsize"),
                    Bop(BXor,Var("x",F64),Var("y",F64)),Var("ea",CTy"Zea")]),
              qVar"state")),
          (LC("Zor",CTy"Zbinop_name"),
           Apply
             (Call
                ("write_logical_result",ATy(qTy,qTy),
                 TP[Var("s",CTy"Zsize"),
                    Bop(BOr,Var("x",F64),Var("y",F64)),Var("ea",CTy"Zea")]),
              qVar"state")),
          (LC("Zrol",CTy"Zbinop_name"),
           Apply
             (Call
                ("write_result_erase_eflags",ATy(qTy,qTy),
                 TP[Call
                      ("ROL",F64,
                       TP[Var("s",CTy"Zsize"),Var("x",F64),Var("y",F64)]),
                    Var("ea",CTy"Zea")]),qVar"state")),
          (LC("Zror",CTy"Zbinop_name"),
           Apply
             (Call
                ("write_result_erase_eflags",ATy(qTy,qTy),
                 TP[Call
                      ("ROR",F64,
                       TP[Var("s",CTy"Zsize"),Var("x",F64),Var("y",F64)]),
                    Var("ea",CTy"Zea")]),qVar"state")),
          (LC("Zsar",CTy"Zbinop_name"),
           Apply
             (Call
                ("write_result_erase_eflags",ATy(qTy,qTy),
                 TP[Call
                      ("SAR",F64,
                       TP[Var("s",CTy"Zsize"),Var("x",F64),Var("y",F64)]),
                    Var("ea",CTy"Zea")]),qVar"state")),
          (LC("Zshl",CTy"Zbinop_name"),
           Apply
             (Call
                ("write_result_erase_eflags",ATy(qTy,qTy),
                 TP[Bop(Lsl,Var("x",F64),
                        Call
                          ("maskShift",nTy,
                           TP[Var("s",CTy"Zsize"),Var("y",F64)])),
                    Var("ea",CTy"Zea")]),qVar"state")),
          (LC("Zshr",CTy"Zbinop_name"),
           Apply
             (Call
                ("write_result_erase_eflags",ATy(qTy,qTy),
                 TP[Bop(Lsr,Var("x",F64),
                        Call
                          ("maskShift",nTy,
                           TP[Var("s",CTy"Zsize"),Var("y",F64)])),
                    Var("ea",CTy"Zea")]),qVar"state")),
          (LC("Zadc",CTy"Zbinop_name"),
           Let(TP[bVar"v",qVar"s0"],
               Apply(Const("CF",ATy(qTy,PTy(bTy,qTy))),qVar"state"),
               Apply
                 (Call
                    ("write_arith_result_no_CF_OF",ATy(qTy,qTy),
                     TP[Var("s",CTy"Zsize"),
                        Bop(Add,Bop(Add,Var("x",F64),Var("y",F64)),
                            Mop(Cast F64,bVar"v")),Var("ea",CTy"Zea")]),
                  Apply
                    (Call
                       ("FlagUnspecified",ATy(qTy,qTy),
                        LC("Z_OF",CTy"Zeflags")),
                     Apply
                       (Call
                          ("write'CF",ATy(qTy,qTy),
                           Bop(Le,
                               Call("value_width",nTy,Var("s",CTy"Zsize")),
                               Bop(Add,
                                   Bop(Add,Mop(Cast nTy,Var("x",F64)),
                                       Mop(Cast nTy,Var("y",F64))),
                                   Mop(Cast nTy,bVar"v")))),qVar"s0"))))),
          (LC("Zsbb",CTy"Zbinop_name"),
           Let(TP[bVar"v",qVar"s0"],
               Apply(Const("CF",ATy(qTy,PTy(bTy,qTy))),qVar"state"),
               Apply
                 (Call
                    ("write_arith_result_no_CF_OF",ATy(qTy,qTy),
                     TP[Var("s",CTy"Zsize"),
                        Bop(Sub,Var("x",F64),
                            Bop(Add,Var("y",F64),Mop(Cast F64,bVar"v"))),
                        Var("ea",CTy"Zea")]),
                  Apply
                    (Call
                       ("FlagUnspecified",ATy(qTy,qTy),
                        LC("Z_OF",CTy"Zeflags")),
                     Apply
                       (Call
                          ("write'CF",ATy(qTy,qTy),
                           Bop(Lt,Mop(Cast nTy,Var("x",F64)),
                               Bop(Add,Mop(Cast nTy,Var("y",F64)),
                                   Mop(Cast nTy,bVar"v")))),qVar"s0"))))),
          (AVar(CTy"Zbinop_name"),
           Mop(Snd,
               Apply
                 (Call
                    ("raise'exception",ATy(qTy,PTy(uTy,qTy)),
                     Call
                       ("FAILURE",CTy"exception",
                        CC[LS"Binary op not implemented: ",
                           Mop(Cast sTy,Var("bop",CTy"Zbinop_name"))])),
                  qVar"state")))])))
;
val write_monop_def = Def
  ("write_monop",
   TP[Var("s",CTy"Zsize"),Var("mop",CTy"Zmonop_name"),Var("x",F64),
      Var("ea",CTy"Zea")],
   Close
     (qVar"state",
      CS(Var("mop",CTy"Zmonop_name"),
         [(LC("Znot",CTy"Zmonop_name"),
           Apply
             (Call
                ("write'EA",ATy(qTy,qTy),
                 TP[Mop(BNot,Var("x",F64)),Var("ea",CTy"Zea")]),
              qVar"state")),
          (LC("Zdec",CTy"Zmonop_name"),
           Apply
             (Call
                ("write_arith_result_no_CF_OF",ATy(qTy,qTy),
                 TP[Var("s",CTy"Zsize"),Bop(Sub,Var("x",F64),LW(1,64)),
                    Var("ea",CTy"Zea")]),qVar"state")),
          (LC("Zinc",CTy"Zmonop_name"),
           Apply
             (Call
                ("write_arith_result_no_CF_OF",ATy(qTy,qTy),
                 TP[Var("s",CTy"Zsize"),Bop(Add,Var("x",F64),LW(1,64)),
                    Var("ea",CTy"Zea")]),qVar"state")),
          (LC("Zneg",CTy"Zmonop_name"),
           Apply
             (Call("FlagUnspecified",ATy(qTy,qTy),LC("Z_CF",CTy"Zeflags")),
              Apply
                (Call
                   ("write_arith_result_no_CF_OF",ATy(qTy,qTy),
                    TP[Var("s",CTy"Zsize"),Mop(Neg,Var("x",F64)),
                       Var("ea",CTy"Zea")]),qVar"state")))])))
;
val read_cond_def = Def
  ("read_cond",Var("c",CTy"Zcond"),
   Close
     (qVar"state",
      CS(Var("c",CTy"Zcond"),
         [(LC("Z_A",CTy"Zcond"),
           CS(TP[Apply
                   (Dest("EFLAGS",ATy(CTy"Zeflags",OTy bTy),qVar"state"),
                    LC("Z_CF",CTy"Zeflags")),
                 Apply
                   (Dest("EFLAGS",ATy(CTy"Zeflags",OTy bTy),qVar"state"),
                    LC("Z_ZF",CTy"Zeflags"))],
              [(TP[Mop(Some,LF),Mop(Some,LF)],TP[LT,qVar"state"]),
               (TP[Mop(Some,LT),AVar(OTy bTy)],TP[LF,qVar"state"]),
               (TP[AVar(OTy bTy),Mop(Some,LT)],TP[LF,qVar"state"]),
               (AVar(PTy(OTy bTy,OTy bTy)),
                Apply
                  (Call
                     ("raise'exception",ATy(qTy,PTy(bTy,qTy)),
                      Call
                        ("BadFlagAccess",CTy"exception",
                         CC[LS"read_cond: ",
                            Mop(Cast sTy,Var("c",CTy"Zcond"))])),
                   qVar"state"))])),
          (LC("Z_NB",CTy"Zcond"),
           Let(TP[bVar"v",qVar"s"],
               Apply(Const("CF",ATy(qTy,PTy(bTy,qTy))),qVar"state"),
               TP[Mop(Not,bVar"v"),qVar"s"])),
          (LC("Z_B",CTy"Zcond"),
           Apply(Const("CF",ATy(qTy,PTy(bTy,qTy))),qVar"state")),
          (LC("Z_NA",CTy"Zcond"),
           CS(TP[Apply
                   (Dest("EFLAGS",ATy(CTy"Zeflags",OTy bTy),qVar"state"),
                    LC("Z_CF",CTy"Zeflags")),
                 Apply
                   (Dest("EFLAGS",ATy(CTy"Zeflags",OTy bTy),qVar"state"),
                    LC("Z_ZF",CTy"Zeflags"))],
              [(TP[Mop(Some,LT),AVar(OTy bTy)],TP[LT,qVar"state"]),
               (TP[AVar(OTy bTy),Mop(Some,LT)],TP[LT,qVar"state"]),
               (TP[Mop(Some,LF),Mop(Some,LF)],TP[LF,qVar"state"]),
               (AVar(PTy(OTy bTy,OTy bTy)),
                Apply
                  (Call
                     ("raise'exception",ATy(qTy,PTy(bTy,qTy)),
                      Call
                        ("BadFlagAccess",CTy"exception",
                         CC[LS"read_cond: ",
                            Mop(Cast sTy,Var("c",CTy"Zcond"))])),
                   qVar"state"))])),
          (LC("Z_E",CTy"Zcond"),
           Apply(Const("ZF",ATy(qTy,PTy(bTy,qTy))),qVar"state")),
          (LC("Z_G",CTy"Zcond"),
           CS(TP[Apply
                   (Dest("EFLAGS",ATy(CTy"Zeflags",OTy bTy),qVar"state"),
                    LC("Z_SF",CTy"Zeflags")),
                 Apply
                   (Dest("EFLAGS",ATy(CTy"Zeflags",OTy bTy),qVar"state"),
                    LC("Z_OF",CTy"Zeflags"))],
              [(TP[Mop(Some,bVar"a"),Mop(Some,bVar"b")],
                ITE(EQ(bVar"a",bVar"b"),
                    Let(TP[bVar"v",qVar"s"],
                        Apply
                          (Const("ZF",ATy(qTy,PTy(bTy,qTy))),qVar"state"),
                        TP[Mop(Not,bVar"v"),qVar"s"]),TP[LF,qVar"state"])),
               (AVar(PTy(OTy bTy,OTy bTy)),
                CS(Apply
                     (Dest("EFLAGS",ATy(CTy"Zeflags",OTy bTy),qVar"state"),
                      LC("Z_ZF",CTy"Zeflags")),
                   [(Mop(Some,LT),TP[LF,qVar"state"]),
                    (AVar(OTy bTy),
                     Apply
                       (Call
                          ("raise'exception",ATy(qTy,PTy(bTy,qTy)),
                           Call
                             ("BadFlagAccess",CTy"exception",
                              CC[LS"read_cond: ",
                                 Mop(Cast sTy,Var("c",CTy"Zcond"))])),
                        qVar"state"))]))])),
          (LC("Z_NL",CTy"Zcond"),
           Let(TP[bVar"v",qVar"s"],
               Apply(Const("SF",ATy(qTy,PTy(bTy,qTy))),qVar"state"),
               Let(TP[bVar"v0",qVar"s"],
                   Apply(Const("OF",ATy(qTy,PTy(bTy,qTy))),qVar"s"),
                   TP[EQ(bVar"v",bVar"v0"),qVar"s"]))),
          (LC("Z_L",CTy"Zcond"),
           Let(TP[bVar"v",qVar"s"],
               Apply(Const("SF",ATy(qTy,PTy(bTy,qTy))),qVar"state"),
               Let(TP[bVar"v",qVar"s"],
                   Let(TP[bVar"v0",qVar"s"],
                       Apply(Const("OF",ATy(qTy,PTy(bTy,qTy))),qVar"s"),
                       TP[EQ(bVar"v",bVar"v0"),qVar"s"]),
                   TP[Mop(Not,bVar"v"),qVar"s"]))),
          (LC("Z_NG",CTy"Zcond"),
           CS(TP[Apply
                   (Dest("EFLAGS",ATy(CTy"Zeflags",OTy bTy),qVar"state"),
                    LC("Z_SF",CTy"Zeflags")),
                 Apply
                   (Dest("EFLAGS",ATy(CTy"Zeflags",OTy bTy),qVar"state"),
                    LC("Z_OF",CTy"Zeflags"))],
              [(TP[Mop(Some,bVar"a"),Mop(Some,bVar"b")],
                ITE(Mop(Not,EQ(bVar"a",bVar"b")),TP[LT,qVar"state"],
                    Apply(Const("ZF",ATy(qTy,PTy(bTy,qTy))),qVar"state"))),
               (AVar(PTy(OTy bTy,OTy bTy)),
                CS(Apply
                     (Dest("EFLAGS",ATy(CTy"Zeflags",OTy bTy),qVar"state"),
                      LC("Z_ZF",CTy"Zeflags")),
                   [(Mop(Some,LT),TP[LT,qVar"state"]),
                    (AVar(OTy bTy),
                     Apply
                       (Call
                          ("raise'exception",ATy(qTy,PTy(bTy,qTy)),
                           Call
                             ("BadFlagAccess",CTy"exception",
                              CC[LS"read_cond: ",
                                 Mop(Cast sTy,Var("c",CTy"Zcond"))])),
                        qVar"state"))]))])),
          (LC("Z_NE",CTy"Zcond"),
           Let(TP[bVar"v",qVar"s"],
               Apply(Const("ZF",ATy(qTy,PTy(bTy,qTy))),qVar"state"),
               TP[Mop(Not,bVar"v"),qVar"s"])),
          (LC("Z_NO",CTy"Zcond"),
           Let(TP[bVar"v",qVar"s"],
               Apply(Const("OF",ATy(qTy,PTy(bTy,qTy))),qVar"state"),
               TP[Mop(Not,bVar"v"),qVar"s"])),
          (LC("Z_NP",CTy"Zcond"),
           Let(TP[bVar"v",qVar"s"],
               Apply(Const("PF",ATy(qTy,PTy(bTy,qTy))),qVar"state"),
               TP[Mop(Not,bVar"v"),qVar"s"])),
          (LC("Z_NS",CTy"Zcond"),
           Let(TP[bVar"v",qVar"s"],
               Apply(Const("SF",ATy(qTy,PTy(bTy,qTy))),qVar"state"),
               TP[Mop(Not,bVar"v"),qVar"s"])),
          (LC("Z_O",CTy"Zcond"),
           Apply(Const("OF",ATy(qTy,PTy(bTy,qTy))),qVar"state")),
          (LC("Z_P",CTy"Zcond"),
           Apply(Const("PF",ATy(qTy,PTy(bTy,qTy))),qVar"state")),
          (LC("Z_S",CTy"Zcond"),
           Apply(Const("SF",ATy(qTy,PTy(bTy,qTy))),qVar"state")),
          (LC("Z_ALWAYS",CTy"Zcond"),TP[LT,qVar"state"])])))
;
val x64_pop_aux_def = Def
  ("x64_pop_aux",qVar"state",
   Let(Var("v",F64),
       Apply
         (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),LC("RSP",CTy"Zreg")),
       TP[Apply(Call("mem64",ATy(qTy,F64),Var("v",F64)),qVar"state"),
          Rupd
            ("REG",
             TP[qVar"state",
                Fupd
                  (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
                   LC("RSP",CTy"Zreg"),Bop(Add,Var("v",F64),LW(8,64)))])]))
;
val x64_pop_def = Def
  ("x64_pop",Var("rm",CTy"Zrm"),
   Close
     (qVar"state",
      Let(TP[Var("v0",F64),qVar"s"],
          Apply(Const("x64_pop_aux",ATy(qTy,PTy(F64,qTy))),qVar"state"),
          Apply
            (Call
               ("write'EA",ATy(qTy,qTy),
                TP[Var("v0",F64),
                   Apply
                     (Call
                        ("ea_Zrm",ATy(qTy,CTy"Zea"),
                         TP[Const("Z64",CTy"Zsize"),Var("rm",CTy"Zrm")]),
                      qVar"state")]),qVar"s"))))
;
val x64_pop_rip_def = Def
  ("x64_pop_rip",qVar"state",
   Let(TP[Var("v",F64),qVar"s"],
       Apply(Const("x64_pop_aux",ATy(qTy,PTy(F64,qTy))),qVar"state"),
       Rupd("RIP",TP[qVar"s",Var("v",F64)])))
;
val x64_push_aux_def = Def
  ("x64_push_aux",Var("w",F64),
   Close
     (qVar"state",
      Let(Var("v",F64),
          Bop(Sub,
              Apply
                (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
                 LC("RSP",CTy"Zreg")),LW(8,64)),
          Apply
            (Call
               ("write'mem64",ATy(qTy,qTy),TP[Var("w",F64),Var("v",F64)]),
             Rupd
               ("REG",
                TP[qVar"state",
                   Fupd
                     (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
                      LC("RSP",CTy"Zreg"),Var("v",F64))])))))
;
val x64_push_def = Def
  ("x64_push",Var("imm_rm",CTy"Zimm_rm"),
   Close
     (qVar"state",
      Apply
        (Call
           ("x64_push_aux",ATy(qTy,qTy),
            Apply
              (Call
                 ("EA",ATy(qTy,F64),
                  Apply
                    (Call
                       ("ea_Zimm_rm",ATy(qTy,CTy"Zea"),
                        TP[Const("Z64",CTy"Zsize"),
                           Var("imm_rm",CTy"Zimm_rm")]),qVar"state")),
               qVar"state")),qVar"state")))
;
val x64_push_rip_def = Def
  ("x64_push_rip",qVar"state",
   Apply
     (Call("x64_push_aux",ATy(qTy,qTy),Dest("RIP",F64,qVar"state")),
      qVar"state"))
;
val x64_drop_def = Def
  ("x64_drop",Var("imm",F64),
   Close
     (qVar"state",
      Let(qVar"s",
          ITE(Mop(Not,EQ(EX(Var("imm",F64),LN 7,LN 0,F8),LW(0,8))),
              Mop(Snd,
                  Apply
                    (Call
                       ("raise'exception",ATy(qTy,PTy(uTy,qTy)),
                        Call("FAILURE",CTy"exception",LS"x64_drop")),
                     qVar"state")),qVar"state"),
          Rupd
            ("REG",
             TP[qVar"s",
                Fupd
                  (Dest("REG",ATy(CTy"Zreg",F64),qVar"s"),
                   LC("RSP",CTy"Zreg"),
                   Bop(Add,
                       Apply
                         (Dest("REG",ATy(CTy"Zreg",F64),qVar"s"),
                          LC("RSP",CTy"Zreg")),Var("imm",F64)))]))))
;
val dfn'Zbinop_def = Def
  ("dfn'Zbinop",
   TP[Var("bop",CTy"Zbinop_name"),Var("size",CTy"Zsize"),
      Var("dst_src",CTy"Zdest_src")],
   Close
     (qVar"state",
      Let(TP[Var("ea",CTy"Zea"),Var("val_dst",F64),Var("val_src",F64)],
          Apply
            (Call
               ("read_dest_src_ea",ATy(qTy,PTy(CTy"Zea",PTy(F64,F64))),
                TP[Var("size",CTy"Zsize"),Var("dst_src",CTy"Zdest_src")]),
             qVar"state"),
          Apply
            (Call
               ("write_binop",ATy(qTy,qTy),
                TP[Var("size",CTy"Zsize"),Var("bop",CTy"Zbinop_name"),
                   Var("val_dst",F64),Var("val_src",F64),
                   Var("ea",CTy"Zea")]),qVar"state"))))
;
val dfn'Zcall_def = Def
  ("dfn'Zcall",Var("imm_rm",CTy"Zimm_rm"),
   Close
     (qVar"state",
      Let(TP[Var("v",CTy"Zea"),qVar"s"],
          Let(qVar"s",
              Apply(Const("x64_push_rip",ATy(qTy,qTy)),qVar"state"),
              TP[Apply
                   (Call
                      ("ea_Zimm_rm",ATy(qTy,CTy"Zea"),
                       TP[Const("Z64",CTy"Zsize"),
                          Var("imm_rm",CTy"Zimm_rm")]),qVar"s"),qVar"s"]),
          Apply(Call("jump_to_ea",ATy(qTy,qTy),Var("v",CTy"Zea")),qVar"s"))))
;
val dfn'Zcmpxchg_def = Def
  ("dfn'Zcmpxchg",
   TP[Var("size",CTy"Zsize"),Var("rm",CTy"Zrm"),Var("r",CTy"Zreg")],
   Close
     (qVar"state",
      Let(Var("ea_src",CTy"Zea"),
          Call
            ("Zea_r",CTy"Zea",
             TP[Var("size",CTy"Zsize"),Var("r",CTy"Zreg")]),
          Let(Var("v",CTy"Zea"),
              Apply
                (Call
                   ("ea_Zrm",ATy(qTy,CTy"Zea"),
                    TP[Var("size",CTy"Zsize"),Var("rm",CTy"Zrm")]),
                 qVar"state"),
              Let(Var("v0",F64),
                  Apply
                    (Call("EA",ATy(qTy,F64),Var("v",CTy"Zea")),qVar"state"),
                  Let(Var("v1",F64),
                      Apply
                        (Call("EA",ATy(qTy,F64),Var("ea_src",CTy"Zea")),
                         qVar"state"),
                      Let(qVar"s",
                          Apply
                            (Call
                               ("write_binop",ATy(qTy,qTy),
                                TP[Var("size",CTy"Zsize"),
                                   LC("Zcmp",CTy"Zbinop_name"),
                                   Var("v1",F64),Var("v0",F64),
                                   Var("ea_src",CTy"Zea")]),qVar"state"),
                          ITE(EQ(Var("v1",F64),Var("v0",F64)),
                              Apply
                                (Call
                                   ("write'EA",ATy(qTy,qTy),
                                    TP[Apply
                                         (Call
                                            ("EA",ATy(qTy,F64),
                                             Var("ea_src",CTy"Zea")),
                                          qVar"s"),Var("v",CTy"Zea")]),
                                 qVar"s"),
                              Apply
                                (Call
                                   ("write'EA",ATy(qTy,qTy),
                                    TP[Var("v0",F64),
                                       Call
                                         ("Zea_r",CTy"Zea",
                                          TP[Var("size",CTy"Zsize"),
                                             LC("RAX",CTy"Zreg")])]),
                                 qVar"s")))))))))
;
val dfn'Zdiv_def = Def
  ("dfn'Zdiv",TP[Var("size",CTy"Zsize"),Var("rm",CTy"Zrm")],
   Close
     (qVar"state",
      Let(nVar"w",Call("value_width",nTy,Var("size",CTy"Zsize")),
          Let(Var("ea_eax",CTy"Zea"),
              Call
                ("Zea_r",CTy"Zea",
                 TP[Var("size",CTy"Zsize"),LC("RAX",CTy"Zreg")]),
              Let(Var("ea_edx",CTy"Zea"),
                  Call
                    ("Zea_r",CTy"Zea",
                     TP[Var("size",CTy"Zsize"),LC("RDX",CTy"Zreg")]),
                  Let(nVar"v",
                      Bop(Add,
                          Bop(Mul,
                              Mop(Cast nTy,
                                  Apply
                                    (Call
                                       ("EA",ATy(qTy,F64),
                                        Var("ea_edx",CTy"Zea")),
                                     qVar"state")),nVar"w"),
                          Mop(Cast nTy,
                              Apply
                                (Call
                                   ("EA",ATy(qTy,F64),
                                    Var("ea_eax",CTy"Zea")),qVar"state"))),
                      Let(nVar"v0",
                          Mop(Cast nTy,
                              Apply
                                (Call
                                   ("EA",ATy(qTy,F64),
                                    Apply
                                      (Call
                                         ("ea_Zrm",ATy(qTy,CTy"Zea"),
                                          TP[Var("size",CTy"Zsize"),
                                             Var("rm",CTy"Zrm")]),
                                       qVar"state")),qVar"state")),
                          Let(nVar"q",Bop(Div,nVar"v",nVar"v0"),
                              Apply
                                (Const("erase_eflags",ATy(qTy,qTy)),
                                 Apply
                                   (Call
                                      ("write'EA",ATy(qTy,qTy),
                                       TP[Mop(Cast F64,
                                              Bop(Mod,nVar"v",nVar"v0")),
                                          Var("ea_edx",CTy"Zea")]),
                                    Apply
                                      (Call
                                         ("write'EA",ATy(qTy,qTy),
                                          TP[Mop(Cast F64,nVar"q"),
                                             Var("ea_eax",CTy"Zea")]),
                                       ITE(Bop(Or,EQ(nVar"v0",LN 0),
                                               Bop(Le,nVar"w",nVar"q")),
                                           Mop(Snd,
                                               Apply
                                                 (Call
                                                    ("raise'exception",
                                                     ATy(qTy,PTy(uTy,qTy)),
                                                     Call
                                                       ("FAILURE",
                                                        CTy"exception",
                                                        LS"division")),
                                                  qVar"state")),
                                           qVar"state"))))))))))))
;
val dfn'Zjcc_def = Def
  ("dfn'Zjcc",TP[Var("cond",CTy"Zcond"),Var("imm",F64)],
   Close
     (qVar"state",
      Let(TP[bVar"v",qVar"s"],
          Apply
            (Call
               ("read_cond",ATy(qTy,PTy(bTy,qTy)),Var("cond",CTy"Zcond")),
             qVar"state"),
          ITE(bVar"v",
              Rupd
                ("RIP",
                 TP[qVar"s",
                    Bop(Add,Dest("RIP",F64,qVar"s"),Var("imm",F64))]),
              qVar"s"))))
;
val dfn'Zjmp_def = Def
  ("dfn'Zjmp",Var("rm",CTy"Zrm"),
   Close
     (qVar"state",
      Rupd
        ("RIP",
         TP[qVar"state",
            Apply
              (Call
                 ("EA",ATy(qTy,F64),
                  Apply
                    (Call
                       ("ea_Zrm",ATy(qTy,CTy"Zea"),
                        TP[Const("Z64",CTy"Zsize"),Var("rm",CTy"Zrm")]),
                     qVar"state")),qVar"state")])))
;
val dfn'Zlea_def = Def
  ("dfn'Zlea",TP[Var("size",CTy"Zsize"),Var("dst_src",CTy"Zdest_src")],
   Close
     (qVar"state",
      Apply
        (Call
           ("write'EA",ATy(qTy,qTy),
            TP[Call
                 ("get_ea_address",F64,
                  Apply
                    (Call
                       ("ea_Zsrc",ATy(qTy,CTy"Zea"),
                        TP[Var("size",CTy"Zsize"),
                           Var("dst_src",CTy"Zdest_src")]),qVar"state")),
               Apply
                 (Call
                    ("ea_Zdest",ATy(qTy,CTy"Zea"),
                     TP[Var("size",CTy"Zsize"),
                        Var("dst_src",CTy"Zdest_src")]),qVar"state")]),
         qVar"state")))
;
val dfn'Zleave_def = Def
  ("dfn'Zleave",qVar"state",
   Apply
     (Call("x64_pop",ATy(qTy,qTy),Call("Zr",CTy"Zrm",LC("RBP",CTy"Zreg"))),
      Rupd
        ("REG",
         TP[qVar"state",
            Fupd
              (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
               LC("RSP",CTy"Zreg"),
               Apply
                 (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
                  LC("RBP",CTy"Zreg")))])))
;
val dfn'Zloop_def = Def
  ("dfn'Zloop",TP[Var("cond",CTy"Zcond"),Var("imm",F64)],
   Close
     (qVar"state",
      Let(Var("v",F64),
          Bop(Sub,
              Apply
                (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
                 LC("RCX",CTy"Zreg")),LW(1,64)),
          Let(qVar"s",
              Rupd
                ("REG",
                 TP[qVar"state",
                    Fupd
                      (Dest("REG",ATy(CTy"Zreg",F64),qVar"state"),
                       LC("RCX",CTy"Zreg"),Var("v",F64))]),
              Let(TP[bVar"v",qVar"s"],
                  ITE(Mop(Not,EQ(Var("v",F64),LW(0,64))),
                      Apply
                        (Call
                           ("read_cond",ATy(qTy,PTy(bTy,qTy)),
                            Var("cond",CTy"Zcond")),qVar"s"),
                      TP[LF,qVar"s"]),
                  ITE(bVar"v",
                      Rupd
                        ("RIP",
                         TP[qVar"s",
                            Bop(Add,Dest("RIP",F64,qVar"s"),Var("imm",F64))]),
                      qVar"s"))))))
;
val dfn'Zmonop_def = Def
  ("dfn'Zmonop",
   TP[Var("mop",CTy"Zmonop_name"),Var("size",CTy"Zsize"),
      Var("rm",CTy"Zrm")],
   Close
     (qVar"state",
      Let(Var("v",CTy"Zea"),
          Apply
            (Call
               ("ea_Zrm",ATy(qTy,CTy"Zea"),
                TP[Var("size",CTy"Zsize"),Var("rm",CTy"Zrm")]),qVar"state"),
          Apply
            (Call
               ("write_monop",ATy(qTy,qTy),
                TP[Var("size",CTy"Zsize"),Var("mop",CTy"Zmonop_name"),
                   Apply
                     (Call("EA",ATy(qTy,F64),Var("v",CTy"Zea")),
                      qVar"state"),Var("v",CTy"Zea")]),qVar"state"))))
;
val dfn'Zmov_def = Def
  ("dfn'Zmov",
   TP[Var("cond",CTy"Zcond"),Var("size",CTy"Zsize"),
      Var("dst_src",CTy"Zdest_src")],
   Close
     (qVar"state",
      Let(TP[bVar"v",qVar"s"],
          Apply
            (Call
               ("read_cond",ATy(qTy,PTy(bTy,qTy)),Var("cond",CTy"Zcond")),
             qVar"state"),
          ITE(bVar"v",
              Apply
                (Call
                   ("write'EA",ATy(qTy,qTy),
                    TP[Apply
                         (Call
                            ("EA",ATy(qTy,F64),
                             Apply
                               (Call
                                  ("ea_Zsrc",ATy(qTy,CTy"Zea"),
                                   TP[Var("size",CTy"Zsize"),
                                      Var("dst_src",CTy"Zdest_src")]),
                                qVar"s")),qVar"s"),
                       Apply
                         (Call
                            ("ea_Zdest",ATy(qTy,CTy"Zea"),
                             TP[Var("size",CTy"Zsize"),
                                Var("dst_src",CTy"Zdest_src")]),qVar"s")]),
                 qVar"s"),qVar"s"))))
;
val dfn'Zmovsx_def = Def
  ("dfn'Zmovsx",
   TP[Var("size1",CTy"Zsize"),Var("dst_src",CTy"Zdest_src"),
      Var("size2",CTy"Zsize")],
   Close
     (qVar"state",
      Let(TP[Var("v",PTy(F64,CTy"Zea")),qVar"s"],
          Let(TP[Var("v0",F64),qVar"s"],
              Apply
                (Call
                   ("SignExtension",ATy(qTy,PTy(F64,qTy)),
                    TP[Apply
                         (Call
                            ("EA",ATy(qTy,F64),
                             Apply
                               (Call
                                  ("ea_Zsrc",ATy(qTy,CTy"Zea"),
                                   TP[Var("size1",CTy"Zsize"),
                                      Var("dst_src",CTy"Zdest_src")]),
                                qVar"state")),qVar"state"),
                       Var("size1",CTy"Zsize"),Var("size2",CTy"Zsize")]),
                 qVar"state"),
              TP[TP[Var("v0",F64),
                    Apply
                      (Call
                         ("ea_Zdest",ATy(qTy,CTy"Zea"),
                          TP[Var("size2",CTy"Zsize"),
                             Var("dst_src",CTy"Zdest_src")]),qVar"state")],
                 qVar"s"]),
          Apply
            (Call("write'EA",ATy(qTy,qTy),Var("v",PTy(F64,CTy"Zea"))),
             qVar"s"))))
;
val dfn'Zmovzx_def = Def
  ("dfn'Zmovzx",
   TP[Var("size1",CTy"Zsize"),Var("dst_src",CTy"Zdest_src"),
      Var("size2",CTy"Zsize")],
   Close
     (qVar"state",
      Apply
        (Call
           ("write'EA",ATy(qTy,qTy),
            TP[Apply
                 (Call
                    ("EA",ATy(qTy,F64),
                     Apply
                       (Call
                          ("ea_Zsrc",ATy(qTy,CTy"Zea"),
                           TP[Var("size1",CTy"Zsize"),
                              Var("dst_src",CTy"Zdest_src")]),qVar"state")),
                  qVar"state"),
               Apply
                 (Call
                    ("ea_Zdest",ATy(qTy,CTy"Zea"),
                     TP[Var("size2",CTy"Zsize"),
                        Var("dst_src",CTy"Zdest_src")]),qVar"state")]),
         qVar"state")))
;
val dfn'Zmul_def = Def
  ("dfn'Zmul",TP[Var("size",CTy"Zsize"),Var("rm",CTy"Zrm")],
   Close
     (qVar"state",
      Let(Var("ea_eax",CTy"Zea"),
          Call
            ("Zea_r",CTy"Zea",
             TP[Var("size",CTy"Zsize"),LC("RAX",CTy"Zreg")]),
          Let(Var("v",F64),
              Apply
                (Call("EA",ATy(qTy,F64),Var("ea_eax",CTy"Zea")),
                 qVar"state"),
              Let(Var("v0",F64),
                  Apply
                    (Call
                       ("EA",ATy(qTy,F64),
                        Apply
                          (Call
                             ("ea_Zrm",ATy(qTy,CTy"Zea"),
                              TP[Var("size",CTy"Zsize"),Var("rm",CTy"Zrm")]),
                           qVar"state")),qVar"state"),
                  Apply
                    (Const("erase_eflags",ATy(qTy,qTy)),
                     CS(Var("size",CTy"Zsize"),
                        [(Call("Z8",CTy"Zsize",AVar bTy),
                          Apply
                            (Call
                               ("write'EA",ATy(qTy,qTy),
                                TP[Bop(Mul,Var("v",F64),Var("v0",F64)),
                                   Call
                                     ("Zea_r",CTy"Zea",
                                      TP[Const("Z16",CTy"Zsize"),
                                         LC("RAX",CTy"Zreg")])]),
                             qVar"state")),
                         (AVar(CTy"Zsize"),
                          Apply
                            (Call
                               ("write'EA",ATy(qTy,qTy),
                                TP[Mop(Cast F64,
                                       Bop(Div,
                                           Bop(Mul,
                                               Mop(Cast nTy,Var("v",F64)),
                                               Mop(Cast nTy,Var("v0",F64))),
                                           Call
                                             ("value_width",nTy,
                                              Var("size",CTy"Zsize")))),
                                   Call
                                     ("Zea_r",CTy"Zea",
                                      TP[Var("size",CTy"Zsize"),
                                         LC("RDX",CTy"Zreg")])]),
                             Apply
                               (Call
                                  ("write'EA",ATy(qTy,qTy),
                                   TP[Bop(Mul,Var("v",F64),Var("v0",F64)),
                                      Var("ea_eax",CTy"Zea")]),qVar"state")))])))))))
;
val dfn'Znop_def = Def0 ("dfn'Znop",LU)
;
val dfn'Zpop_def = Def
  ("dfn'Zpop",Var("rm",CTy"Zrm"),
   Close
     (qVar"state",
      Apply(Call("x64_pop",ATy(qTy,qTy),Var("rm",CTy"Zrm")),qVar"state")))
;
val dfn'Zpush_def = Def
  ("dfn'Zpush",Var("imm_rm",CTy"Zimm_rm"),
   Close
     (qVar"state",
      Apply
        (Call("x64_push",ATy(qTy,qTy),Var("imm_rm",CTy"Zimm_rm")),
         qVar"state")))
;
val dfn'Zret_def = Def
  ("dfn'Zret",Var("imm",F64),
   Close
     (qVar"state",
      Apply
        (Call("x64_drop",ATy(qTy,qTy),Var("imm",F64)),
         Apply(Const("x64_pop_rip",ATy(qTy,qTy)),qVar"state"))))
;
val dfn'Zset_def = Def
  ("dfn'Zset",
   TP[Var("cond",CTy"Zcond"),bVar"have_rex",Var("rm",CTy"Zrm")],
   Close
     (qVar"state",
      Let(TP[bVar"v0",qVar"s"],
          Apply
            (Call
               ("read_cond",ATy(qTy,PTy(bTy,qTy)),Var("cond",CTy"Zcond")),
             qVar"state"),
          Apply
            (Call
               ("write'EA",ATy(qTy,qTy),
                TP[Mop(Cast F64,bVar"v0"),
                   Apply
                     (Call
                        ("ea_Zrm",ATy(qTy,CTy"Zea"),
                         TP[Call("Z8",CTy"Zsize",bVar"have_rex"),
                            Var("rm",CTy"Zrm")]),qVar"state")]),qVar"s"))))
;
val dfn'Zxadd_def = Def
  ("dfn'Zxadd",
   TP[Var("size",CTy"Zsize"),Var("rm",CTy"Zrm"),Var("r",CTy"Zreg")],
   Close
     (qVar"state",
      Let(Var("ea_src",CTy"Zea"),
          Call
            ("Zea_r",CTy"Zea",
             TP[Var("size",CTy"Zsize"),Var("r",CTy"Zreg")]),
          Let(Var("v",CTy"Zea"),
              Apply
                (Call
                   ("ea_Zrm",ATy(qTy,CTy"Zea"),
                    TP[Var("size",CTy"Zsize"),Var("rm",CTy"Zrm")]),
                 qVar"state"),
              Let(Var("v1",F64),
                  Apply
                    (Call("EA",ATy(qTy,F64),Var("v",CTy"Zea")),qVar"state"),
                  Apply
                    (Call
                       ("write_binop",ATy(qTy,qTy),
                        TP[Var("size",CTy"Zsize"),
                           LC("Zadd",CTy"Zbinop_name"),
                           Apply
                             (Call
                                ("EA",ATy(qTy,F64),Var("ea_src",CTy"Zea")),
                              qVar"state"),Var("v1",F64),Var("v",CTy"Zea")]),
                     Apply
                       (Call
                          ("write'EA",ATy(qTy,qTy),
                           TP[Var("v1",F64),Var("ea_src",CTy"Zea")]),
                        qVar"state")))))))
;
val dfn'Zxchg_def = Def
  ("dfn'Zxchg",
   TP[Var("size",CTy"Zsize"),Var("rm",CTy"Zrm"),Var("r",CTy"Zreg")],
   Close
     (qVar"state",
      Let(Var("ea_src",CTy"Zea"),
          Call
            ("Zea_r",CTy"Zea",
             TP[Var("size",CTy"Zsize"),Var("r",CTy"Zreg")]),
          Let(Var("v",CTy"Zea"),
              Apply
                (Call
                   ("ea_Zrm",ATy(qTy,CTy"Zea"),
                    TP[Var("size",CTy"Zsize"),Var("rm",CTy"Zrm")]),
                 qVar"state"),
              Apply
                (Call
                   ("write'EA",ATy(qTy,qTy),
                    TP[Apply
                         (Call("EA",ATy(qTy,F64),Var("ea_src",CTy"Zea")),
                          qVar"state"),Var("v",CTy"Zea")]),
                 Apply
                   (Call
                      ("write'EA",ATy(qTy,qTy),
                       TP[Apply
                            (Call("EA",ATy(qTy,F64),Var("v",CTy"Zea")),
                             qVar"state"),Var("ea_src",CTy"Zea")]),
                    qVar"state"))))))
;
val dfn'Zcmc_def = Def
  ("dfn'Zcmc",qVar"state",
   Let(TP[bVar"v",qVar"s"],
       Apply(Const("CF",ATy(qTy,PTy(bTy,qTy))),qVar"state"),
       Apply(Call("write'CF",ATy(qTy,qTy),Mop(Not,bVar"v")),qVar"s")))
;
val dfn'Zclc_def = Def
  ("dfn'Zclc",qVar"state",
   Apply(Call("write'CF",ATy(qTy,qTy),LF),qVar"state"))
;
val dfn'Zstc_def = Def
  ("dfn'Zstc",qVar"state",
   Apply(Call("write'CF",ATy(qTy,qTy),LT),qVar"state"))
;
val Run_def = Def
  ("Run",Var("v0",CTy"instruction"),
   Close
     (qVar"state",
      CS(Var("v0",CTy"instruction"),
         [(Const("Zclc",CTy"instruction"),
           Apply(Const("dfn'Zclc",ATy(qTy,qTy)),qVar"state")),
          (Const("Zcmc",CTy"instruction"),
           Apply(Const("dfn'Zcmc",ATy(qTy,qTy)),qVar"state")),
          (Const("Zleave",CTy"instruction"),
           Apply(Const("dfn'Zleave",ATy(qTy,qTy)),qVar"state")),
          (Const("Znop",CTy"instruction"),qVar"state"),
          (Const("Zstc",CTy"instruction"),
           Apply(Const("dfn'Zstc",ATy(qTy,qTy)),qVar"state")),
          (Call
             ("Zbinop",CTy"instruction",
              Var("v1",
                  PTy(CTy"Zbinop_name",PTy(CTy"Zsize",CTy"Zdest_src")))),
           Apply
             (Call
                ("dfn'Zbinop",ATy(qTy,qTy),
                 Var("v1",
                     PTy(CTy"Zbinop_name",PTy(CTy"Zsize",CTy"Zdest_src")))),
              qVar"state")),
          (Call("Zcall",CTy"instruction",Var("v2",CTy"Zimm_rm")),
           Apply
             (Call("dfn'Zcall",ATy(qTy,qTy),Var("v2",CTy"Zimm_rm")),
              qVar"state")),
          (Call
             ("Zcmpxchg",CTy"instruction",
              Var("v3",PTy(CTy"Zsize",PTy(CTy"Zrm",CTy"Zreg")))),
           Apply
             (Call
                ("dfn'Zcmpxchg",ATy(qTy,qTy),
                 Var("v3",PTy(CTy"Zsize",PTy(CTy"Zrm",CTy"Zreg")))),
              qVar"state")),
          (Call
             ("Zdiv",CTy"instruction",Var("v4",PTy(CTy"Zsize",CTy"Zrm"))),
           Apply
             (Call
                ("dfn'Zdiv",ATy(qTy,qTy),
                 Var("v4",PTy(CTy"Zsize",CTy"Zrm"))),qVar"state")),
          (Call("Zjcc",CTy"instruction",Var("v5",PTy(CTy"Zcond",F64))),
           Apply
             (Call("dfn'Zjcc",ATy(qTy,qTy),Var("v5",PTy(CTy"Zcond",F64))),
              qVar"state")),
          (Call("Zjmp",CTy"instruction",Var("v6",CTy"Zrm")),
           Apply
             (Call("dfn'Zjmp",ATy(qTy,qTy),Var("v6",CTy"Zrm")),qVar"state")),
          (Call
             ("Zlea",CTy"instruction",
              Var("v7",PTy(CTy"Zsize",CTy"Zdest_src"))),
           Apply
             (Call
                ("dfn'Zlea",ATy(qTy,qTy),
                 Var("v7",PTy(CTy"Zsize",CTy"Zdest_src"))),qVar"state")),
          (Call("Zloop",CTy"instruction",Var("v8",PTy(CTy"Zcond",F64))),
           Apply
             (Call("dfn'Zloop",ATy(qTy,qTy),Var("v8",PTy(CTy"Zcond",F64))),
              qVar"state")),
          (Call
             ("Zmonop",CTy"instruction",
              Var("v9",PTy(CTy"Zmonop_name",PTy(CTy"Zsize",CTy"Zrm")))),
           Apply
             (Call
                ("dfn'Zmonop",ATy(qTy,qTy),
                 Var("v9",PTy(CTy"Zmonop_name",PTy(CTy"Zsize",CTy"Zrm")))),
              qVar"state")),
          (Call
             ("Zmov",CTy"instruction",
              Var("v10",PTy(CTy"Zcond",PTy(CTy"Zsize",CTy"Zdest_src")))),
           Apply
             (Call
                ("dfn'Zmov",ATy(qTy,qTy),
                 Var("v10",PTy(CTy"Zcond",PTy(CTy"Zsize",CTy"Zdest_src")))),
              qVar"state")),
          (Call
             ("Zmovsx",CTy"instruction",
              Var("v11",PTy(CTy"Zsize",PTy(CTy"Zdest_src",CTy"Zsize")))),
           Apply
             (Call
                ("dfn'Zmovsx",ATy(qTy,qTy),
                 Var("v11",PTy(CTy"Zsize",PTy(CTy"Zdest_src",CTy"Zsize")))),
              qVar"state")),
          (Call
             ("Zmovzx",CTy"instruction",
              Var("v12",PTy(CTy"Zsize",PTy(CTy"Zdest_src",CTy"Zsize")))),
           Apply
             (Call
                ("dfn'Zmovzx",ATy(qTy,qTy),
                 Var("v12",PTy(CTy"Zsize",PTy(CTy"Zdest_src",CTy"Zsize")))),
              qVar"state")),
          (Call
             ("Zmul",CTy"instruction",Var("v13",PTy(CTy"Zsize",CTy"Zrm"))),
           Apply
             (Call
                ("dfn'Zmul",ATy(qTy,qTy),
                 Var("v13",PTy(CTy"Zsize",CTy"Zrm"))),qVar"state")),
          (Call("Zpop",CTy"instruction",Var("v14",CTy"Zrm")),
           Apply
             (Call("dfn'Zpop",ATy(qTy,qTy),Var("v14",CTy"Zrm")),
              qVar"state")),
          (Call("Zpush",CTy"instruction",Var("v15",CTy"Zimm_rm")),
           Apply
             (Call("dfn'Zpush",ATy(qTy,qTy),Var("v15",CTy"Zimm_rm")),
              qVar"state")),
          (Call("Zret",CTy"instruction",Var("v16",F64)),
           Apply(Call("dfn'Zret",ATy(qTy,qTy),Var("v16",F64)),qVar"state")),
          (Call
             ("Zset",CTy"instruction",
              Var("v17",PTy(CTy"Zcond",PTy(bTy,CTy"Zrm")))),
           Apply
             (Call
                ("dfn'Zset",ATy(qTy,qTy),
                 Var("v17",PTy(CTy"Zcond",PTy(bTy,CTy"Zrm")))),qVar"state")),
          (Call
             ("Zxadd",CTy"instruction",
              Var("v18",PTy(CTy"Zsize",PTy(CTy"Zrm",CTy"Zreg")))),
           Apply
             (Call
                ("dfn'Zxadd",ATy(qTy,qTy),
                 Var("v18",PTy(CTy"Zsize",PTy(CTy"Zrm",CTy"Zreg")))),
              qVar"state")),
          (Call
             ("Zxchg",CTy"instruction",
              Var("v19",PTy(CTy"Zsize",PTy(CTy"Zrm",CTy"Zreg")))),
           Apply
             (Call
                ("dfn'Zxchg",ATy(qTy,qTy),
                 Var("v19",PTy(CTy"Zsize",PTy(CTy"Zrm",CTy"Zreg")))),
              qVar"state"))])))
;
val oimmediate8_def = Def
  ("oimmediate8",Var("strm",OTy(LTy F8)),
   CS(Var("strm",OTy(LTy F8)),
      [(Mop(Some,LLC([Var("b",F8)],Var("t",LTy F8))),
        TP[Mop(SE F64,Var("b",F8)),Mop(Some,Var("t",LTy F8))]),
       (AVar(OTy(LTy F8)),TP[LX F64,LO(LTy F8)])]))
;
val immediate8_def = Def
  ("immediate8",Var("strm",LTy F8),
   Call("oimmediate8",PTy(F64,OTy(LTy F8)),Mop(Some,Var("strm",LTy F8))))
;
val immediate16_def = Def
  ("immediate16",Var("strm",LTy F8),
   CS(Var("strm",LTy F8),
      [(LLC([Var("b1",F8),Var("b2",F8)],Var("t",LTy F8)),
        TP[Mop(SE F64,CC[Var("b2",F8),Var("b1",F8)]),
           Mop(Some,Var("t",LTy F8))]),
       (AVar(LTy F8),TP[LX F64,LO(LTy F8)])]))
;
val immediate32_def = Def
  ("immediate32",Var("strm",LTy F8),
   CS(Var("strm",LTy F8),
      [(LLC([Var("b1",F8),Var("b2",F8),Var("b3",F8),Var("b4",F8)],
            Var("t",LTy F8)),
        TP[Mop(SE F64,
               CC[Var("b4",F8),Var("b3",F8),Var("b2",F8),Var("b1",F8)]),
           Mop(Some,Var("t",LTy F8))]),
       (AVar(LTy F8),TP[LX F64,LO(LTy F8)])]))
;
val immediate64_def = Def
  ("immediate64",Var("strm",LTy F8),
   CS(Var("strm",LTy F8),
      [(LLC([Var("b1",F8),Var("b2",F8),Var("b3",F8),Var("b4",F8),
             Var("b5",F8),Var("b6",F8),Var("b7",F8),Var("b8",F8)],
            Var("t",LTy F8)),
        TP[CC[Var("b8",F8),Var("b7",F8),Var("b6",F8),Var("b5",F8),
              Var("b4",F8),Var("b3",F8),Var("b2",F8),Var("b1",F8)],
           Mop(Some,Var("t",LTy F8))]),
       (AVar(LTy F8),TP[LX F64,LO(LTy F8)])]))
;
val immediate_def = Def
  ("immediate",TP[Var("size",CTy"Zsize"),Var("strm",LTy F8)],
   CS(Var("size",CTy"Zsize"),
      [(Call("Z8",CTy"Zsize",AVar bTy),
        Call("immediate8",PTy(F64,OTy(LTy F8)),Var("strm",LTy F8))),
       (Const("Z16",CTy"Zsize"),
        Call("immediate16",PTy(F64,OTy(LTy F8)),Var("strm",LTy F8))),
       (AVar(CTy"Zsize"),
        Call("immediate32",PTy(F64,OTy(LTy F8)),Var("strm",LTy F8)))]))
;
val oimmediate_def = Def
  ("oimmediate",TP[Var("size",CTy"Zsize"),Var("strm",OTy(LTy F8))],
   CS(Var("strm",OTy(LTy F8)),
      [(Mop(Some,Var("s",LTy F8)),
        Call
          ("immediate",PTy(F64,OTy(LTy F8)),
           TP[Var("size",CTy"Zsize"),Var("s",LTy F8)])),
       (LO(LTy F8),TP[LX F64,LO(LTy F8)])]))
;
val full_immediate_def = Def
  ("full_immediate",TP[Var("size",CTy"Zsize"),Var("strm",LTy F8)],
   ITE(EQ(Var("size",CTy"Zsize"),Const("Z64",CTy"Zsize")),
       Call("immediate64",PTy(F64,OTy(LTy F8)),Var("strm",LTy F8)),
       Call
         ("immediate",PTy(F64,OTy(LTy F8)),
          TP[Var("size",CTy"Zsize"),Var("strm",LTy F8)])))
;
val rec'REX_def = Def
  ("rec'REX",Var("x",F4),
   Rec(CTy"REX",
       [Bop(Bit,Var("x",F4),LN 0),Bop(Bit,Var("x",F4),LN 2),
        Bop(Bit,Var("x",F4),LN 3),Bop(Bit,Var("x",F4),LN 1)]))
;
val reg'REX_def = Def
  ("reg'REX",Var("x",CTy"REX"),
   CS(Var("x",CTy"REX"),
      [(Rec(CTy"REX",[bVar"B",bVar"R",bVar"W",bVar"X"]),
        CC[Mop(Cast F1,bVar"W"),Mop(Cast F1,bVar"R"),Mop(Cast F1,bVar"X"),
           Mop(Cast F1,bVar"B")])]))
;
val write'rec'REX_def = Def
  ("write'rec'REX",TP[AVar F4,Var("x",CTy"REX")],
   Call("reg'REX",F4,Var("x",CTy"REX")))
;
val write'reg'REX_def = Def
  ("write'reg'REX",TP[AVar(CTy"REX"),Var("x",F4)],
   Call("rec'REX",CTy"REX",Var("x",F4)))
;
val RexReg_def = Def
  ("RexReg",TP[bVar"b",Var("r",FTy 3)],
   Mop(Cast(CTy"Zreg"),CC[Mop(Cast F1,bVar"b"),Var("r",FTy 3)]))
;
val readDisplacement_def = Def
  ("readDisplacement",TP[Var("Mod",FTy 2),Var("strm",LTy F8)],
   ITB([(EQ(Var("Mod",FTy 2),LW(1,2)),
         Call("immediate8",PTy(F64,OTy(LTy F8)),Var("strm",LTy F8))),
        (EQ(Var("Mod",FTy 2),LW(2,2)),
         Call("immediate32",PTy(F64,OTy(LTy F8)),Var("strm",LTy F8)))],
       TP[LW(0,64),Mop(Some,Var("strm",LTy F8))]))
;
val readSibDisplacement_def = Def
  ("readSibDisplacement",TP[bVar"w",Var("Mod",FTy 2),Var("strm",LTy F8)],
   ITE(EQ(Var("Mod",FTy 2),LW(1,2)),
       Call("immediate8",PTy(F64,OTy(LTy F8)),Var("strm",LTy F8)),
       Call("immediate32",PTy(F64,OTy(LTy F8)),Var("strm",LTy F8))))
;
val readSIB_def = Def
  ("readSIB",TP[Var("REX",CTy"REX"),Var("Mod",FTy 2),Var("strm",LTy F8)],
   CS(Var("strm",LTy F8),
      [(LLC([Var("v#0",F8)],Var("v#1",LTy F8)),
        CS(TP[BL(8,Var("v#0",F8)),Var("v#1",LTy F8)],
           [(TP[TP[bVar"SS'1",bVar"SS'0",bVar"Index'2",bVar"Index'1",
                   bVar"Index'0",bVar"Base'2",bVar"Base'1",bVar"Base'0"],
                Var("strm1",LTy F8)],
             Let(Var("base",CTy"Zreg"),
                 Call
                   ("RexReg",CTy"Zreg",
                    TP[Dest("B",bTy,Var("REX",CTy"REX")),
                       Mop(Cast(FTy 3),
                           LL[bVar"Base'2",bVar"Base'1",bVar"Base'0"])]),
                 Let(Var("index",CTy"Zreg"),
                     Call
                       ("RexReg",CTy"Zreg",
                        TP[Dest("X",bTy,Var("REX",CTy"REX")),
                           Mop(Cast(FTy 3),
                               LL[bVar"Index'2",bVar"Index'1",
                                  bVar"Index'0"])]),
                     Let(Var("scaled_index",OTy(PTy(FTy 2,CTy"Zreg"))),
                         ITE(EQ(Var("index",CTy"Zreg"),LC("RSP",CTy"Zreg")),
                             LO(PTy(FTy 2,CTy"Zreg")),
                             Mop(Some,
                                 TP[Mop(Cast(FTy 2),
                                        LL[bVar"SS'1",bVar"SS'0"]),
                                    Var("index",CTy"Zreg")])),
                         ITE(EQ(Var("base",CTy"Zreg"),LC("RBP",CTy"Zreg")),
                             Let(TP[Var("displacement",F64),
                                    Var("strm2",OTy(LTy F8))],
                                 Call
                                   ("readSibDisplacement",
                                    PTy(F64,OTy(LTy F8)),
                                    TP[Dest("W",bTy,Var("REX",CTy"REX")),
                                       Var("Mod",FTy 2),
                                       Var("strm1",LTy F8)]),
                                 TP[Call
                                      ("Zm",CTy"Zrm",
                                       TP[Var("scaled_index",
                                              OTy(PTy(FTy 2,CTy"Zreg"))),
                                          ITE(EQ(Var("Mod",FTy 2),LW(0,2)),
                                              Const("ZnoBase",CTy"Zbase"),
                                              Call
                                                ("ZregBase",CTy"Zbase",
                                                 Var("base",CTy"Zreg"))),
                                          Var("displacement",F64)]),
                                    Var("strm2",OTy(LTy F8))]),
                             Let(TP[Var("displacement",F64),
                                    Var("strm2",OTy(LTy F8))],
                                 Call
                                   ("readDisplacement",
                                    PTy(F64,OTy(LTy F8)),
                                    TP[Var("Mod",FTy 2),
                                       Var("strm1",LTy F8)]),
                                 TP[Call
                                      ("Zm",CTy"Zrm",
                                       TP[Var("scaled_index",
                                              OTy(PTy(FTy 2,CTy"Zreg"))),
                                          Call
                                            ("ZregBase",CTy"Zbase",
                                             Var("base",CTy"Zreg")),
                                          Var("displacement",F64)]),
                                    Var("strm2",OTy(LTy F8))]))))))])),
       (AVar(LTy F8),TP[LX(CTy"Zrm"),LO(LTy F8)])]))
;
val readModRM_def = Def
  ("readModRM",TP[Var("REX",CTy"REX"),Var("strm",LTy F8)],
   CS(Var("strm",LTy F8),
      [(LLC([Var("v#0",F8)],Var("v#1",LTy F8)),
        CS(TP[BL(8,Var("v#0",F8)),Var("v#1",LTy F8)],
           [(TP[TP[LF,LF,bVar"RegOpc'2",bVar"RegOpc'1",bVar"RegOpc'0",LT,
                   LF,LT],Var("strm1",LTy F8)],
             Let(TP[Var("displacement",F64),Var("strm2",OTy(LTy F8))],
                 Call
                   ("immediate32",PTy(F64,OTy(LTy F8)),Var("strm1",LTy F8)),
                 TP[Call
                      ("RexReg",CTy"Zreg",
                       TP[Dest("R",bTy,Var("REX",CTy"REX")),
                          Mop(Cast(FTy 3),
                              LL[bVar"RegOpc'2",bVar"RegOpc'1",
                                 bVar"RegOpc'0"])]),
                    Call
                      ("Zm",CTy"Zrm",
                       TP[LO(PTy(FTy 2,CTy"Zreg")),
                          Const("ZripBase",CTy"Zbase"),
                          Var("displacement",F64)]),
                    Var("strm2",OTy(LTy F8))])),
            (TP[TP[LT,LT,bVar"REG'2",bVar"REG'1",bVar"REG'0",bVar"RM'2",
                   bVar"RM'1",bVar"RM'0"],Var("strm1",LTy F8)],
             TP[Call
                  ("RexReg",CTy"Zreg",
                   TP[Dest("R",bTy,Var("REX",CTy"REX")),
                      Mop(Cast(FTy 3),
                          LL[bVar"REG'2",bVar"REG'1",bVar"REG'0"])]),
                Call
                  ("Zr",CTy"Zrm",
                   Call
                     ("RexReg",CTy"Zreg",
                      TP[Dest("B",bTy,Var("REX",CTy"REX")),
                         Mop(Cast(FTy 3),
                             LL[bVar"RM'2",bVar"RM'1",bVar"RM'0"])])),
                Mop(Some,Var("strm1",LTy F8))]),
            (TP[TP[bVar"Mod'1",bVar"Mod'0",bVar"RegOpc'2",bVar"RegOpc'1",
                   bVar"RegOpc'0",LT,LF,LF],Var("strm1",LTy F8)],
             Let(TP[Var("sib",CTy"Zrm"),Var("strm2",OTy(LTy F8))],
                 Call
                   ("readSIB",PTy(CTy"Zrm",OTy(LTy F8)),
                    TP[Var("REX",CTy"REX"),
                       Mop(Cast(FTy 2),LL[bVar"Mod'1",bVar"Mod'0"]),
                       Var("strm1",LTy F8)]),
                 TP[Call
                      ("RexReg",CTy"Zreg",
                       TP[Dest("R",bTy,Var("REX",CTy"REX")),
                          Mop(Cast(FTy 3),
                              LL[bVar"RegOpc'2",bVar"RegOpc'1",
                                 bVar"RegOpc'0"])]),Var("sib",CTy"Zrm"),
                    Var("strm2",OTy(LTy F8))])),
            (TP[TP[bVar"Mod'1",bVar"Mod'0",bVar"RegOpc'2",bVar"RegOpc'1",
                   bVar"RegOpc'0",bVar"RM'2",bVar"RM'1",bVar"RM'0"],
                Var("strm1",LTy F8)],
             Let(TP[Var("displacement",F64),Var("strm2",OTy(LTy F8))],
                 Call
                   ("readDisplacement",PTy(F64,OTy(LTy F8)),
                    TP[Mop(Cast(FTy 2),LL[bVar"Mod'1",bVar"Mod'0"]),
                       Var("strm1",LTy F8)]),
                 TP[Call
                      ("RexReg",CTy"Zreg",
                       TP[Dest("R",bTy,Var("REX",CTy"REX")),
                          Mop(Cast(FTy 3),
                              LL[bVar"RegOpc'2",bVar"RegOpc'1",
                                 bVar"RegOpc'0"])]),
                    Call
                      ("Zm",CTy"Zrm",
                       TP[LO(PTy(FTy 2,CTy"Zreg")),
                          Call
                            ("ZregBase",CTy"Zbase",
                             Call
                               ("RexReg",CTy"Zreg",
                                TP[Dest("B",bTy,Var("REX",CTy"REX")),
                                   Mop(Cast(FTy 3),
                                       LL[bVar"RM'2",bVar"RM'1",bVar"RM'0"])])),
                          Var("displacement",F64)]),
                    Var("strm2",OTy(LTy F8))]))])),
       (AVar(LTy F8),TP[LX(CTy"Zreg"),LX(CTy"Zrm"),LO(LTy F8)])]))
;
val readOpcodeModRM_def = Def
  ("readOpcodeModRM",TP[Var("REX",CTy"REX"),Var("strm",LTy F8)],
   Let(TP[Var("opcode",CTy"Zreg"),Var("rm",CTy"Zrm"),
          Var("strm1",OTy(LTy F8))],
       Call
         ("readModRM",PTy(CTy"Zreg",PTy(CTy"Zrm",OTy(LTy F8))),
          TP[Var("REX",CTy"REX"),Var("strm",LTy F8)]),
       TP[Mop(Cast(FTy 3),
              Bop(Mod,Mop(Cast nTy,Var("opcode",CTy"Zreg")),LN 8)),
          Var("rm",CTy"Zrm"),Var("strm1",OTy(LTy F8))]))
;
val prefixGroup_def = Def
  ("prefixGroup",Var("b",F8),
   CS(Var("b",F8),
      [(LW(240,8),LN 1),(LW(242,8),LN 1),(LW(243,8),LN 1),(LW(38,8),LN 2),
       (LW(46,8),LN 2),(LW(54,8),LN 2),(LW(62,8),LN 2),(LW(100,8),LN 2),
       (LW(101,8),LN 2),(LW(102,8),LN 3),(LW(103,8),LN 4),
       (AVar F8,ITE(EQ(EX(Var("b",F8),LN 7,LN 4,F4),LW(4,4)),LN 5,LN 0))]))
;
val readPrefix_def = Def
  ("readPrefix",TP[Var("s",STy nTy),Var("p",LTy F8),Var("strm",LTy F8)],
   CS(Var("strm",LTy F8),
      [(LLC([Var("h",F8)],Var("strm1",LTy F8)),
        Let(nVar"group",Call("prefixGroup",nTy,Var("h",F8)),
            ITB([(EQ(nVar"group",LN 0),
                  Mop(Some,
                      TP[Var("p",LTy F8),LF,
                         Call("rec'REX",CTy"REX",LW(0,4)),
                         Var("strm",LTy F8)])),
                 (EQ(nVar"group",LN 5),
                  Mop(Some,
                      TP[Var("p",LTy F8),LT,
                         Call
                           ("rec'REX",CTy"REX",
                            EX(Var("h",F8),LN 3,LN 0,F4)),
                         Var("strm1",LTy F8)])),
                 (Bop(In,nVar"group",Var("s",STy nTy)),
                  LO(PTy(LTy F8,PTy(bTy,PTy(CTy"REX",LTy F8)))))],
                Call
                  ("readPrefix",
                   OTy(PTy(LTy F8,PTy(bTy,PTy(CTy"REX",LTy F8)))),
                   TP[Bop(Insert,nVar"group",Var("s",STy nTy)),
                      LLC([Var("h",F8)],Var("p",LTy F8)),
                      Var("strm1",LTy F8)])))),
       (LNL F8,
        Mop(Some,TP[Var("p",LTy F8),LF,LX(CTy"REX"),Var("strm",LTy F8)]))]))
;
val readPrefixes_def = Def
  ("readPrefixes",Var("strm",LTy F8),
   Call
     ("readPrefix",OTy(PTy(LTy F8,PTy(bTy,PTy(CTy"REX",LTy F8)))),
      TP[LE nTy,LNL F8,Var("strm",LTy F8)]))
;
val OpSize_def = Def
  ("OpSize",TP[bVar"have_rex",bVar"w",Var("v",F1),bVar"override"],
   ITB([(EQ(Var("v",F1),LW(0,1)),Call("Z8",CTy"Zsize",bVar"have_rex")),
        (bVar"w",Const("Z64",CTy"Zsize")),
        (bVar"override",Const("Z16",CTy"Zsize"))],Const("Z32",CTy"Zsize")))
;
val isZm_def = Def
  ("isZm",Var("rm",CTy"Zrm"),
   CS(Var("rm",CTy"Zrm"),
      [(Call
          ("Zm",CTy"Zrm",
           AVar(PTy(OTy(PTy(FTy 2,CTy"Zreg")),PTy(CTy"Zbase",F64)))),LT),
       (AVar(CTy"Zrm"),LF)]))
;
val x64_decode_def = Def
  ("x64_decode",Var("strm",LTy F8),
   CS(Call
        ("readPrefixes",OTy(PTy(LTy F8,PTy(bTy,PTy(CTy"REX",LTy F8)))),
         Var("strm",LTy F8)),
      [(LO(PTy(LTy F8,PTy(bTy,PTy(CTy"REX",LTy F8)))),
        Call("Zdec_fail",CTy"Zinst",LS"Bad prefix")),
       (Mop(Some,
            TP[Var("p",LTy F8),bVar"have_rex",Var("REX",CTy"REX"),
               Var("strm1",LTy F8)]),
        Let(Var("prefixes",STy F8),Mop(SofL,Var("p",LTy F8)),
            Let(bVar"op_size_override",
                Bop(In,LW(102,8),Var("prefixes",STy F8)),
                ITB([(Bop(And,Dest("W",bTy,Var("REX",CTy"REX")),
                          bVar"op_size_override"),
                      Call
                        ("Zdec_fail",CTy"Zinst",
                         LS"REX.W together with override prefix")),
                     (Bop(In,LW(103,8),Var("prefixes",STy F8)),
                      Call
                        ("Zdec_fail",CTy"Zinst",
                         LS"address override prefix not supported"))],
                    CS(Var("strm1",LTy F8),
                       [(LLC([Var("v#0",F8)],Var("v#1",LTy F8)),
                         CS(TP[BL(8,Var("v#0",F8)),Var("v#1",LTy F8)],
                            [(TP[TP[LF,LF,bVar"opc'2",bVar"opc'1",
                                    bVar"opc'0",LF,bVar"x'0",bVar"v'0"],
                                 Var("strm2",LTy F8)],
                              Let(TP[Var("reg",CTy"Zreg"),
                                     Var("rm",CTy"Zrm"),
                                     Var("strm3",OTy(LTy F8))],
                                  Call
                                    ("readModRM",
                                     PTy(CTy"Zreg",
                                         PTy(CTy"Zrm",OTy(LTy F8))),
                                     TP[Var("REX",CTy"REX"),
                                        Var("strm2",LTy F8)]),
                                  Call
                                    ("Zfull_inst",CTy"Zinst",
                                     TP[Var("p",LTy F8),
                                        Call
                                          ("Zbinop",CTy"instruction",
                                           TP[Mop(Cast(CTy"Zbinop_name"),
                                                  Mop(Cast(FTy 3),
                                                      LL[bVar"opc'2",
                                                         bVar"opc'1",
                                                         bVar"opc'0"])),
                                              Call
                                                ("OpSize",CTy"Zsize",
                                                 TP[bVar"have_rex",
                                                    Dest
                                                      ("W",bTy,
                                                       Var("REX",CTy"REX")),
                                                    Mop(Cast F1,
                                                        LL[bVar"v'0"]),
                                                    bVar"op_size_override"]),
                                              ITE(EQ(Mop(Cast F1,
                                                         LL[bVar"x'0"]),
                                                     LW(0,1)),
                                                  Call
                                                    ("Zrm_r",
                                                     CTy"Zdest_src",
                                                     TP[Var("rm",CTy"Zrm"),
                                                        Var("reg",
                                                            CTy"Zreg")]),
                                                  Call
                                                    ("Zr_rm",
                                                     CTy"Zdest_src",
                                                     TP[Var("reg",
                                                            CTy"Zreg"),
                                                        Var("rm",CTy"Zrm")]))]),
                                        Var("strm3",OTy(LTy F8))]))),
                             (TP[TP[LF,LF,bVar"opc'2",bVar"opc'1",
                                    bVar"opc'0",LT,LF,bVar"v'0"],
                                 Var("strm2",LTy F8)],
                              Let(Var("size",CTy"Zsize"),
                                  Call
                                    ("OpSize",CTy"Zsize",
                                     TP[bVar"have_rex",
                                        Dest("W",bTy,Var("REX",CTy"REX")),
                                        Mop(Cast F1,LL[bVar"v'0"]),
                                        bVar"op_size_override"]),
                                  Let(TP[Var("imm",F64),
                                         Var("strm3",OTy(LTy F8))],
                                      Call
                                        ("immediate",PTy(F64,OTy(LTy F8)),
                                         TP[Var("size",CTy"Zsize"),
                                            Var("strm2",LTy F8)]),
                                      Call
                                        ("Zfull_inst",CTy"Zinst",
                                         TP[Var("p",LTy F8),
                                            Call
                                              ("Zbinop",CTy"instruction",
                                               TP[Mop(Cast
                                                        (CTy"Zbinop_name"),
                                                      Mop(Cast(FTy 3),
                                                          LL[bVar"opc'2",
                                                             bVar"opc'1",
                                                             bVar"opc'0"])),
                                                  Var("size",CTy"Zsize"),
                                                  Call
                                                    ("Zrm_i",
                                                     CTy"Zdest_src",
                                                     TP[Call
                                                          ("Zr",CTy"Zrm",
                                                           LC("RAX",
                                                              CTy"Zreg")),
                                                        Var("imm",F64)])]),
                                            Var("strm3",OTy(LTy F8))])))),
                             (TP[TP[LF,LT,LF,LT,bVar"b'0",bVar"r'2",
                                    bVar"r'1",bVar"r'0"],
                                 Var("strm2",LTy F8)],
                              Let(Var("reg",CTy"Zrm"),
                                  Call
                                    ("Zr",CTy"Zrm",
                                     Mop(Cast(CTy"Zreg"),
                                         CC[Mop(Cast F1,
                                                Dest
                                                  ("B",bTy,
                                                   Var("REX",CTy"REX"))),
                                            Mop(Cast(FTy 3),
                                                LL[bVar"r'2",bVar"r'1",
                                                   bVar"r'0"])])),
                                  Call
                                    ("Zfull_inst",CTy"Zinst",
                                     TP[Var("p",LTy F8),
                                        ITE(EQ(Mop(Cast F1,LL[bVar"b'0"]),
                                               LW(0,1)),
                                            Call
                                              ("Zpush",CTy"instruction",
                                               Call
                                                 ("Zrm",CTy"Zimm_rm",
                                                  Var("reg",CTy"Zrm"))),
                                            Call
                                              ("Zpop",CTy"instruction",
                                               Var("reg",CTy"Zrm"))),
                                        Mop(Some,Var("strm2",LTy F8))]))),
                             (TP[TP[LF,LT,LT,LF,LF,LF,LT,LT],
                                 Var("strm2",LTy F8)],
                              Let(TP[Var("reg",CTy"Zreg"),
                                     Var("rm",CTy"Zrm"),
                                     Var("strm3",OTy(LTy F8))],
                                  Call
                                    ("readModRM",
                                     PTy(CTy"Zreg",
                                         PTy(CTy"Zrm",OTy(LTy F8))),
                                     TP[Var("REX",CTy"REX"),
                                        Var("strm2",LTy F8)]),
                                  Call
                                    ("Zfull_inst",CTy"Zinst",
                                     TP[Var("p",LTy F8),
                                        Call
                                          ("Zmovsx",CTy"instruction",
                                           TP[Const("Z32",CTy"Zsize"),
                                              Call
                                                ("Zr_rm",CTy"Zdest_src",
                                                 TP[Var("reg",CTy"Zreg"),
                                                    Var("rm",CTy"Zrm")]),
                                              Const("Z64",CTy"Zsize")]),
                                        Var("strm3",OTy(LTy F8))]))),
                             (TP[TP[LF,LT,LT,LF,LT,LF,bVar"b'0",LF],
                                 Var("strm2",LTy F8)],
                              Let(TP[Var("imm",F64),
                                     Var("strm3",OTy(LTy F8))],
                                  ITE(EQ(Mop(Cast F1,LL[bVar"b'0"]),
                                         LW(1,1)),
                                      Call
                                        ("immediate8",
                                         PTy(F64,OTy(LTy F8)),
                                         Var("strm2",LTy F8)),
                                      Call
                                        ("immediate32",
                                         PTy(F64,OTy(LTy F8)),
                                         Var("strm2",LTy F8))),
                                  Call
                                    ("Zfull_inst",CTy"Zinst",
                                     TP[Var("p",LTy F8),
                                        Call
                                          ("Zpush",CTy"instruction",
                                           Call
                                             ("Zimm",CTy"Zimm_rm",
                                              Var("imm",F64))),
                                        Var("strm3",OTy(LTy F8))]))),
                             (TP[TP[LF,LT,LT,LT,bVar"c'3",bVar"c'2",
                                    bVar"c'1",bVar"c'0"],
                                 Var("strm2",LTy F8)],
                              Let(TP[Var("imm",F64),
                                     Var("strm3",OTy(LTy F8))],
                                  Call
                                    ("immediate8",PTy(F64,OTy(LTy F8)),
                                     Var("strm2",LTy F8)),
                                  Call
                                    ("Zfull_inst",CTy"Zinst",
                                     TP[Var("p",LTy F8),
                                        Call
                                          ("Zjcc",CTy"instruction",
                                           TP[Mop(Cast(CTy"Zcond"),
                                                  Mop(Cast F4,
                                                      LL[bVar"c'3",
                                                         bVar"c'2",
                                                         bVar"c'1",
                                                         bVar"c'0"])),
                                              Var("imm",F64)]),
                                        Var("strm3",OTy(LTy F8))]))),
                             (TP[TP[LT,LF,LF,LF,LF,LF,LF,bVar"v'0"],
                                 Var("strm2",LTy F8)],
                              Let(Var("size",CTy"Zsize"),
                                  Call
                                    ("OpSize",CTy"Zsize",
                                     TP[bVar"have_rex",
                                        Dest("W",bTy,Var("REX",CTy"REX")),
                                        Mop(Cast F1,LL[bVar"v'0"]),
                                        bVar"op_size_override"]),
                                  Let(TP[Var("opcode",FTy 3),
                                         Var("rm",CTy"Zrm"),
                                         Var("strm3",OTy(LTy F8))],
                                      Call
                                        ("readOpcodeModRM",
                                         PTy(FTy 3,
                                             PTy(CTy"Zrm",OTy(LTy F8))),
                                         TP[Var("REX",CTy"REX"),
                                            Var("strm2",LTy F8)]),
                                      Let(TP[Var("imm",F64),
                                             Var("strm4",OTy(LTy F8))],
                                          Call
                                            ("oimmediate",
                                             PTy(F64,OTy(LTy F8)),
                                             TP[Var("size",CTy"Zsize"),
                                                Var("strm3",OTy(LTy F8))]),
                                          Call
                                            ("Zfull_inst",CTy"Zinst",
                                             TP[Var("p",LTy F8),
                                                Call
                                                  ("Zbinop",
                                                   CTy"instruction",
                                                   TP[Mop(Cast
                                                            (CTy"Zbinop_name"),
                                                          Var("opcode",
                                                              FTy 3)),
                                                      Var("size",
                                                          CTy"Zsize"),
                                                      Call
                                                        ("Zrm_i",
                                                         CTy"Zdest_src",
                                                         TP[Var("rm",
                                                                CTy"Zrm"),
                                                            Var("imm",F64)])]),
                                                Var("strm4",OTy(LTy F8))]))))),
                             (TP[TP[LT,LF,LF,LF,LF,LF,LT,LT],
                                 Var("strm2",LTy F8)],
                              Let(TP[Var("opcode",FTy 3),
                                     Var("rm",CTy"Zrm"),
                                     Var("strm3",OTy(LTy F8))],
                                  Call
                                    ("readOpcodeModRM",
                                     PTy(FTy 3,PTy(CTy"Zrm",OTy(LTy F8))),
                                     TP[Var("REX",CTy"REX"),
                                        Var("strm2",LTy F8)]),
                                  Let(TP[Var("imm",F64),
                                         Var("strm4",OTy(LTy F8))],
                                      Call
                                        ("oimmediate8",
                                         PTy(F64,OTy(LTy F8)),
                                         Var("strm3",OTy(LTy F8))),
                                      Call
                                        ("Zfull_inst",CTy"Zinst",
                                         TP[Var("p",LTy F8),
                                            Call
                                              ("Zbinop",CTy"instruction",
                                               TP[Mop(Cast
                                                        (CTy"Zbinop_name"),
                                                      Var("opcode",FTy 3)),
                                                  Call
                                                    ("OpSize",CTy"Zsize",
                                                     TP[LF,
                                                        Dest
                                                          ("W",bTy,
                                                           Var("REX",
                                                               CTy"REX")),
                                                        LW(1,1),
                                                        bVar"op_size_override"]),
                                                  Call
                                                    ("Zrm_i",
                                                     CTy"Zdest_src",
                                                     TP[Var("rm",CTy"Zrm"),
                                                        Var("imm",F64)])]),
                                            Var("strm4",OTy(LTy F8))])))),
                             (TP[TP[LT,LF,LF,LF,LF,LT,LF,bVar"v'0"],
                                 Var("strm2",LTy F8)],
                              Let(TP[Var("reg",CTy"Zreg"),
                                     Var("rm",CTy"Zrm"),
                                     Var("strm3",OTy(LTy F8))],
                                  Call
                                    ("readModRM",
                                     PTy(CTy"Zreg",
                                         PTy(CTy"Zrm",OTy(LTy F8))),
                                     TP[Var("REX",CTy"REX"),
                                        Var("strm2",LTy F8)]),
                                  Call
                                    ("Zfull_inst",CTy"Zinst",
                                     TP[Var("p",LTy F8),
                                        Call
                                          ("Zbinop",CTy"instruction",
                                           TP[LC("Ztest",CTy"Zbinop_name"),
                                              Call
                                                ("OpSize",CTy"Zsize",
                                                 TP[bVar"have_rex",
                                                    Dest
                                                      ("W",bTy,
                                                       Var("REX",CTy"REX")),
                                                    Mop(Cast F1,
                                                        LL[bVar"v'0"]),
                                                    bVar"op_size_override"]),
                                              Call
                                                ("Zrm_r",CTy"Zdest_src",
                                                 TP[Var("rm",CTy"Zrm"),
                                                    Var("reg",CTy"Zreg")])]),
                                        Var("strm3",OTy(LTy F8))]))),
                             (TP[TP[LT,LF,LF,LF,LF,LT,LT,bVar"v'0"],
                                 Var("strm2",LTy F8)],
                              Let(TP[Var("reg",CTy"Zreg"),
                                     Var("rm",CTy"Zrm"),
                                     Var("strm3",OTy(LTy F8))],
                                  Call
                                    ("readModRM",
                                     PTy(CTy"Zreg",
                                         PTy(CTy"Zrm",OTy(LTy F8))),
                                     TP[Var("REX",CTy"REX"),
                                        Var("strm2",LTy F8)]),
                                  Call
                                    ("Zfull_inst",CTy"Zinst",
                                     TP[Var("p",LTy F8),
                                        Call
                                          ("Zxchg",CTy"instruction",
                                           TP[Call
                                                ("OpSize",CTy"Zsize",
                                                 TP[bVar"have_rex",
                                                    Dest
                                                      ("W",bTy,
                                                       Var("REX",CTy"REX")),
                                                    Mop(Cast F1,
                                                        LL[bVar"v'0"]),
                                                    bVar"op_size_override"]),
                                              Var("rm",CTy"Zrm"),
                                              Var("reg",CTy"Zreg")]),
                                        Var("strm3",OTy(LTy F8))]))),
                             (TP[TP[LT,LF,LF,LF,LT,LF,bVar"x'0",bVar"v'0"],
                                 Var("strm2",LTy F8)],
                              Let(TP[Var("reg",CTy"Zreg"),
                                     Var("rm",CTy"Zrm"),
                                     Var("strm3",OTy(LTy F8))],
                                  Call
                                    ("readModRM",
                                     PTy(CTy"Zreg",
                                         PTy(CTy"Zrm",OTy(LTy F8))),
                                     TP[Var("REX",CTy"REX"),
                                        Var("strm2",LTy F8)]),
                                  Call
                                    ("Zfull_inst",CTy"Zinst",
                                     TP[Var("p",LTy F8),
                                        Call
                                          ("Zmov",CTy"instruction",
                                           TP[LC("Z_ALWAYS",CTy"Zcond"),
                                              Call
                                                ("OpSize",CTy"Zsize",
                                                 TP[bVar"have_rex",
                                                    Dest
                                                      ("W",bTy,
                                                       Var("REX",CTy"REX")),
                                                    Mop(Cast F1,
                                                        LL[bVar"v'0"]),
                                                    bVar"op_size_override"]),
                                              ITE(EQ(Mop(Cast F1,
                                                         LL[bVar"x'0"]),
                                                     LW(0,1)),
                                                  Call
                                                    ("Zrm_r",
                                                     CTy"Zdest_src",
                                                     TP[Var("rm",CTy"Zrm"),
                                                        Var("reg",
                                                            CTy"Zreg")]),
                                                  Call
                                                    ("Zr_rm",
                                                     CTy"Zdest_src",
                                                     TP[Var("reg",
                                                            CTy"Zreg"),
                                                        Var("rm",CTy"Zrm")]))]),
                                        Var("strm3",OTy(LTy F8))]))),
                             (TP[TP[LT,LF,LF,LF,LT,LT,LF,LT],
                                 Var("strm2",LTy F8)],
                              Let(TP[Var("reg",CTy"Zreg"),
                                     Var("rm",CTy"Zrm"),
                                     Var("strm3",OTy(LTy F8))],
                                  Call
                                    ("readModRM",
                                     PTy(CTy"Zreg",
                                         PTy(CTy"Zrm",OTy(LTy F8))),
                                     TP[Var("REX",CTy"REX"),
                                        Var("strm2",LTy F8)]),
                                  ITE(Call("isZm",bTy,Var("rm",CTy"Zrm")),
                                      Call
                                        ("Zfull_inst",CTy"Zinst",
                                         TP[Var("p",LTy F8),
                                            Call
                                              ("Zlea",CTy"instruction",
                                               TP[Call
                                                    ("OpSize",CTy"Zsize",
                                                     TP[LT,
                                                        Dest
                                                          ("W",bTy,
                                                           Var("REX",
                                                               CTy"REX")),
                                                        LW(1,1),
                                                        bVar"op_size_override"]),
                                                  Call
                                                    ("Zr_rm",
                                                     CTy"Zdest_src",
                                                     TP[Var("reg",
                                                            CTy"Zreg"),
                                                        Var("rm",CTy"Zrm")])]),
                                            Var("strm3",OTy(LTy F8))]),
                                      Call
                                        ("Zdec_fail",CTy"Zinst",
                                         LS"LEA with register argument")))),
                             (TP[TP[LT,LF,LF,LF,LT,LT,LT,LT],
                                 Var("strm2",LTy F8)],
                              Let(TP[Var("opcode",FTy 3),
                                     Var("rm",CTy"Zrm"),
                                     Var("strm3",OTy(LTy F8))],
                                  Call
                                    ("readOpcodeModRM",
                                     PTy(FTy 3,PTy(CTy"Zrm",OTy(LTy F8))),
                                     TP[Var("REX",CTy"REX"),
                                        Var("strm2",LTy F8)]),
                                  ITE(EQ(Var("opcode",FTy 3),LW(0,3)),
                                      Call
                                        ("Zfull_inst",CTy"Zinst",
                                         TP[Var("p",LTy F8),
                                            Call
                                              ("Zpop",CTy"instruction",
                                               Var("rm",CTy"Zrm")),
                                            Var("strm3",OTy(LTy F8))]),
                                      Call
                                        ("Zdec_fail",CTy"Zinst",
                                         LS"Unsupported opcode: Group 1a")))),
                             (TP[TP[LT,LF,LF,LT,LF,bVar"r'2",bVar"r'1",
                                    bVar"r'0"],Var("strm2",LTy F8)],
                              Let(Var("reg",CTy"Zreg"),
                                  Call
                                    ("RexReg",CTy"Zreg",
                                     TP[Dest("B",bTy,Var("REX",CTy"REX")),
                                        Mop(Cast(FTy 3),
                                            LL[bVar"r'2",bVar"r'1",
                                               bVar"r'0"])]),
                                  ITE(EQ(Var("reg",CTy"Zreg"),
                                         LC("RAX",CTy"Zreg")),
                                      Call
                                        ("Zfull_inst",CTy"Zinst",
                                         TP[Var("p",LTy F8),
                                            Const("Znop",CTy"instruction"),
                                            Mop(Some,Var("strm2",LTy F8))]),
                                      Call
                                        ("Zfull_inst",CTy"Zinst",
                                         TP[Var("p",LTy F8),
                                            Call
                                              ("Zxchg",CTy"instruction",
                                               TP[Call
                                                    ("OpSize",CTy"Zsize",
                                                     TP[LT,
                                                        Dest
                                                          ("W",bTy,
                                                           Var("REX",
                                                               CTy"REX")),
                                                        LW(1,1),
                                                        bVar"op_size_override"]),
                                                  Call
                                                    ("Zr",CTy"Zrm",
                                                     LC("RAX",CTy"Zreg")),
                                                  Var("reg",CTy"Zreg")]),
                                            Mop(Some,Var("strm2",LTy F8))])))),
                             (TP[TP[LT,LF,LT,LF,LT,LF,LF,bVar"v'0"],
                                 Var("strm2",LTy F8)],
                              Let(Var("size",CTy"Zsize"),
                                  Call
                                    ("OpSize",CTy"Zsize",
                                     TP[LT,
                                        Dest("W",bTy,Var("REX",CTy"REX")),
                                        Mop(Cast F1,LL[bVar"v'0"]),
                                        bVar"op_size_override"]),
                                  Let(TP[Var("imm",F64),
                                         Var("strm3",OTy(LTy F8))],
                                      Call
                                        ("immediate",PTy(F64,OTy(LTy F8)),
                                         TP[Var("size",CTy"Zsize"),
                                            Var("strm2",LTy F8)]),
                                      Call
                                        ("Zfull_inst",CTy"Zinst",
                                         TP[Var("p",LTy F8),
                                            Call
                                              ("Zbinop",CTy"instruction",
                                               TP[LC("Ztest",
                                                     CTy"Zbinop_name"),
                                                  Var("size",CTy"Zsize"),
                                                  Call
                                                    ("Zrm_i",
                                                     CTy"Zdest_src",
                                                     TP[Call
                                                          ("Zr",CTy"Zrm",
                                                           LC("RAX",
                                                              CTy"Zreg")),
                                                        Var("imm",F64)])]),
                                            Var("strm3",OTy(LTy F8))])))),
                             (TP[TP[LT,LF,LT,LT,bVar"v'0",bVar"r'2",
                                    bVar"r'1",bVar"r'0"],
                                 Var("strm2",LTy F8)],
                              Let(Var("size",CTy"Zsize"),
                                  Call
                                    ("OpSize",CTy"Zsize",
                                     TP[bVar"have_rex",
                                        Dest("W",bTy,Var("REX",CTy"REX")),
                                        Mop(Cast F1,LL[bVar"v'0"]),
                                        bVar"op_size_override"]),
                                  Let(TP[Var("imm",F64),
                                         Var("strm3",OTy(LTy F8))],
                                      Call
                                        ("full_immediate",
                                         PTy(F64,OTy(LTy F8)),
                                         TP[Var("size",CTy"Zsize"),
                                            Var("strm2",LTy F8)]),
                                      Call
                                        ("Zfull_inst",CTy"Zinst",
                                         TP[Var("p",LTy F8),
                                            Call
                                              ("Zmov",CTy"instruction",
                                               TP[LC("Z_ALWAYS",CTy"Zcond"),
                                                  Var("size",CTy"Zsize"),
                                                  Call
                                                    ("Zrm_i",
                                                     CTy"Zdest_src",
                                                     TP[Call
                                                          ("Zr",CTy"Zrm",
                                                           Mop(Cast
                                                                 (CTy"Zreg"),
                                                               CC[Mop(Cast
                                                                        F1,
                                                                      Dest
                                                                        ("B",
                                                                         bTy,
                                                                         Var("REX",
                                                                             CTy"REX"))),
                                                                  Mop(Cast
                                                                        (FTy 3),
                                                                      LL[bVar"r'2",
                                                                         bVar"r'1",
                                                                         bVar"r'0"])])),
                                                        Var("imm",F64)])]),
                                            Var("strm3",OTy(LTy F8))])))),
                             (TP[TP[LT,LT,LF,LF,LF,LF,LF,bVar"v'0"],
                                 Var("strm2",LTy F8)],
                              Let(TP[Var("opcode",FTy 3),
                                     Var("rm",CTy"Zrm"),
                                     Var("strm3",OTy(LTy F8))],
                                  Call
                                    ("readOpcodeModRM",
                                     PTy(FTy 3,PTy(CTy"Zrm",OTy(LTy F8))),
                                     TP[Var("REX",CTy"REX"),
                                        Var("strm2",LTy F8)]),
                                  Let(TP[Var("imm",F64),
                                         Var("strm4",OTy(LTy F8))],
                                      Call
                                        ("oimmediate8",
                                         PTy(F64,OTy(LTy F8)),
                                         Var("strm3",OTy(LTy F8))),
                                      ITE(EQ(Var("opcode",FTy 3),LW(6,3)),
                                          Call
                                            ("Zdec_fail",CTy"Zinst",
                                             LS
                                              "Unsupported opcode: Shift Group 2"),
                                          Call
                                            ("Zfull_inst",CTy"Zinst",
                                             TP[Var("p",LTy F8),
                                                Call
                                                  ("Zbinop",
                                                   CTy"instruction",
                                                   TP[Mop(Cast
                                                            (CTy"Zbinop_name"),
                                                          Bop(Add,
                                                              Mop(Cast nTy,
                                                                  Var("opcode",
                                                                      FTy 3)),
                                                              LN 8)),
                                                      Call
                                                        ("OpSize",
                                                         CTy"Zsize",
                                                         TP[bVar"have_rex",
                                                            Dest
                                                              ("W",bTy,
                                                               Var("REX",
                                                                   CTy"REX")),
                                                            Mop(Cast F1,
                                                                LL[bVar"v'0"]),
                                                            bVar"op_size_override"]),
                                                      Call
                                                        ("Zrm_i",
                                                         CTy"Zdest_src",
                                                         TP[Var("rm",
                                                                CTy"Zrm"),
                                                            Var("imm",F64)])]),
                                                Var("strm4",OTy(LTy F8))]))))),
                             (TP[TP[LT,LT,LF,LF,LF,LF,LT,bVar"v'0"],
                                 Var("strm2",LTy F8)],
                              ITE(EQ(Mop(Cast F1,LL[bVar"v'0"]),LW(0,1)),
                                  Let(TP[Var("imm",F64),
                                         Var("strm3",OTy(LTy F8))],
                                      Call
                                        ("immediate16",
                                         PTy(F64,OTy(LTy F8)),
                                         Var("strm2",LTy F8)),
                                      Call
                                        ("Zfull_inst",CTy"Zinst",
                                         TP[Var("p",LTy F8),
                                            Call
                                              ("Zret",CTy"instruction",
                                               Var("imm",F64)),
                                            Var("strm3",OTy(LTy F8))])),
                                  Call
                                    ("Zfull_inst",CTy"Zinst",
                                     TP[Var("p",LTy F8),
                                        Call
                                          ("Zret",CTy"instruction",
                                           LW(0,64)),
                                        Mop(Some,Var("strm2",LTy F8))]))),
                             (TP[TP[LT,LT,LF,LF,LF,LT,LT,bVar"v'0"],
                                 Var("strm2",LTy F8)],
                              Let(Var("size",CTy"Zsize"),
                                  Call
                                    ("OpSize",CTy"Zsize",
                                     TP[bVar"have_rex",
                                        Dest("W",bTy,Var("REX",CTy"REX")),
                                        Mop(Cast F1,LL[bVar"v'0"]),
                                        bVar"op_size_override"]),
                                  Let(TP[Var("opcode",FTy 3),
                                         Var("rm",CTy"Zrm"),
                                         Var("strm3",OTy(LTy F8))],
                                      Call
                                        ("readOpcodeModRM",
                                         PTy(FTy 3,
                                             PTy(CTy"Zrm",OTy(LTy F8))),
                                         TP[Var("REX",CTy"REX"),
                                            Var("strm2",LTy F8)]),
                                      Let(TP[Var("imm",F64),
                                             Var("strm4",OTy(LTy F8))],
                                          Call
                                            ("oimmediate",
                                             PTy(F64,OTy(LTy F8)),
                                             TP[Var("size",CTy"Zsize"),
                                                Var("strm3",OTy(LTy F8))]),
                                          ITE(EQ(Var("opcode",FTy 3),
                                                 LW(0,3)),
                                              Call
                                                ("Zfull_inst",CTy"Zinst",
                                                 TP[Var("p",LTy F8),
                                                    Call
                                                      ("Zmov",
                                                       CTy"instruction",
                                                       TP[LC("Z_ALWAYS",
                                                             CTy"Zcond"),
                                                          Var("size",
                                                              CTy"Zsize"),
                                                          Call
                                                            ("Zrm_i",
                                                             CTy"Zdest_src",
                                                             TP[Var("rm",
                                                                    CTy"Zrm"),
                                                                Var("imm",
                                                                    F64)])]),
                                                    Var("strm4",
                                                        OTy(LTy F8))]),
                                              Call
                                                ("Zdec_fail",CTy"Zinst",
                                                 LS
                                                  "Unsupported opcode: Group 11")))))),
                             (TP[TP[LT,LT,LF,LF,LT,LF,LF,LT],
                                 Var("strm2",LTy F8)],
                              Call
                                ("Zfull_inst",CTy"Zinst",
                                 TP[Var("p",LTy F8),
                                    Const("Zleave",CTy"instruction"),
                                    Mop(Some,Var("strm2",LTy F8))])),
                             (TP[TP[LT,LT,LF,LT,LF,LF,bVar"b'0",bVar"v'0"],
                                 Var("strm2",LTy F8)],
                              Let(TP[Var("opcode",FTy 3),
                                     Var("rm",CTy"Zrm"),
                                     Var("strm3",OTy(LTy F8))],
                                  Call
                                    ("readOpcodeModRM",
                                     PTy(FTy 3,PTy(CTy"Zrm",OTy(LTy F8))),
                                     TP[Var("REX",CTy"REX"),
                                        Var("strm2",LTy F8)]),
                                  ITE(EQ(Var("opcode",FTy 3),LW(6,3)),
                                      Call
                                        ("Zdec_fail",CTy"Zinst",
                                         LS
                                          "Unsupported opcode: Shift Group 2"),
                                      Call
                                        ("Zfull_inst",CTy"Zinst",
                                         TP[Var("p",LTy F8),
                                            Call
                                              ("Zbinop",CTy"instruction",
                                               TP[Mop(Cast
                                                        (CTy"Zbinop_name"),
                                                      Bop(Add,
                                                          Mop(Cast nTy,
                                                              Var("opcode",
                                                                  FTy 3)),
                                                          LN 8)),
                                                  Call
                                                    ("OpSize",CTy"Zsize",
                                                     TP[bVar"have_rex",
                                                        Dest
                                                          ("W",bTy,
                                                           Var("REX",
                                                               CTy"REX")),
                                                        Mop(Cast F1,
                                                            LL[bVar"v'0"]),
                                                        bVar"op_size_override"]),
                                                  ITE(EQ(Mop(Cast F1,
                                                             LL[bVar"b'0"]),
                                                         LW(0,1)),
                                                      Call
                                                        ("Zrm_i",
                                                         CTy"Zdest_src",
                                                         TP[Var("rm",
                                                                CTy"Zrm"),
                                                            LW(1,64)]),
                                                      Call
                                                        ("Zrm_r",
                                                         CTy"Zdest_src",
                                                         TP[Var("rm",
                                                                CTy"Zrm"),
                                                            LC("RCX",
                                                               CTy"Zreg")]))]),
                                            Var("strm3",OTy(LTy F8))])))),
                             (TP[TP[LT,LT,LT,LF,LF,LF,LF,bVar"b'0"],
                                 Var("strm2",LTy F8)],
                              Let(TP[Var("imm",F64),
                                     Var("strm3",OTy(LTy F8))],
                                  Call
                                    ("immediate8",PTy(F64,OTy(LTy F8)),
                                     Var("strm2",LTy F8)),
                                  Call
                                    ("Zfull_inst",CTy"Zinst",
                                     TP[Var("p",LTy F8),
                                        Call
                                          ("Zloop",CTy"instruction",
                                           TP[ITE(EQ(Mop(Cast F1,
                                                         LL[bVar"b'0"]),
                                                     LW(0,1)),
                                                  LC("Z_NE",CTy"Zcond"),
                                                  LC("Z_E",CTy"Zcond")),
                                              Var("imm",F64)]),
                                        Var("strm3",OTy(LTy F8))]))),
                             (TP[TP[LT,LT,LT,LF,LF,LF,LT,LF],
                                 Var("strm2",LTy F8)],
                              Let(TP[Var("imm",F64),
                                     Var("strm3",OTy(LTy F8))],
                                  Call
                                    ("immediate8",PTy(F64,OTy(LTy F8)),
                                     Var("strm2",LTy F8)),
                                  Call
                                    ("Zfull_inst",CTy"Zinst",
                                     TP[Var("p",LTy F8),
                                        Call
                                          ("Zloop",CTy"instruction",
                                           TP[LC("Z_ALWAYS",CTy"Zcond"),
                                              Var("imm",F64)]),
                                        Var("strm3",OTy(LTy F8))]))),
                             (TP[TP[LT,LT,LT,LF,LT,LF,LF,LF],
                                 Var("strm2",LTy F8)],
                              Let(TP[Var("imm",F64),
                                     Var("strm3",OTy(LTy F8))],
                                  Call
                                    ("immediate32",PTy(F64,OTy(LTy F8)),
                                     Var("strm2",LTy F8)),
                                  Call
                                    ("Zfull_inst",CTy"Zinst",
                                     TP[Var("p",LTy F8),
                                        Call
                                          ("Zcall",CTy"instruction",
                                           Call
                                             ("Zimm",CTy"Zimm_rm",
                                              Var("imm",F64))),
                                        Var("strm3",OTy(LTy F8))]))),
                             (TP[TP[LT,LT,LT,LF,LT,LF,bVar"b'0",LT],
                                 Var("strm2",LTy F8)],
                              Let(TP[Var("imm",F64),
                                     Var("strm3",OTy(LTy F8))],
                                  ITE(EQ(Mop(Cast F1,LL[bVar"b'0"]),
                                         LW(0,1)),
                                      Call
                                        ("immediate32",
                                         PTy(F64,OTy(LTy F8)),
                                         Var("strm2",LTy F8)),
                                      Call
                                        ("immediate8",
                                         PTy(F64,OTy(LTy F8)),
                                         Var("strm2",LTy F8))),
                                  Call
                                    ("Zfull_inst",CTy"Zinst",
                                     TP[Var("p",LTy F8),
                                        Call
                                          ("Zjcc",CTy"instruction",
                                           TP[LC("Z_ALWAYS",CTy"Zcond"),
                                              Var("imm",F64)]),
                                        Var("strm3",OTy(LTy F8))]))),
                             (TP[TP[LT,LT,LT,LT,LF,LT,LF,LT],
                                 Var("strm2",LTy F8)],
                              Call
                                ("Zfull_inst",CTy"Zinst",
                                 TP[Var("p",LTy F8),
                                    Const("Zcmc",CTy"instruction"),
                                    Mop(Some,Var("strm2",LTy F8))])),
                             (TP[TP[LT,LT,LT,LT,LF,LT,LT,bVar"v'0"],
                                 Var("strm2",LTy F8)],
                              Let(Var("size",CTy"Zsize"),
                                  Call
                                    ("OpSize",CTy"Zsize",
                                     TP[bVar"have_rex",
                                        Dest("W",bTy,Var("REX",CTy"REX")),
                                        Mop(Cast F1,LL[bVar"v'0"]),
                                        bVar"op_size_override"]),
                                  Let(TP[Var("opcode",FTy 3),
                                         Var("rm",CTy"Zrm"),
                                         Var("strm3",OTy(LTy F8))],
                                      Call
                                        ("readOpcodeModRM",
                                         PTy(FTy 3,
                                             PTy(CTy"Zrm",OTy(LTy F8))),
                                         TP[Var("REX",CTy"REX"),
                                            Var("strm2",LTy F8)]),
                                      CS(Var("opcode",FTy 3),
                                         [(LW(0,3),
                                           Let(TP[Var("imm",F64),
                                                  Var("strm4",OTy(LTy F8))],
                                               Call
                                                 ("oimmediate",
                                                  PTy(F64,OTy(LTy F8)),
                                                  TP[Var("size",CTy"Zsize"),
                                                     Var("strm3",
                                                         OTy(LTy F8))]),
                                               Call
                                                 ("Zfull_inst",CTy"Zinst",
                                                  TP[Var("p",LTy F8),
                                                     Call
                                                       ("Zbinop",
                                                        CTy"instruction",
                                                        TP[LC("Ztest",
                                                              CTy"Zbinop_name"),
                                                           Var("size",
                                                               CTy"Zsize"),
                                                           Call
                                                             ("Zrm_i",
                                                              CTy"Zdest_src",
                                                              TP[Var("rm",
                                                                     CTy"Zrm"),
                                                                 Var("imm",
                                                                     F64)])]),
                                                     Var("strm4",
                                                         OTy(LTy F8))]))),
                                          (LW(2,3),
                                           Call
                                             ("Zfull_inst",CTy"Zinst",
                                              TP[Var("p",LTy F8),
                                                 Call
                                                   ("Zmonop",
                                                    CTy"instruction",
                                                    TP[LC("Znot",
                                                          CTy"Zmonop_name"),
                                                       Var("size",
                                                           CTy"Zsize"),
                                                       Var("rm",CTy"Zrm")]),
                                                 Var("strm3",OTy(LTy F8))])),
                                          (LW(3,3),
                                           Call
                                             ("Zfull_inst",CTy"Zinst",
                                              TP[Var("p",LTy F8),
                                                 Call
                                                   ("Zmonop",
                                                    CTy"instruction",
                                                    TP[LC("Zneg",
                                                          CTy"Zmonop_name"),
                                                       Var("size",
                                                           CTy"Zsize"),
                                                       Var("rm",CTy"Zrm")]),
                                                 Var("strm3",OTy(LTy F8))])),
                                          (LW(4,3),
                                           Call
                                             ("Zfull_inst",CTy"Zinst",
                                              TP[Var("p",LTy F8),
                                                 Call
                                                   ("Zmul",
                                                    CTy"instruction",
                                                    TP[Var("size",
                                                           CTy"Zsize"),
                                                       Var("rm",CTy"Zrm")]),
                                                 Var("strm3",OTy(LTy F8))])),
                                          (LW(6,3),
                                           Call
                                             ("Zfull_inst",CTy"Zinst",
                                              TP[Var("p",LTy F8),
                                                 Call
                                                   ("Zdiv",
                                                    CTy"instruction",
                                                    TP[Var("size",
                                                           CTy"Zsize"),
                                                       Var("rm",CTy"Zrm")]),
                                                 Var("strm3",OTy(LTy F8))])),
                                          (AVar(FTy 3),
                                           Call
                                             ("Zdec_fail",CTy"Zinst",
                                              LS
                                               "Unsupported opcode: Unary Group 3"))])))),
                             (TP[TP[LT,LT,LT,LT,LT,LF,LF,LF],
                                 Var("strm2",LTy F8)],
                              Call
                                ("Zfull_inst",CTy"Zinst",
                                 TP[Var("p",LTy F8),
                                    Const("Zclc",CTy"instruction"),
                                    Mop(Some,Var("strm2",LTy F8))])),
                             (TP[TP[LT,LT,LT,LT,LT,LF,LF,LT],
                                 Var("strm2",LTy F8)],
                              Call
                                ("Zfull_inst",CTy"Zinst",
                                 TP[Var("p",LTy F8),
                                    Const("Zstc",CTy"instruction"),
                                    Mop(Some,Var("strm2",LTy F8))])),
                             (TP[TP[LT,LT,LT,LT,LT,LT,LT,LF],
                                 Var("strm2",LTy F8)],
                              Let(TP[Var("opcode",FTy 3),
                                     Var("rm",CTy"Zrm"),
                                     Var("strm3",OTy(LTy F8))],
                                  Call
                                    ("readOpcodeModRM",
                                     PTy(FTy 3,PTy(CTy"Zrm",OTy(LTy F8))),
                                     TP[Var("REX",CTy"REX"),
                                        Var("strm2",LTy F8)]),
                                  ITB([(EQ(Var("opcode",FTy 3),LW(0,3)),
                                        Call
                                          ("Zfull_inst",CTy"Zinst",
                                           TP[Var("p",LTy F8),
                                              Call
                                                ("Zmonop",
                                                 CTy"instruction",
                                                 TP[LC("Zinc",
                                                       CTy"Zmonop_name"),
                                                    Call
                                                      ("Z8",CTy"Zsize",
                                                       bVar"have_rex"),
                                                    Var("rm",CTy"Zrm")]),
                                              Var("strm3",OTy(LTy F8))])),
                                       (EQ(Var("opcode",FTy 3),LW(1,3)),
                                        Call
                                          ("Zfull_inst",CTy"Zinst",
                                           TP[Var("p",LTy F8),
                                              Call
                                                ("Zmonop",
                                                 CTy"instruction",
                                                 TP[LC("Zdec",
                                                       CTy"Zmonop_name"),
                                                    Call
                                                      ("Z8",CTy"Zsize",
                                                       bVar"have_rex"),
                                                    Var("rm",CTy"Zrm")]),
                                              Var("strm3",OTy(LTy F8))]))],
                                      Call
                                        ("Zdec_fail",CTy"Zinst",
                                         LS
                                          "Unsupported opcode: INC/DEC Group 4")))),
                             (TP[TP[LT,LT,LT,LT,LT,LT,LT,LT],
                                 Var("strm2",LTy F8)],
                              Let(Var("size",CTy"Zsize"),
                                  Call
                                    ("OpSize",CTy"Zsize",
                                     TP[bVar"have_rex",
                                        Dest("W",bTy,Var("REX",CTy"REX")),
                                        LW(1,1),bVar"op_size_override"]),
                                  Let(TP[Var("opcode",FTy 3),
                                         Var("rm",CTy"Zrm"),
                                         Var("strm3",OTy(LTy F8))],
                                      Call
                                        ("readOpcodeModRM",
                                         PTy(FTy 3,
                                             PTy(CTy"Zrm",OTy(LTy F8))),
                                         TP[Var("REX",CTy"REX"),
                                            Var("strm2",LTy F8)]),
                                      CS(Var("opcode",FTy 3),
                                         [(LW(0,3),
                                           Call
                                             ("Zfull_inst",CTy"Zinst",
                                              TP[Var("p",LTy F8),
                                                 Call
                                                   ("Zmonop",
                                                    CTy"instruction",
                                                    TP[LC("Zinc",
                                                          CTy"Zmonop_name"),
                                                       Var("size",
                                                           CTy"Zsize"),
                                                       Var("rm",CTy"Zrm")]),
                                                 Var("strm3",OTy(LTy F8))])),
                                          (LW(1,3),
                                           Call
                                             ("Zfull_inst",CTy"Zinst",
                                              TP[Var("p",LTy F8),
                                                 Call
                                                   ("Zmonop",
                                                    CTy"instruction",
                                                    TP[LC("Zdec",
                                                          CTy"Zmonop_name"),
                                                       Var("size",
                                                           CTy"Zsize"),
                                                       Var("rm",CTy"Zrm")]),
                                                 Var("strm3",OTy(LTy F8))])),
                                          (LW(2,3),
                                           Call
                                             ("Zfull_inst",CTy"Zinst",
                                              TP[Var("p",LTy F8),
                                                 Call
                                                   ("Zcall",
                                                    CTy"instruction",
                                                    Call
                                                      ("Zrm",CTy"Zimm_rm",
                                                       Var("rm",CTy"Zrm"))),
                                                 Var("strm3",OTy(LTy F8))])),
                                          (LW(4,3),
                                           Call
                                             ("Zfull_inst",CTy"Zinst",
                                              TP[Var("p",LTy F8),
                                                 Call
                                                   ("Zjmp",
                                                    CTy"instruction",
                                                    Var("rm",CTy"Zrm")),
                                                 Var("strm3",OTy(LTy F8))])),
                                          (LW(6,3),
                                           Call
                                             ("Zfull_inst",CTy"Zinst",
                                              TP[Var("p",LTy F8),
                                                 Call
                                                   ("Zpush",
                                                    CTy"instruction",
                                                    Call
                                                      ("Zrm",CTy"Zimm_rm",
                                                       Var("rm",CTy"Zrm"))),
                                                 Var("strm3",OTy(LTy F8))])),
                                          (AVar(FTy 3),
                                           Call
                                             ("Zdec_fail",CTy"Zinst",
                                              LS
                                               "Unsupported opcode: INC/DEC Group 5"))])))),
                             (TP[TP[LF,LF,LF,LF,LT,LT,LT,LT],
                                 LLC([LW(56,8),Var("opc",F8)],AVar(LTy F8))],
                              Call
                                ("Zdec_fail",CTy"Zinst",
                                 CC[LS"Unsupported opcode: 0F 38 ",
                                    Mop(Cast sTy,Var("opc",F8))])),
                             (TP[TP[LF,LF,LF,LF,LT,LT,LT,LT],
                                 LLC([LW(58,8),Var("opc",F8)],AVar(LTy F8))],
                              Call
                                ("Zdec_fail",CTy"Zinst",
                                 CC[LS"Unsupported opcode: 0F 3A ",
                                    Mop(Cast sTy,Var("opc",F8))])),
                             (TP[TP[LF,LF,LF,LF,LT,LT,LT,LT],
                                 LLC([Var("opc",F8)],Var("strm2",LTy F8))],
                              Let(TP[bVar"b'7",bVar"b'6",bVar"b'5",
                                     bVar"b'4",bVar"b'3",bVar"b'2",
                                     bVar"b'1",bVar"b'0"],
                                  BL(8,Var("opc",F8)),
                                  ITB([(Bop(And,Mop(Not,bVar"b'7"),
                                            Bop(And,bVar"b'6",
                                                Bop(And,
                                                    Mop(Not,bVar"b'5"),
                                                    Mop(Not,bVar"b'4")))),
                                        Let(TP[Var("reg",CTy"Zreg"),
                                               Var("rm",CTy"Zrm"),
                                               Var("strm3",OTy(LTy F8))],
                                            Call
                                              ("readModRM",
                                               PTy(CTy"Zreg",
                                                   PTy(CTy"Zrm",
                                                       OTy(LTy F8))),
                                               TP[Var("REX",CTy"REX"),
                                                  Var("strm2",LTy F8)]),
                                            Call
                                              ("Zfull_inst",CTy"Zinst",
                                               TP[Var("p",LTy F8),
                                                  Call
                                                    ("Zmov",
                                                     CTy"instruction",
                                                     TP[Mop(Cast
                                                              (CTy"Zcond"),
                                                            Mop(Cast F4,
                                                                LL[bVar"b'3",
                                                                   bVar"b'2",
                                                                   bVar"b'1",
                                                                   bVar"b'0"])),
                                                        Call
                                                          ("OpSize",
                                                           CTy"Zsize",
                                                           TP[LT,
                                                              Dest
                                                                ("W",bTy,
                                                                 Var("REX",
                                                                     CTy"REX")),
                                                              LW(1,1),
                                                              bVar"op_size_override"]),
                                                        Call
                                                          ("Zr_rm",
                                                           CTy"Zdest_src",
                                                           TP[Var("reg",
                                                                  CTy"Zreg"),
                                                              Var("rm",
                                                                  CTy"Zrm")])]),
                                                  Var("strm3",OTy(LTy F8))]))),
                                       (Bop(And,bVar"b'7",
                                            Bop(And,Mop(Not,bVar"b'6"),
                                                Bop(And,
                                                    Mop(Not,bVar"b'5"),
                                                    Mop(Not,bVar"b'4")))),
                                        Let(TP[Var("imm",F64),
                                               Var("strm3",OTy(LTy F8))],
                                            Call
                                              ("immediate32",
                                               PTy(F64,OTy(LTy F8)),
                                               Var("strm2",LTy F8)),
                                            Call
                                              ("Zfull_inst",CTy"Zinst",
                                               TP[Var("p",LTy F8),
                                                  Call
                                                    ("Zjcc",
                                                     CTy"instruction",
                                                     TP[Mop(Cast
                                                              (CTy"Zcond"),
                                                            Mop(Cast F4,
                                                                LL[bVar"b'3",
                                                                   bVar"b'2",
                                                                   bVar"b'1",
                                                                   bVar"b'0"])),
                                                        Var("imm",F64)]),
                                                  Var("strm3",OTy(LTy F8))]))),
                                       (Bop(And,bVar"b'7",
                                            Bop(And,Mop(Not,bVar"b'6"),
                                                Bop(And,
                                                    Mop(Not,bVar"b'5"),
                                                    bVar"b'4"))),
                                        Let(TP[AVar(CTy"Zreg"),
                                               Var("rm",CTy"Zrm"),
                                               Var("strm3",OTy(LTy F8))],
                                            Call
                                              ("readModRM",
                                               PTy(CTy"Zreg",
                                                   PTy(CTy"Zrm",
                                                       OTy(LTy F8))),
                                               TP[Var("REX",CTy"REX"),
                                                  Var("strm2",LTy F8)]),
                                            Call
                                              ("Zfull_inst",CTy"Zinst",
                                               TP[Var("p",LTy F8),
                                                  Call
                                                    ("Zset",
                                                     CTy"instruction",
                                                     TP[Mop(Cast
                                                              (CTy"Zcond"),
                                                            Mop(Cast F4,
                                                                LL[bVar"b'3",
                                                                   bVar"b'2",
                                                                   bVar"b'1",
                                                                   bVar"b'0"])),
                                                        bVar"have_rex",
                                                        Var("rm",CTy"Zrm")]),
                                                  Var("strm3",OTy(LTy F8))]))),
                                       (Bop(And,bVar"b'7",
                                            Bop(And,Mop(Not,bVar"b'6"),
                                                Bop(And,bVar"b'5",
                                                    Bop(And,bVar"b'4",
                                                        Bop(And,
                                                            Mop(Not,
                                                                bVar"b'3"),
                                                            Bop(And,
                                                                Mop(Not,
                                                                    bVar"b'2"),
                                                                Mop(Not,
                                                                    bVar"b'1"))))))),
                                        Let(TP[Var("reg",CTy"Zreg"),
                                               Var("rm",CTy"Zrm"),
                                               Var("strm3",OTy(LTy F8))],
                                            Call
                                              ("readModRM",
                                               PTy(CTy"Zreg",
                                                   PTy(CTy"Zrm",
                                                       OTy(LTy F8))),
                                               TP[Var("REX",CTy"REX"),
                                                  Var("strm2",LTy F8)]),
                                            Call
                                              ("Zfull_inst",CTy"Zinst",
                                               TP[Var("p",LTy F8),
                                                  Call
                                                    ("Zcmpxchg",
                                                     CTy"instruction",
                                                     TP[Call
                                                          ("OpSize",
                                                           CTy"Zsize",
                                                           TP[bVar"have_rex",
                                                              Dest
                                                                ("W",bTy,
                                                                 Var("REX",
                                                                     CTy"REX")),
                                                              Mop(Cast F1,
                                                                  LL[bVar"b'0"]),
                                                              bVar"op_size_override"]),
                                                        Var("rm",CTy"Zrm"),
                                                        Var("reg",
                                                            CTy"Zreg")]),
                                                  Var("strm3",OTy(LTy F8))]))),
                                       (Bop(And,bVar"b'7",
                                            Bop(And,bVar"b'6",
                                                Bop(And,
                                                    Mop(Not,bVar"b'5"),
                                                    Bop(And,
                                                        Mop(Not,bVar"b'4"),
                                                        Bop(And,
                                                            Mop(Not,
                                                                bVar"b'3"),
                                                            Bop(And,
                                                                Mop(Not,
                                                                    bVar"b'2"),
                                                                Mop(Not,
                                                                    bVar"b'1"))))))),
                                        Let(TP[Var("reg",CTy"Zreg"),
                                               Var("rm",CTy"Zrm"),
                                               Var("strm3",OTy(LTy F8))],
                                            Call
                                              ("readModRM",
                                               PTy(CTy"Zreg",
                                                   PTy(CTy"Zrm",
                                                       OTy(LTy F8))),
                                               TP[Var("REX",CTy"REX"),
                                                  Var("strm2",LTy F8)]),
                                            Call
                                              ("Zfull_inst",CTy"Zinst",
                                               TP[Var("p",LTy F8),
                                                  Call
                                                    ("Zxadd",
                                                     CTy"instruction",
                                                     TP[Call
                                                          ("OpSize",
                                                           CTy"Zsize",
                                                           TP[bVar"have_rex",
                                                              Dest
                                                                ("W",bTy,
                                                                 Var("REX",
                                                                     CTy"REX")),
                                                              Mop(Cast F1,
                                                                  LL[bVar"b'0"]),
                                                              bVar"op_size_override"]),
                                                        Var("rm",CTy"Zrm"),
                                                        Var("reg",
                                                            CTy"Zreg")]),
                                                  Var("strm3",OTy(LTy F8))]))),
                                       (Bop(And,bVar"b'7",
                                            Bop(And,Mop(Not,bVar"b'6"),
                                                Bop(And,bVar"b'5",
                                                    Bop(And,bVar"b'4",
                                                        Bop(And,bVar"b'2",
                                                            bVar"b'1"))))),
                                        Let(TP[Var("reg",CTy"Zreg"),
                                               Var("rm",CTy"Zrm"),
                                               Var("strm3",OTy(LTy F8))],
                                            Call
                                              ("readModRM",
                                               PTy(CTy"Zreg",
                                                   PTy(CTy"Zrm",
                                                       OTy(LTy F8))),
                                               TP[Var("REX",CTy"REX"),
                                                  Var("strm2",LTy F8)]),
                                            Let(TP[Var("arg0",CTy"Zsize"),
                                                   Var("arg1",
                                                       CTy"Zdest_src"),
                                                   Var("arg2",CTy"Zsize")],
                                                TP[ITE(EQ(Mop(Cast F1,
                                                              LL[bVar"b'0"]),
                                                          LW(1,1)),
                                                       Const
                                                         ("Z16",CTy"Zsize"),
                                                       Call
                                                         ("Z8",CTy"Zsize",
                                                          bVar"have_rex")),
                                                   Call
                                                     ("Zr_rm",
                                                      CTy"Zdest_src",
                                                      TP[Var("reg",
                                                             CTy"Zreg"),
                                                         Var("rm",CTy"Zrm")]),
                                                   Call
                                                     ("OpSize",CTy"Zsize",
                                                      TP[bVar"have_rex",
                                                         Dest
                                                           ("W",bTy,
                                                            Var("REX",
                                                                CTy"REX")),
                                                         LW(1,1),
                                                         bVar"op_size_override"])],
                                                Call
                                                  ("Zfull_inst",
                                                   CTy"Zinst",
                                                   TP[Var("p",LTy F8),
                                                      ITE(EQ(Mop(Cast F1,
                                                                 LL[bVar"b'3"]),
                                                             LW(1,1)),
                                                          Call
                                                            ("Zmovsx",
                                                             CTy"instruction",
                                                             TP[Var("arg0",
                                                                    CTy"Zsize"),
                                                                Var("arg1",
                                                                    CTy"Zdest_src"),
                                                                Var("arg2",
                                                                    CTy"Zsize")]),
                                                          Call
                                                            ("Zmovzx",
                                                             CTy"instruction",
                                                             TP[Var("arg0",
                                                                    CTy"Zsize"),
                                                                Var("arg1",
                                                                    CTy"Zdest_src"),
                                                                Var("arg2",
                                                                    CTy"Zsize")])),
                                                      Var("strm3",
                                                          OTy(LTy F8))]))))],
                                      Call
                                        ("Zdec_fail",CTy"Zinst",
                                         CC[LS"Unsupported opcode: 0F ",
                                            Mop(Cast sTy,Var("opc",F8))])))),
                             (TP[TP[bVar"opc'7",bVar"opc'6",bVar"opc'5",
                                    bVar"opc'4",bVar"opc'3",bVar"opc'2",
                                    bVar"opc'1",bVar"opc'0"],AVar(LTy F8)],
                              Call
                                ("Zdec_fail",CTy"Zinst",
                                 CC[LS"Unsupported opcode: ",
                                    Mop(Cast sTy,
                                        Mop(Cast F8,
                                            LL[bVar"opc'7",bVar"opc'6",
                                               bVar"opc'5",bVar"opc'4",
                                               bVar"opc'3",bVar"opc'2",
                                               bVar"opc'1",bVar"opc'0"]))]))])),
                        (LNL F8,Call("Zdec_fail",CTy"Zinst",LS"No opcode"))])))))]))
;
val x64_fetch_def = Def
  ("x64_fetch",qVar"state",
   Mop(Fst,
       Mop(Snd,
           Apply
             (For(TP[LN 19,LN 0,
                     Close
                       (nVar"i",
                        Close
                          (Var("state",PTy(LTy F8,qTy)),
                           TP[LU,
                              LLC([Apply
                                     (Dest
                                        ("MEM",ATy(F64,F8),
                                         Mop(Snd,
                                             Var("state",PTy(LTy F8,qTy)))),
                                      Bop(Add,
                                          Dest
                                            ("RIP",F64,
                                             Mop(Snd,
                                                 Var("state",
                                                     PTy(LTy F8,qTy)))),
                                          Mop(Cast F64,nVar"i")))],
                                  Mop(Fst,Var("state",PTy(LTy F8,qTy)))),
                              Mop(Snd,Var("state",PTy(LTy F8,qTy)))]))]),
              TP[LNL F8,qVar"state"]))))
;
val x64_next_def = Def
  ("x64_next",qVar"state",
   CS(Call
        ("x64_decode",CTy"Zinst",
         Apply(Const("x64_fetch",ATy(qTy,LTy F8)),qVar"state")),
      [(Call
          ("Zfull_inst",CTy"Zinst",
           TP[AVar(LTy F8),Var("i",CTy"instruction"),
              Mop(Some,Var("strm1",LTy F8))]),
        Apply
          (Call("Run",ATy(qTy,qTy),Var("i",CTy"instruction")),
           Rupd
             ("RIP",
              TP[qVar"state",
                 Bop(Add,Dest("RIP",F64,qVar"state"),
                     Mop(Cast F64,
                         Bop(Sub,LN 20,Mop(Length,Var("strm1",LTy F8)))))]))),
       (Call
          ("Zfull_inst",CTy"Zinst",
           TP[AVar(LTy F8),AVar(CTy"instruction"),LO(LTy F8)]),
        Mop(Snd,
            Apply
              (Call
                 ("raise'exception",ATy(qTy,PTy(uTy,qTy)),
                  Call("FAILURE",CTy"exception",LS"not enough bytes")),
               qVar"state"))),
       (Call("Zdec_fail",CTy"Zinst",sVar"s0"),
        Mop(Snd,
            Apply
              (Call
                 ("raise'exception",ATy(qTy,PTy(uTy,qTy)),
                  Call("FAILURE",CTy"exception",sVar"s0")),qVar"state")))]))
;
val e_imm8_def = Def
  ("e_imm8",Var("imm",F64),
   ITE(Bop(And,Bop(Le,LW(18446744073709551488,64),Var("imm",F64)),
           Bop(Le,Var("imm",F64),LW(127,64))),
       LL[EX(Var("imm",F64),LN 7,LN 0,F8)],LNL F8))
;
val e_imm16_def = Def
  ("e_imm16",Var("imm",F64),
   ITE(Bop(And,Bop(Le,LW(18446744073709518848,64),Var("imm",F64)),
           Bop(Le,Var("imm",F64),LW(32767,64))),
       LL[EX(Var("imm",F64),LN 7,LN 0,F8),EX(Var("imm",F64),LN 15,LN 8,F8)],
       LNL F8))
;
val e_imm32_def = Def
  ("e_imm32",Var("imm",F64),
   ITE(Bop(And,Bop(Le,LW(18446744071562067968,64),Var("imm",F64)),
           Bop(Le,Var("imm",F64),LW(2147483647,64))),
       LL[EX(Var("imm",F64),LN 7,LN 0,F8),
          EX(Var("imm",F64),LN 15,LN 8,F8),
          EX(Var("imm",F64),LN 23,LN 16,F8),
          EX(Var("imm",F64),LN 31,LN 24,F8)],LNL F8))
;
val e_imm64_def = Def
  ("e_imm64",Var("imm",F64),
   LL[EX(Var("imm",F64),LN 7,LN 0,F8),EX(Var("imm",F64),LN 15,LN 8,F8),
      EX(Var("imm",F64),LN 23,LN 16,F8),EX(Var("imm",F64),LN 31,LN 24,F8),
      EX(Var("imm",F64),LN 39,LN 32,F8),EX(Var("imm",F64),LN 47,LN 40,F8),
      EX(Var("imm",F64),LN 55,LN 48,F8),EX(Var("imm",F64),LN 63,LN 56,F8)])
;
val e_imm_def = Def
  ("e_imm",Var("imm",F64),
   CS(Call("e_imm8",LTy F8,Var("imm",F64)),
      [(LNL F8,
        CS(Call("e_imm16",LTy F8,Var("imm",F64)),
           [(LNL F8,
             CS(Call("e_imm32",LTy F8,Var("imm",F64)),
                [(LNL F8,Call("e_imm64",LTy F8,Var("imm",F64))),
                 (Var("l",LTy F8),Var("l",LTy F8))])),
            (Var("l",LTy F8),Var("l",LTy F8))])),
       (Var("l",LTy F8),Var("l",LTy F8))]))
;
val e_imm_8_32_def = Def
  ("e_imm_8_32",Var("imm",F64),
   CS(Call("e_imm8",LTy F8,Var("imm",F64)),
      [(LNL F8,
        CS(Call("e_imm32",LTy F8,Var("imm",F64)),
           [(LNL F8,TP[LN 8,LNL F8]),
            (Var("l",LTy F8),TP[LN 4,Var("l",LTy F8)])])),
       (Var("l",LTy F8),TP[LN 1,Var("l",LTy F8)])]))
;
val e_ModRM_def = Def
  ("e_ModRM",TP[Var("r",F4),Var("rm",CTy"Zrm")],
   CS(Var("rm",CTy"Zrm"),
      [(Call
          ("Zm",CTy"Zrm",
           TP[LO(PTy(FTy 2,CTy"Zreg")),Const("ZripBase",CTy"Zbase"),
              Var("displacement",F64)]),
        Mop(Some,
            TP[CC[LW(0,1),EX(Var("r",F4),LN 3,LN 3,F1),LW(0,2)],
               LLC([CC[LW(0,2),EX(Var("r",F4),LN 2,LN 0,FTy 3),LW(5,3)]],
                   Call("e_imm32",LTy F8,Var("displacement",F64)))])),
       (Call("Zr",CTy"Zrm",Var("rm",CTy"Zreg")),
        Let(Var("rm",F4),Mop(Cast F4,Var("rm",CTy"Zreg")),
            Mop(Some,
                TP[CC[LW(0,1),EX(Var("r",F4),LN 3,LN 3,F1),LW(0,1),
                      EX(Var("rm",F4),LN 3,LN 3,F1)],
                   LL[CC[LW(3,2),EX(Var("r",F4),LN 2,LN 0,FTy 3),
                         EX(Var("rm",F4),LN 2,LN 0,FTy 3)]]]))),
       (Call
          ("Zm",CTy"Zrm",
           TP[LO(PTy(FTy 2,CTy"Zreg")),Const("ZnoBase",CTy"Zbase"),
              Var("imm",F64)]),
        CS(Call("e_imm32",LTy F8,Var("imm",F64)),
           [(LNL F8,LO(PTy(F4,LTy F8))),
            (Var("l",LTy F8),
             Mop(Some,
                 TP[CC[LW(0,1),EX(Var("r",F4),LN 3,LN 3,F1),LW(0,2)],
                    CC[LL[CC[LW(0,2),EX(Var("r",F4),LN 2,LN 0,FTy 3),
                             LW(4,3)],LW(37,8)],Var("l",LTy F8)]]))])),
       (Call
          ("Zm",CTy"Zrm",
           TP[Mop(Some,TP[Var("ss",FTy 2),Var("index",CTy"Zreg")]),
              Const("ZnoBase",CTy"Zbase"),Var("imm",F64)]),
        Let(Var("i",F4),Mop(Cast F4,Var("index",CTy"Zreg")),
            CS(Call("e_imm32",LTy F8,Var("imm",F64)),
               [(LNL F8,LO(PTy(F4,LTy F8))),
                (Var("l",LTy F8),
                 Mop(Some,
                     TP[CC[LW(0,1),EX(Var("r",F4),LN 3,LN 3,F1),
                           EX(Var("i",F4),LN 3,LN 3,F1),LW(0,1)],
                        CC[LL[CC[LW(0,2),EX(Var("r",F4),LN 2,LN 0,FTy 3),
                                 LW(4,3)],
                              CC[Var("ss",FTy 2),
                                 EX(Var("i",F4),LN 2,LN 0,FTy 3),LW(5,3)]],
                           Var("l",LTy F8)]]))]))),
       (Call
          ("Zm",CTy"Zrm",
           TP[Mop(Some,TP[Var("ss",FTy 2),Var("index",CTy"Zreg")]),
              Call("ZregBase",CTy"Zbase",Var("base",CTy"Zreg")),
              Var("imm",F64)]),
        Let(Var("b",F4),Mop(Cast F4,Var("base",CTy"Zreg")),
            Let(Var("i",F4),Mop(Cast F4,Var("index",CTy"Zreg")),
                Let(Var("b20",FTy 3),EX(Var("b",F4),LN 2,LN 0,FTy 3),
                    Let(TP[nVar"s",Var("l",LTy F8)],
                        ITE(Bop(And,EQ(Var("imm",F64),LW(0,64)),
                                Mop(Not,EQ(Var("b20",FTy 3),LW(5,3)))),
                            TP[LN 0,LNL F8],
                            Call
                              ("e_imm_8_32",PTy(nTy,LTy F8),Var("imm",F64))),
                        ITE(Bop(In,nVar"s",SL[LN 0,LN 1,LN 4]),
                            Mop(Some,
                                TP[CC[LW(0,1),
                                      EX(Var("r",F4),LN 3,LN 3,F1),
                                      EX(Var("i",F4),LN 3,LN 3,F1),
                                      EX(Var("b",F4),LN 3,LN 3,F1)],
                                   CC[LL[CC[CS(nVar"s",
                                               [(LN 0,LW(0,2)),
                                                (LN 1,LW(1,2)),
                                                (AVar nTy,LW(2,2))]),
                                            EX(Var("r",F4),LN 2,LN 0,FTy 3),
                                            LW(4,3)],
                                         CC[Var("ss",FTy 2),
                                            EX(Var("i",F4),LN 2,LN 0,FTy 3),
                                            Var("b20",FTy 3)]],
                                      Var("l",LTy F8)]]),
                            LO(PTy(F4,LTy F8)))))))),
       (Call
          ("Zm",CTy"Zrm",
           TP[LO(PTy(FTy 2,CTy"Zreg")),
              Call("ZregBase",CTy"Zbase",Var("base",CTy"Zreg")),
              Var("imm",F64)]),
        Let(Var("base",F4),Mop(Cast F4,Var("base",CTy"Zreg")),
            Let(Var("base20",FTy 3),EX(Var("base",F4),LN 2,LN 0,FTy 3),
                Let(TP[nVar"s",Var("l",LTy F8)],
                    ITE(Bop(And,EQ(Var("imm",F64),LW(0,64)),
                            Mop(Not,EQ(Var("base20",FTy 3),LW(5,3)))),
                        TP[LN 0,LNL F8],
                        Call("e_imm_8_32",PTy(nTy,LTy F8),Var("imm",F64))),
                    ITE(Bop(In,nVar"s",SL[LN 0,LN 1,LN 4]),
                        Mop(Some,
                            TP[CC[LW(0,1),EX(Var("r",F4),LN 3,LN 3,F1),
                                  LW(0,1),EX(Var("base",F4),LN 3,LN 3,F1)],
                               CC[LLC([CC[CS(nVar"s",
                                             [(LN 0,LW(0,2)),
                                              (LN 1,LW(1,2)),
                                              (AVar nTy,LW(2,2))]),
                                          EX(Var("r",F4),LN 2,LN 0,FTy 3),
                                          Var("base20",FTy 3)]],
                                      ITE(EQ(Var("base20",FTy 3),LW(4,3)),
                                          LL[CC[LW(4,5),
                                                Var("base20",FTy 3)]],
                                          LNL F8)),Var("l",LTy F8)]]),
                        LO(PTy(F4,LTy F8))))))),
       (AVar(CTy"Zrm"),LO(PTy(F4,LTy F8)))]))
;
val rex_prefix_def = Def
  ("rex_prefix",Var("rex",F4),
   ITE(EQ(Var("rex",F4),LW(0,4)),LNL F8,LL[CC[LW(4,4),Var("rex",F4)]]))
;
val e_opsize_def = Def
  ("e_opsize",TP[Var("sz",CTy"Zsize"),Var("rex",F4)],
   CS(Var("sz",CTy"Zsize"),
      [(Call("Z8",CTy"Zsize",bVar"have_rex"),
        Let(Var("p",LTy F8),Call("rex_prefix",LTy F8,Var("rex",F4)),
            TP[ITE(Bop(And,bVar"have_rex",EQ(Var("p",LTy F8),LNL F8)),
                   LL[LW(64,8)],Var("p",LTy F8)),LW(0,8)])),
       (Const("Z16",CTy"Zsize"),
        TP[CC[LL[LW(102,8)],
              Call("rex_prefix",LTy F8,Bop(BAnd,Var("rex",F4),LW(7,4)))],
           LW(1,8)]),
       (Const("Z32",CTy"Zsize"),
        TP[Call("rex_prefix",LTy F8,Bop(BAnd,Var("rex",F4),LW(7,4))),
           LW(1,8)]),
       (Const("Z64",CTy"Zsize"),
        TP[Call("rex_prefix",LTy F8,Bop(BOr,Var("rex",F4),LW(8,4))),
           LW(1,8)])]))
;
val e_opsize_imm_def = Def
  ("e_opsize_imm",
   TP[Var("sz",CTy"Zsize"),Var("rex",F4),Var("imm",F64),bVar"normal"],
   Let(TP[Var("prefixes",LTy F8),Var("v",F8)],
       Call
         ("e_opsize",PTy(LTy F8,F8),TP[Var("sz",CTy"Zsize"),Var("rex",F4)]),
       CS(ITE(Bop(And,EQ(Var("sz",CTy"Zsize"),Const("Z64",CTy"Zsize")),
                  bVar"normal"),Const("Z32",CTy"Zsize"),
              Var("sz",CTy"Zsize")),
          [(Call("Z8",CTy"Zsize",AVar bTy),
            CS(Call("e_imm8",LTy F8,Var("imm",F64)),
               [(LNL F8,LO(PTy(LTy F8,PTy(F8,LTy F8)))),
                (Var("l",LTy F8),
                 ITE(EQ(Var("v",F8),LW(0,8)),
                     Mop(Some,
                         TP[Var("prefixes",LTy F8),Var("v",F8),
                            Var("l",LTy F8)]),
                     LO(PTy(LTy F8,PTy(F8,LTy F8)))))])),
           (Const("Z16",CTy"Zsize"),
            CS(Call("e_imm16",LTy F8,Var("imm",F64)),
               [(LNL F8,LO(PTy(LTy F8,PTy(F8,LTy F8)))),
                (Var("l",LTy F8),
                 ITE(EQ(Var("v",F8),LW(1,8)),
                     Mop(Some,
                         TP[Var("prefixes",LTy F8),Var("v",F8),
                            Var("l",LTy F8)]),
                     LO(PTy(LTy F8,PTy(F8,LTy F8)))))])),
           (Const("Z32",CTy"Zsize"),
            CS(Call("e_imm32",LTy F8,Var("imm",F64)),
               [(LNL F8,LO(PTy(LTy F8,PTy(F8,LTy F8)))),
                (Var("l",LTy F8),
                 ITE(EQ(Var("v",F8),LW(1,8)),
                     Mop(Some,
                         TP[Var("prefixes",LTy F8),Var("v",F8),
                            Var("l",LTy F8)]),
                     LO(PTy(LTy F8,PTy(F8,LTy F8)))))])),
           (Const("Z64",CTy"Zsize"),
            ITE(EQ(Var("v",F8),LW(1,8)),
                Mop(Some,
                    TP[Var("prefixes",LTy F8),Var("v",F8),
                       Call("e_imm64",LTy F8,Var("imm",F64))]),
                LO(PTy(LTy F8,PTy(F8,LTy F8)))))])))
;
val e_opc_def = Def
  ("e_opc",TP[Var("opc1",F8),Var("opc2",FTy 3),Var("rm",CTy"Zrm")],
   CS(Call
        ("e_ModRM",OTy(PTy(F4,LTy F8)),
         TP[Mop(Cast F4,Var("opc2",FTy 3)),Var("rm",CTy"Zrm")]),
      [(LO(PTy(F4,LTy F8)),LNL F8),
       (Mop(Some,TP[Var("rex",F4),Var("strm",LTy F8)]),
        CC[Call("rex_prefix",LTy F8,Var("rex",F4)),
           LLC([Var("opc1",F8)],Var("strm",LTy F8))])]))
;
val e_gen_rm_reg_def = Def
  ("e_gen_rm_reg",
   TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),Var("r",F4),Var("p",LTy F8),
      Var("opc",F8),Var("mo",OTy F8)],
   CS(Call
        ("e_ModRM",OTy(PTy(F4,LTy F8)),TP[Var("r",F4),Var("rm",CTy"Zrm")]),
      [(LO(PTy(F4,LTy F8)),LNL F8),
       (Mop(Some,TP[Var("rex",F4),Var("strm",LTy F8)]),
        Let(TP[Var("prefixes",LTy F8),Var("v",F8)],
            Call
              ("e_opsize",PTy(LTy F8,F8),
               TP[Var("sz",CTy"Zsize"),Var("rex",F4)]),
            CC[Var("prefixes",LTy F8),Var("p",LTy F8),
               LL[Bop(BOr,Var("opc",F8),
                      CS(Var("mo",OTy F8),
                         [(Mop(Some,Var("x",F8)),Var("x",F8)),
                          (LO F8,Var("v",F8))]))],Var("strm",LTy F8)]))]))
;
val e_rm_reg_def = Def
  ("e_rm_reg",
   TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),Var("r",F4),Var("p",LTy F8),
      Var("opc",F8)],
   Call
     ("e_gen_rm_reg",LTy F8,
      TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),Var("r",F4),
         Var("p",LTy F8),Var("opc",F8),LO F8]))
;
val e_rm_imm_def = Def
  ("e_rm_imm",
   TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),Var("imm",F64),
      Var("opc1",F4),Var("opc2",F8)],
   CS(Call
        ("e_ModRM",OTy(PTy(F4,LTy F8)),
         TP[Var("opc1",F4),Var("rm",CTy"Zrm")]),
      [(LO(PTy(F4,LTy F8)),LNL F8),
       (Mop(Some,TP[Var("rex",F4),Var("strm",LTy F8)]),
        CS(Call
             ("e_opsize_imm",OTy(PTy(LTy F8,PTy(F8,LTy F8))),
              TP[Var("sz",CTy"Zsize"),Var("rex",F4),Var("imm",F64),LT]),
           [(Mop(Some,
                 TP[Var("prefixes",LTy F8),Var("v",F8),Var("l",LTy F8)]),
             CC[Var("prefixes",LTy F8),
                LL[Bop(BOr,Var("opc2",F8),Var("v",F8))],
                Var("strm",LTy F8),Var("l",LTy F8)]),
            (LO(PTy(LTy F8,PTy(F8,LTy F8))),LNL F8)]))]))
;
val e_rm_imm8_def = Def
  ("e_rm_imm8",
   TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),Var("imm",F64),
      Var("opc1",F4),Var("opc2",F8)],
   CS(Call
        ("e_ModRM",OTy(PTy(F4,LTy F8)),
         TP[Var("opc1",F4),Var("rm",CTy"Zrm")]),
      [(LO(PTy(F4,LTy F8)),LNL F8),
       (Mop(Some,TP[Var("rex",F4),Var("strm",LTy F8)]),
        Let(TP[Var("prefixes",LTy F8),Var("v",F8)],
            Call
              ("e_opsize",PTy(LTy F8,F8),
               TP[Var("sz",CTy"Zsize"),Var("rex",F4)]),
            CS(Call("e_imm8",LTy F8,Var("imm",F64)),
               [(LNL F8,LNL F8),
                (Var("l",LTy F8),
                 CC[Var("prefixes",LTy F8),
                    LL[Bop(BOr,Var("opc2",F8),Var("v",F8))],
                    Var("strm",LTy F8),Var("l",LTy F8)])])))]))
;
val e_rax_imm_def = Def
  ("e_rax_imm",TP[Var("sz",CTy"Zsize"),Var("imm",F64),Var("opc",F8)],
   CS(Call
        ("e_opsize_imm",OTy(PTy(LTy F8,PTy(F8,LTy F8))),
         TP[Var("sz",CTy"Zsize"),LW(0,4),Var("imm",F64),LT]),
      [(Mop(Some,TP[Var("prefixes",LTy F8),Var("v",F8),Var("l",LTy F8)]),
        CC[Var("prefixes",LTy F8),LL[Bop(BOr,Var("opc",F8),Var("v",F8))],
           Var("l",LTy F8)]),(LO(PTy(LTy F8,PTy(F8,LTy F8))),LNL F8)]))
;
val e_jcc_rel32_def = Def
  ("e_jcc_rel32",Var("i",CTy"instruction"),
   CS(Var("i",CTy"instruction"),
      [(Call
          ("Zjcc",CTy"instruction",
           TP[Var("cond",CTy"Zcond"),Var("imm",F64)]),
        CS(TP[Call("e_imm32",LTy F8,Var("imm",F64)),Var("cond",CTy"Zcond")],
           [(TP[LNL F8,AVar(CTy"Zcond")],LNL F8),
            (TP[Var("l",LTy F8),LC("Z_ALWAYS",CTy"Zcond")],
             LLC([LW(233,8)],Var("l",LTy F8))),
            (TP[Var("l",LTy F8),AVar(CTy"Zcond")],
             CC[LL[LW(15,8),
                   CC[LW(8,4),Mop(Cast F4,Var("cond",CTy"Zcond"))]],
                Var("l",LTy F8)])])),(AVar(CTy"instruction"),LNL F8)]))
;
val not_byte_def = Def
  ("not_byte",Var("sz",CTy"Zsize"),
   CS(Var("sz",CTy"Zsize"),
      [(Call("Z8",CTy"Zsize",AVar bTy),LF),(AVar(CTy"Zsize"),LT)]))
;
val is_rax_def = Def
  ("is_rax",Var("rm",CTy"Zrm"),
   CS(Var("rm",CTy"Zrm"),
      [(Call("Zr",CTy"Zrm",LC("RAX",CTy"Zreg")),LT),(AVar(CTy"Zrm"),LF)]))
;
val encode_def = Def
  ("encode",Var("i",CTy"instruction"),
   CS(Var("i",CTy"instruction"),
      [(Call
          ("Zbinop",CTy"instruction",
           TP[Var("bop",CTy"Zbinop_name"),Var("sz",CTy"Zsize"),
              Call
                ("Zrm_i",CTy"Zdest_src",
                 TP[Var("rm",CTy"Zrm"),Var("imm",F64)])]),
        ITE(EQ(Var("bop",CTy"Zbinop_name"),LC("Ztest",CTy"Zbinop_name")),
            ITE(Call("is_rax",bTy,Var("rm",CTy"Zrm")),
                Call
                  ("e_rax_imm",LTy F8,
                   TP[Var("sz",CTy"Zsize"),Var("imm",F64),LW(168,8)]),
                Call
                  ("e_rm_imm",LTy F8,
                   TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),
                      Var("imm",F64),LW(0,4),LW(246,8)])),
            Let(Var("opc",F4),Mop(Cast F4,Var("bop",CTy"Zbinop_name")),
                ITB([(Bop(Bit,Var("opc",F4),LN 3),
                      ITE(EQ(Var("imm",F64),LW(1,64)),
                          Call
                            ("e_rm_reg",LTy F8,
                             TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),
                                Bop(BAnd,Var("opc",F4),LW(7,4)),LNL F8,
                                LW(208,8)]),
                          Call
                            ("e_rm_imm8",LTy F8,
                             TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),
                                Var("imm",F64),
                                Bop(BAnd,Var("opc",F4),LW(7,4)),LW(192,8)]))),
                     (Bop(And,Call("not_byte",bTy,Var("sz",CTy"Zsize")),
                          Mop(Not,
                              EQ(Call("e_imm8",LTy F8,Var("imm",F64)),
                                 LNL F8))),
                      Call
                        ("e_rm_imm8",LTy F8,
                         TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),
                            Var("imm",F64),Var("opc",F4),LW(131,8)])),
                     (Call("is_rax",bTy,Var("rm",CTy"Zrm")),
                      Call
                        ("e_rax_imm",LTy F8,
                         TP[Var("sz",CTy"Zsize"),Var("imm",F64),
                            CC[LW(0,2),EX(Var("opc",F4),LN 2,LN 0,FTy 3),
                               LW(4,3)]]))],
                    Call
                      ("e_rm_imm",LTy F8,
                       TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),
                          Var("imm",F64),Var("opc",F4),LW(128,8)]))))),
       (Call
          ("Zbinop",CTy"instruction",
           TP[Var("bop",CTy"Zbinop_name"),Var("sz",CTy"Zsize"),
              Call
                ("Zrm_r",CTy"Zdest_src",
                 TP[Var("rm",CTy"Zrm"),Var("r",CTy"Zreg")])]),
        ITE(EQ(Var("bop",CTy"Zbinop_name"),LC("Ztest",CTy"Zbinop_name")),
            Call
              ("e_rm_reg",LTy F8,
               TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),
                  Mop(Cast F4,Var("r",CTy"Zreg")),LNL F8,LW(132,8)]),
            Let(Var("opc",F4),Mop(Cast F4,Var("bop",CTy"Zbinop_name")),
                ITE(Bop(Bit,Var("opc",F4),LN 3),
                    ITE(EQ(Var("r",CTy"Zreg"),LC("RCX",CTy"Zreg")),
                        Call
                          ("e_rm_reg",LTy F8,
                           TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),
                              Bop(BAnd,Var("opc",F4),LW(7,4)),LNL F8,
                              LW(210,8)]),LNL F8),
                    Call
                      ("e_rm_reg",LTy F8,
                       TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),
                          Mop(Cast F4,Var("r",CTy"Zreg")),LNL F8,
                          CC[LW(0,2),EX(Var("opc",F4),LN 2,LN 0,FTy 3),
                             LW(0,3)]]))))),
       (Call
          ("Zbinop",CTy"instruction",
           TP[Var("bop",CTy"Zbinop_name"),Var("sz",CTy"Zsize"),
              Call
                ("Zr_rm",CTy"Zdest_src",
                 TP[Var("r",CTy"Zreg"),Var("rm",CTy"Zrm")])]),
        Let(Var("opc",F4),Mop(Cast F4,Var("bop",CTy"Zbinop_name")),
            ITE(Bop(Bit,Var("opc",F4),LN 3),LNL F8,
                Call
                  ("e_rm_reg",LTy F8,
                   TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),
                      Mop(Cast F4,Var("r",CTy"Zreg")),LNL F8,
                      CC[LW(0,2),EX(Var("opc",F4),LN 2,LN 0,FTy 3),LW(2,3)]])))),
       (Call
          ("Zcall",CTy"instruction",
           Call("Zrm",CTy"Zimm_rm",Var("rm",CTy"Zrm"))),
        Call("e_opc",LTy F8,TP[LW(255,8),LW(2,3),Var("rm",CTy"Zrm")])),
       (Call
          ("Zcall",CTy"instruction",
           Call("Zimm",CTy"Zimm_rm",Var("imm",F64))),
        CS(Call("e_imm32",LTy F8,Var("imm",F64)),
           [(LNL F8,LNL F8),
            (Var("l",LTy F8),LLC([LW(232,8)],Var("l",LTy F8)))])),
       (Const("Zcmc",CTy"instruction"),LL[LW(245,8)]),
       (Const("Zclc",CTy"instruction"),LL[LW(248,8)]),
       (Const("Zstc",CTy"instruction"),LL[LW(249,8)]),
       (Call
          ("Zcmpxchg",CTy"instruction",
           TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),Var("r",CTy"Zreg")]),
        Call
          ("e_rm_reg",LTy F8,
           TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),
              Mop(Cast F4,Var("r",CTy"Zreg")),LL[LW(15,8)],LW(176,8)])),
       (Call
          ("Zdiv",CTy"instruction",
           TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm")]),
        Call
          ("e_rm_reg",LTy F8,
           TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),LW(6,4),LNL F8,
              LW(246,8)])),
       (Call
          ("Zjcc",CTy"instruction",
           TP[Var("cond",CTy"Zcond"),Var("imm",F64)]),
        Let(TP[nVar"s",Var("l",LTy F8)],
            Call("e_imm_8_32",PTy(nTy,LTy F8),Var("imm",F64)),
            ITB([(EQ(Var("cond",CTy"Zcond"),LC("Z_ALWAYS",CTy"Zcond")),
                  ITB([(EQ(nVar"s",LN 1),LLC([LW(235,8)],Var("l",LTy F8))),
                       (EQ(nVar"s",LN 4),LLC([LW(233,8)],Var("l",LTy F8)))],
                      LNL F8)),
                 (EQ(nVar"s",LN 1),
                  LLC([CC[LW(7,4),Mop(Cast F4,Var("cond",CTy"Zcond"))]],
                      Var("l",LTy F8))),
                 (EQ(nVar"s",LN 4),
                  CC[LL[LW(15,8),
                        CC[LW(8,4),Mop(Cast F4,Var("cond",CTy"Zcond"))]],
                     Var("l",LTy F8)])],LNL F8))),
       (Call("Zjmp",CTy"instruction",Var("rm",CTy"Zrm")),
        Call("e_opc",LTy F8,TP[LW(255,8),LW(4,3),Var("rm",CTy"Zrm")])),
       (Call
          ("Zlea",CTy"instruction",
           TP[Call("Z8",CTy"Zsize",AVar bTy),AVar(CTy"Zdest_src")]),LNL F8),
       (Call
          ("Zlea",CTy"instruction",
           TP[Var("sz",CTy"Zsize"),
              Call
                ("Zr_rm",CTy"Zdest_src",
                 TP[Var("r",CTy"Zreg"),
                    Call
                      ("Zm",CTy"Zrm",
                       Var("m",
                           PTy(OTy(PTy(FTy 2,CTy"Zreg")),
                               PTy(CTy"Zbase",F64))))])]),
        Call
          ("e_rm_reg",LTy F8,
           TP[Var("sz",CTy"Zsize"),
              Call
                ("Zm",CTy"Zrm",
                 Var("m",
                     PTy(OTy(PTy(FTy 2,CTy"Zreg")),PTy(CTy"Zbase",F64)))),
              Mop(Cast F4,Var("r",CTy"Zreg")),LNL F8,LW(141,8)])),
       (Call("Zlea",CTy"instruction",AVar(PTy(CTy"Zsize",CTy"Zdest_src"))),
        LNL F8),(Const("Zleave",CTy"instruction"),LL[LW(201,8)]),
       (Call
          ("Zloop",CTy"instruction",
           TP[Var("cond",CTy"Zcond"),Var("imm",F64)]),
        CS(TP[Var("cond",CTy"Zcond"),Call("e_imm8",LTy F8,Var("imm",F64))],
           [(TP[AVar(CTy"Zcond"),LNL F8],LNL F8),
            (TP[LC("Z_NE",CTy"Zcond"),Var("l",LTy F8)],
             LLC([LW(224,8)],Var("l",LTy F8))),
            (TP[LC("Z_E",CTy"Zcond"),Var("l",LTy F8)],
             LLC([LW(225,8)],Var("l",LTy F8))),
            (TP[LC("Z_ALWAYS",CTy"Zcond"),Var("l",LTy F8)],
             LLC([LW(226,8)],Var("l",LTy F8))),
            (AVar(PTy(CTy"Zcond",LTy F8)),LNL F8)])),
       (Call
          ("Zmonop",CTy"instruction",
           TP[LC("Zinc",CTy"Zmonop_name"),Call("Z8",CTy"Zsize",AVar bTy),
              Var("rm",CTy"Zrm")]),
        Call("e_opc",LTy F8,TP[LW(254,8),LW(0,3),Var("rm",CTy"Zrm")])),
       (Call
          ("Zmonop",CTy"instruction",
           TP[LC("Zdec",CTy"Zmonop_name"),Call("Z8",CTy"Zsize",AVar bTy),
              Var("rm",CTy"Zrm")]),
        Call("e_opc",LTy F8,TP[LW(254,8),LW(1,3),Var("rm",CTy"Zrm")])),
       (Call
          ("Zmonop",CTy"instruction",
           TP[LC("Zinc",CTy"Zmonop_name"),Var("sz",CTy"Zsize"),
              Var("rm",CTy"Zrm")]),
        Call
          ("e_rm_reg",LTy F8,
           TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),LW(0,4),LNL F8,
              LW(255,8)])),
       (Call
          ("Zmonop",CTy"instruction",
           TP[LC("Zdec",CTy"Zmonop_name"),Var("sz",CTy"Zsize"),
              Var("rm",CTy"Zrm")]),
        Call
          ("e_rm_reg",LTy F8,
           TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),LW(1,4),LNL F8,
              LW(255,8)])),
       (Call
          ("Zmonop",CTy"instruction",
           TP[LC("Znot",CTy"Zmonop_name"),Var("sz",CTy"Zsize"),
              Var("rm",CTy"Zrm")]),
        Call
          ("e_rm_reg",LTy F8,
           TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),LW(2,4),LNL F8,
              LW(246,8)])),
       (Call
          ("Zmonop",CTy"instruction",
           TP[LC("Zneg",CTy"Zmonop_name"),Var("sz",CTy"Zsize"),
              Var("rm",CTy"Zrm")]),
        Call
          ("e_rm_reg",LTy F8,
           TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),LW(3,4),LNL F8,
              LW(246,8)])),
       (Call
          ("Zmov",CTy"instruction",
           TP[LC("Z_ALWAYS",CTy"Zcond"),Var("sz",CTy"Zsize"),
              Call
                ("Zrm_r",CTy"Zdest_src",
                 TP[Var("rm",CTy"Zrm"),Var("r",CTy"Zreg")])]),
        Call
          ("e_rm_reg",LTy F8,
           TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),
              Mop(Cast F4,Var("r",CTy"Zreg")),LNL F8,LW(136,8)])),
       (Call
          ("Zmov",CTy"instruction",
           TP[LC("Z_ALWAYS",CTy"Zcond"),Var("sz",CTy"Zsize"),
              Call
                ("Zr_rm",CTy"Zdest_src",
                 TP[Var("r",CTy"Zreg"),Var("rm",CTy"Zrm")])]),
        Call
          ("e_rm_reg",LTy F8,
           TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),
              Mop(Cast F4,Var("r",CTy"Zreg")),LNL F8,LW(138,8)])),
       (Call
          ("Zmov",CTy"instruction",
           TP[LC("Z_ALWAYS",CTy"Zcond"),Var("sz",CTy"Zsize"),
              Call
                ("Zrm_i",CTy"Zdest_src",
                 TP[Call("Zr",CTy"Zrm",Var("reg",CTy"Zreg")),
                    Var("imm",F64)])]),
        Let(Var("r",F4),Mop(Cast F4,Var("reg",CTy"Zreg")),
            CS(Call
                 ("e_opsize_imm",OTy(PTy(LTy F8,PTy(F8,LTy F8))),
                  TP[Var("sz",CTy"Zsize"),
                     ITE(Bop(Bit,Var("r",F4),LN 3),LW(1,4),LW(0,4)),
                     Var("imm",F64),LF]),
               [(Mop(Some,
                     TP[Var("prefixes",LTy F8),Var("v",F8),Var("l",LTy F8)]),
                 CC[Var("prefixes",LTy F8),
                    LL[CC[LW(11,4),Mop(Cast F1,Var("v",F8)),
                          EX(Var("r",F4),LN 2,LN 0,FTy 3)]],
                    Var("l",LTy F8)]),
                (LO(PTy(LTy F8,PTy(F8,LTy F8))),LNL F8)]))),
       (Call
          ("Zmov",CTy"instruction",
           TP[LC("Z_ALWAYS",CTy"Zcond"),Var("sz",CTy"Zsize"),
              Call
                ("Zrm_i",CTy"Zdest_src",
                 TP[Var("rm",CTy"Zrm"),Var("imm",F64)])]),
        Call
          ("e_rm_imm",LTy F8,
           TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),Var("imm",F64),
              LW(0,4),LW(198,8)])),
       (Call
          ("Zmov",CTy"instruction",
           TP[Var("cond",CTy"Zcond"),Call("Z8",CTy"Zsize",AVar bTy),
              AVar(CTy"Zdest_src")]),LNL F8),
       (Call
          ("Zmov",CTy"instruction",
           TP[Var("cond",CTy"Zcond"),Var("sz",CTy"Zsize"),
              Call
                ("Zr_rm",CTy"Zdest_src",
                 TP[Var("r",CTy"Zreg"),Var("rm",CTy"Zrm")])]),
        Call
          ("e_gen_rm_reg",LTy F8,
           TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),
              Mop(Cast F4,Var("r",CTy"Zreg")),LL[LW(15,8)],LW(64,8),
              Mop(Some,Mop(Cast F8,Var("cond",CTy"Zcond")))])),
       (Call
          ("Zmov",CTy"instruction",
           AVar(PTy(CTy"Zcond",PTy(CTy"Zsize",CTy"Zdest_src")))),LNL F8),
       (Call
          ("Zmovsx",CTy"instruction",
           TP[Const("Z32",CTy"Zsize"),
              Call
                ("Zr_rm",CTy"Zdest_src",
                 TP[Var("r",CTy"Zreg"),Var("rm",CTy"Zrm")]),
              Const("Z64",CTy"Zsize")]),
        Call
          ("e_rm_reg",LTy F8,
           TP[Const("Z64",CTy"Zsize"),Var("rm",CTy"Zrm"),
              Mop(Cast F4,Var("r",CTy"Zreg")),LNL F8,LW(99,8)])),
       (Call
          ("Zmovsx",CTy"instruction",
           TP[Var("sz1",CTy"Zsize"),
              Call
                ("Zr_rm",CTy"Zdest_src",
                 TP[Var("r",CTy"Zreg"),Var("rm",CTy"Zrm")]),
              Var("sz2",CTy"Zsize")]),
        ITE(Bop(Lt,Call("Zsize_width",nTy,Var("sz1",CTy"Zsize")),
                Call("Zsize_width",nTy,Var("sz2",CTy"Zsize"))),
            Call
              ("e_gen_rm_reg",LTy F8,
               TP[Var("sz2",CTy"Zsize"),Var("rm",CTy"Zrm"),
                  Mop(Cast F4,Var("r",CTy"Zreg")),LL[LW(15,8)],LW(190,8),
                  Mop(Some,
                      ITE(EQ(Var("sz1",CTy"Zsize"),Const("Z16",CTy"Zsize")),
                          LW(1,8),LW(0,8)))]),LNL F8)),
       (Call
          ("Zmovsx",CTy"instruction",
           AVar(PTy(CTy"Zsize",PTy(CTy"Zdest_src",CTy"Zsize")))),LNL F8),
       (Call
          ("Zmovzx",CTy"instruction",
           TP[Var("sz1",CTy"Zsize"),
              Call
                ("Zr_rm",CTy"Zdest_src",
                 TP[Var("r",CTy"Zreg"),Var("rm",CTy"Zrm")]),
              Var("sz2",CTy"Zsize")]),
        ITE(Bop(And,
                Bop(Lt,Call("Zsize_width",nTy,Var("sz1",CTy"Zsize")),
                    Call("Zsize_width",nTy,Var("sz2",CTy"Zsize"))),
                Mop(Not,EQ(Var("sz1",CTy"Zsize"),Const("Z32",CTy"Zsize")))),
            Call
              ("e_gen_rm_reg",LTy F8,
               TP[Var("sz2",CTy"Zsize"),Var("rm",CTy"Zrm"),
                  Mop(Cast F4,Var("r",CTy"Zreg")),LL[LW(15,8)],LW(182,8),
                  Mop(Some,
                      ITE(EQ(Var("sz1",CTy"Zsize"),Const("Z16",CTy"Zsize")),
                          LW(1,8),LW(0,8)))]),LNL F8)),
       (Call
          ("Zmovzx",CTy"instruction",
           AVar(PTy(CTy"Zsize",PTy(CTy"Zdest_src",CTy"Zsize")))),LNL F8),
       (Call
          ("Zmul",CTy"instruction",
           TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm")]),
        Call
          ("e_rm_reg",LTy F8,
           TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),LW(4,4),LNL F8,
              LW(246,8)])),(Const("Znop",CTy"instruction"),LL[LW(144,8)]),
       (Call
          ("Zpop",CTy"instruction",
           Call("Zr",CTy"Zrm",Var("reg",CTy"Zreg"))),
        Let(Var("r",F4),Mop(Cast F4,Var("reg",CTy"Zreg")),
            CC[ITE(Bop(Bit,Var("r",F4),LN 3),LL[LW(73,8)],LNL F8),
               LL[CC[LW(11,5),EX(Var("r",F4),LN 2,LN 0,FTy 3)]]])),
       (Call("Zpop",CTy"instruction",Var("rm",CTy"Zrm")),
        Call("e_opc",LTy F8,TP[LW(143,8),LW(0,3),Var("rm",CTy"Zrm")])),
       (Call
          ("Zpush",CTy"instruction",
           Call
             ("Zrm",CTy"Zimm_rm",Call("Zr",CTy"Zrm",Var("reg",CTy"Zreg")))),
        Let(Var("r",F4),Mop(Cast F4,Var("reg",CTy"Zreg")),
            CC[ITE(Bop(Bit,Var("r",F4),LN 3),LL[LW(73,8)],LNL F8),
               LL[CC[LW(10,5),EX(Var("r",F4),LN 2,LN 0,FTy 3)]]])),
       (Call
          ("Zpush",CTy"instruction",
           Call("Zrm",CTy"Zimm_rm",Var("rm",CTy"Zrm"))),
        Call("e_opc",LTy F8,TP[LW(255,8),LW(6,3),Var("rm",CTy"Zrm")])),
       (Call
          ("Zpush",CTy"instruction",
           Call("Zimm",CTy"Zimm_rm",Var("imm",F64))),
        Let(TP[nVar"s",Var("l",LTy F8)],
            Call("e_imm_8_32",PTy(nTy,LTy F8),Var("imm",F64)),
            ITB([(EQ(nVar"s",LN 1),LLC([LW(106,8)],Var("l",LTy F8))),
                 (EQ(nVar"s",LN 4),LLC([LW(104,8)],Var("l",LTy F8)))],
                LNL F8))),
       (Call("Zret",CTy"instruction",LW(0,64)),LL[LW(195,8)]),
       (Call("Zret",CTy"instruction",Var("imm",F64)),
        CS(Call("e_imm16",LTy F8,Var("imm",F64)),
           [(LNL F8,LNL F8),
            (Var("l",LTy F8),LLC([LW(194,8)],Var("l",LTy F8)))])),
       (Call
          ("Zset",CTy"instruction",
           TP[LC("Z_ALWAYS",CTy"Zcond"),bVar"have_rex",Var("rm",CTy"Zrm")]),
        LNL F8),
       (Call
          ("Zset",CTy"instruction",
           TP[Var("cond",CTy"Zcond"),bVar"have_rex",Var("rm",CTy"Zrm")]),
        Call
          ("e_rm_reg",LTy F8,
           TP[Call("Z8",CTy"Zsize",bVar"have_rex"),Var("rm",CTy"Zrm"),
              LW(0,4),LL[LW(15,8)],
              CC[LW(9,4),Mop(Cast F4,Var("cond",CTy"Zcond"))]])),
       (Call
          ("Zxadd",CTy"instruction",
           TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),Var("r",CTy"Zreg")]),
        Call
          ("e_rm_reg",LTy F8,
           TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),
              Mop(Cast F4,Var("r",CTy"Zreg")),LL[LW(15,8)],LW(192,8)])),
       (Call
          ("Zxchg",CTy"instruction",
           TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),Var("reg",CTy"Zreg")]),
        ITE(Bop(And,Call("not_byte",bTy,Var("sz",CTy"Zsize")),
                Bop(Or,EQ(Var("reg",CTy"Zreg"),LC("RAX",CTy"Zreg")),
                    Call("is_rax",bTy,Var("rm",CTy"Zrm")))),
            Let(Var("r",F4),Mop(Cast F4,Var("reg",CTy"Zreg")),
                Let(TP[Var("prefixes",LTy F8),Var("v",F8)],
                    Call
                      ("e_opsize",PTy(LTy F8,F8),
                       TP[Var("sz",CTy"Zsize"),
                          ITE(Bop(Bit,Var("r",F4),LN 3),LW(1,4),LW(0,4))]),
                    ITE(EQ(Var("v",F8),LW(1,8)),
                        CC[Var("prefixes",LTy F8),
                           LL[CC[LW(18,5),EX(Var("r",F4),LN 2,LN 0,FTy 3)]]],
                        LNL F8))),
            Call
              ("e_rm_reg",LTy F8,
               TP[Var("sz",CTy"Zsize"),Var("rm",CTy"Zrm"),
                  Mop(Cast F4,Var("reg",CTy"Zreg")),LNL F8,LW(134,8)])))]))

val () = Import.finish 0